<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>RAGnetic Overview</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.7/dist/purify.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="{{ url_for('static', path='css/dashboard.css') }}">
    <script>
        // Global variables
        const API_BASE_URL = window.location.origin + '/api/v1';
        let loggedInUserToken = localStorage.getItem('ragnetic_user_token');
        let loggedInDbUserId = localStorage.getItem('ragnetic_db_user_id');
        
        // Check authentication
        if (!loggedInUserToken) {
            window.location.href = '/login';
        }
    </script>
    <script>
        // Prefer inline agent rendering on this page to avoid conflicts with external dashboard.js
        window.USE_INLINE_AGENT_RENDERER = true;
    </script>
    <script src="{{ url_for('static', path='js/dashboard.js') }}?v=20250115" defer></script>
    <script src="{{ url_for('static', path='js/training.js') }}?v=20241228" defer></script>
    <script src="{{ url_for('static', path='js/evaluation.js') }}?v=20250113c" defer></script>
    <script src="{{ url_for('static', path='js/projects.js') }}" defer></script>
    <script src="{{ url_for('static', path='js/gpu.js') }}" defer></script>
    <script src="{{ url_for('static', path='js/gpu-config.js') }}" defer></script>
    <script src="{{ url_for('static', path='js/deployments.js') }}" defer></script>
    <script src="{{ url_for('static', path='js/billing.js') }}" defer></script>
    <script src="{{ url_for('static', path='js/analytics.js') }}" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>

    <script>
// Production-Grade Metric Drill-down Functionality

// Global variable to store current metric data
let currentMetricData = null;
let currentMetricType = null;

/**
 * Show detailed metric data in a modal
 */
function showMetricDetails(metricType) {
    currentMetricType = metricType;
    const modal = document.getElementById('metric-details-modal');
    const title = document.getElementById('modal-title');
    const body = document.getElementById('modal-body');
    
    // Set title based on metric type
    const titles = {
        'system-health': 'System Health Details',
        'error-rate': 'Error Rate Analysis',
        'response-time': 'Response Time Breakdown',
        'active-users': 'Active Users Details',
        'gpu-utilization': 'GPU Utilization Details',
        'training-jobs': 'Training Jobs Status',
        'daily-cost': 'Cost Breakdown'
    };
    
    title.textContent = titles[metricType] || 'Metric Details';
    
    // Show loading state
    body.innerHTML = `
        <div class="loading-state">
            <div class="loading-spinner"></div>
            <p>Loading detailed data...</p>
        </div>
    `;
    
    // Show modal
    modal.classList.add('active');
    
    // Load data
    loadMetricDetails(metricType);
}

/**
 * Close the metric details modal
 */
function closeMetricDetails() {
    const modal = document.getElementById('metric-details-modal');
    modal.classList.remove('active');
    currentMetricData = null;
    currentMetricType = null;
}

/**
 * Load detailed metric data
 */
async function loadMetricDetails(metricType) {
    const body = document.getElementById('modal-body');
    
    try {
        // Simulate API call - replace with actual API endpoints
        const data = await fetchMetricDetails(metricType);
        currentMetricData = data;
        
        // Render the detailed table
        renderMetricTable(data, metricType);
        
    } catch (error) {
        console.error('Error loading metric details:', error);
        body.innerHTML = `
            <div class="error-state">
                <p>Failed to load detailed data. Please try again.</p>
                <button class="btn-secondary" onclick="loadMetricDetails('${metricType}')">Retry</button>
            </div>
        `;
    }
}

/**
 * Fetch detailed metric data from API
 */
async function fetchMetricDetails(metricType) {
    const { start, end } = dashboard.getRangeParams();
    
    const endpoints = {
        'system-health': '/api/v1/analytics/system-health-details',
        'error-rate': '/api/v1/analytics/error-details',
        'response-time': '/api/v1/analytics/response-time-details',
        'active-users': '/api/v1/analytics/active-users-details',
        'gpu-utilization': '/api/v1/analytics/gpu-details',
        'training-jobs': '/api/v1/analytics/training-details',
        'daily-cost': '/api/v1/analytics/cost-details'
    };
    
    const url = new URL(endpoints[metricType] || endpoints['system-health'], window.location.origin);
    url.searchParams.set('start_time', start);
    url.searchParams.set('end_time', end);
    
    const response = await fetch(url.toString(), {
        headers: { 'X-API-Key': loggedInUserToken }
    });
    
    if (!response.ok) {
        throw new Error(`API request failed: ${response.status}`);
    }
    
    return await response.json();
}

/**
 * Render metric data as a table
 */
function renderMetricTable(data, metricType) {
    const body = document.getElementById('modal-body');
    
    if (!data || data.length === 0) {
        body.innerHTML = `
            <div class="empty-state">
                <p>No detailed data available for this metric.</p>
            </div>
        `;
        return;
    }
    
    // Define columns for each metric type
    const columns = getTableColumns(metricType);
    
    // Generate table HTML
    const tableHtml = `
        <div class="table-container">
            <table class="details-table">
                <thead>
                    <tr>
                        ${columns.map(col => `<th>${col.header}</th>`).join('')}
                    </tr>
                </thead>
                <tbody>
                    ${data.map(row => `
                        <tr>
                            ${columns.map(col => `<td>${formatCellValue(row[col.key], col.type)}</td>`).join('')}
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        </div>
        <div class="table-footer">
            <p class="table-info">Showing ${data.length} records</p>
        </div>
    `;
    
    body.innerHTML = tableHtml;
}

/**
 * Get table columns for each metric type
 */
function getTableColumns(metricType) {
    const columns = {
        'system-health': [
            { key: 'timestamp', header: 'Time', type: 'datetime' },
            { key: 'component', header: 'Component', type: 'text' },
            { key: 'status', header: 'Status', type: 'status' },
            { key: 'response_time', header: 'Response Time', type: 'duration' },
            { key: 'error_count', header: 'Errors', type: 'number' }
        ],
        'error-rate': [
            { key: 'timestamp', header: 'Time', type: 'datetime' },
            { key: 'endpoint', header: 'Endpoint', type: 'text' },
            { key: 'error_type', header: 'Error Type', type: 'text' },
            { key: 'error_count', header: 'Count', type: 'number' },
            { key: 'error_rate', header: 'Rate', type: 'percentage' }
        ],
        'response-time': [
            { key: 'timestamp', header: 'Time', type: 'datetime' },
            { key: 'endpoint', header: 'Endpoint', type: 'text' },
            { key: 'p50', header: 'P50', type: 'duration' },
            { key: 'p95', header: 'P95', type: 'duration' },
            { key: 'p99', header: 'P99', type: 'duration' }
        ],
        'active-users': [
            { key: 'user_id', header: 'User ID', type: 'text' },
            { key: 'agent_name', header: 'Agent', type: 'text' },
            { key: 'last_activity', header: 'Last Activity', type: 'datetime' },
            { key: 'session_duration', header: 'Session Duration', type: 'duration' },
            { key: 'requests_count', header: 'Requests', type: 'number' }
        ],
        'gpu-utilization': [
            { key: 'instance_id', header: 'Instance', type: 'text' },
            { key: 'gpu_type', header: 'GPU Type', type: 'text' },
            { key: 'utilization', header: 'Utilization', type: 'percentage' },
            { key: 'memory_used', header: 'Memory Used', type: 'bytes' },
            { key: 'temperature', header: 'Temperature', type: 'temperature' }
        ],
        'training-jobs': [
            { key: 'job_id', header: 'Job ID', type: 'text' },
            { key: 'model_name', header: 'Model', type: 'text' },
            { key: 'status', header: 'Status', type: 'status' },
            { key: 'progress', header: 'Progress', type: 'percentage' },
            { key: 'started_at', header: 'Started', type: 'datetime' },
            { key: 'estimated_completion', header: 'ETA', type: 'datetime' }
        ],
        'daily-cost': [
            { key: 'service', header: 'Service', type: 'text' },
            { key: 'cost', header: 'Cost', type: 'currency' },
            { key: 'usage_amount', header: 'Usage', type: 'number' },
            { key: 'unit_cost', header: 'Unit Cost', type: 'currency' },
            { key: 'percentage', header: '% of Total', type: 'percentage' }
        ]
    };
    
    return columns[metricType] || columns['system-health'];
}

/**
 * Format cell values based on type
 */
function formatCellValue(value, type) {
    if (value === null || value === undefined) {
        return '—';
    }
    
    switch (type) {
        case 'datetime':
            return new Date(value).toLocaleString();
        case 'duration':
            return `${value}ms`;
        case 'percentage':
            return `${value}%`;
        case 'currency':
            return `$${parseFloat(value).toFixed(2)}`;
        case 'bytes':
            return formatBytes(value);
        case 'temperature':
            return `${value}°C`;
        case 'status':
            return `<span class="status-badge status-${value.toLowerCase()}">${value}</span>`;
        case 'number':
            return parseInt(value).toLocaleString();
        default:
            return value;
    }
}

/**
 * Format bytes to human readable format
 */
function formatBytes(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

/**
 * Export current metric data
 */
function exportMetricData() {
    if (!currentMetricData || !currentMetricType) {
        return;
    }
    
    const columns = getTableColumns(currentMetricType);
    const headers = columns.map(col => col.header);
    
    // Convert data to CSV
    let csv = headers.join(',') + '\n';
    currentMetricData.forEach(row => {
        const values = columns.map(col => {
            const value = row[col.key];
            return typeof value === 'string' ? `"${value}"` : value;
        });
        csv += values.join(',') + '\n';
    });
    
    // Download CSV
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `${currentMetricType}-details-${new Date().toISOString().split('T')[0]}.csv`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    window.URL.revokeObjectURL(url);
}

// Close modal when clicking outside
document.addEventListener('click', function(event) {
    const modal = document.getElementById('metric-details-modal');
    if (event.target === modal) {
        closeMetricDetails();
    }
});

// Close modal with Escape key
document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        closeMetricDetails();
    }
});

    </script>
    <script>

// Professional navigation functions
function navigateToGPU() {
    // Navigate to GPU tab or open GPU provisioning modal
    switchView('gpu');
}

function navigateToTraining() {
    // Navigate to training tab
    switchView('training');
}

function navigateToAgentBuilder() {
    // Navigate to agents tab
    switchView('agents');
}

function navigateToDeployment() {
    // Navigate to deployments tab or open deployment modal
    switchView('deployments');
}

// Search functionality
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.querySelector('.search-input');
    if (searchInput) {
        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const query = this.value.trim();
                if (query) {
                    // Implement search functionality
                    console.log('Searching for:', query);
                    // You can implement actual search logic here
                }
            }
        });
    }
});


function navigateToTraining() {
    // Navigate to training tab
    switchView('training');
}

function navigateToAgentBuilder() {
    // Navigate to agents tab
    switchView('agents');
}

function navigateToDeployment() {
    // Navigate to deployments tab or open deployment modal
    switchView('deployments');
}

    </script>
    <script>// Agent Tab JavaScript

let currentAgentView = 'table';
let currentSort = { column: 'name', direction: 'asc' };
let agents = [];
let currentPage = 1;
let itemsPerPage = 10;
let totalPages = 1;

// Initialize agent tab
function initializeAgentTab() {
    console.log('initializeAgentTab() called');
    console.log('typeof loadAgentsInline:', typeof loadAgentsInline);
    try {
        console.log('About to call loadAgentsInline()');
        loadFilterOptions();
        if (typeof loadAgentsInline === 'function') {
            loadAgentsInline();
            console.log('loadAgentsInline() call completed');
        } else {
            console.error('loadAgentsInline is not a function!');
        }
    } catch (error) {
        console.error('Error calling loadAgentsInline():', error);
    }
    setupEventListeners();
}

// Setup event listeners
function setupEventListeners() {
    // Search functionality
    const searchInput = document.querySelector('.search-input');
    if (searchInput) {
        searchInput.addEventListener('input', debounce(handleSearch, 300));
    }
    
    // Filter functionality
    const statusFilter = document.getElementById('status-filter');
    const modelFilter = document.getElementById('model-filter');
    const deploymentFilter = document.getElementById('deployment-filter');
    
    if (statusFilter) {
        statusFilter.addEventListener('change', handleFilterChange);
    }
    if (modelFilter) {
        modelFilter.addEventListener('change', handleFilterChange);
    }
    if (deploymentFilter) {
        deploymentFilter.addEventListener('change', handleFilterChange);
    }
    const filters = document.querySelectorAll('.filter-select');
    filters.forEach(filter => {
        filter.addEventListener('change', handleFilter);
    });
    
    // Sort functionality
    const sortableHeaders = document.querySelectorAll('.sortable');
    sortableHeaders.forEach(header => {
        header.addEventListener('click', () => handleSort(header.dataset.sort));
    });
    
    // Pagination functionality
    const prevBtn = document.getElementById('prev-page');
    const nextBtn = document.getElementById('next-page');
    
    if (prevBtn) prevBtn.addEventListener('click', goToPreviousPage);
    if (nextBtn) nextBtn.addEventListener('click', goToNextPage);
}

// Load filter options from API
async function loadFilterOptions() {
    try {
        const response = await fetch('/api/v1/agents/filters/options', {
            headers: { 'X-API-Key': loggedInUserToken }
        });
        
        if (response.ok) {
            const options = await response.json();
            
            // Update status filter
            const statusFilter = document.getElementById('status-filter');
            if (statusFilter && options.statuses) {
                const currentValue = statusFilter.value;
                statusFilter.innerHTML = '<option value="">All Status</option>';
                options.statuses.forEach(status => {
                    const option = document.createElement('option');
                    option.value = status;
                    option.textContent = status.charAt(0).toUpperCase() + status.slice(1);
                    statusFilter.appendChild(option);
                });
                statusFilter.value = currentValue;
            }
            
            // Update model filter
            const modelFilter = document.getElementById('model-filter');
            if (modelFilter && options.models) {
                const currentValue = modelFilter.value;
                modelFilter.innerHTML = '<option value="">All Models</option>';
                options.models.forEach(model => {
                    const option = document.createElement('option');
                    option.value = model;
                    option.textContent = model;
                    modelFilter.appendChild(option);
                });
                modelFilter.value = currentValue;
            }
            
            // Update deployment filter
            const deploymentFilter = document.getElementById('deployment-filter');
            if (deploymentFilter && options.deployment_types) {
                const currentValue = deploymentFilter.value;
                deploymentFilter.innerHTML = '<option value="">All Deployments</option>';
                options.deployment_types.forEach(type => {
                    const option = document.createElement('option');
                    option.value = type;
                    option.textContent = type.charAt(0).toUpperCase() + type.slice(1);
                    deploymentFilter.appendChild(option);
                });
                deploymentFilter.value = currentValue;
            }
        }
    } catch (error) {
        console.warn('Failed to load filter options:', error);
    }
}

// Load agents from API
async function loadAgentsInline() {
    console.log(' Inline loadAgentsInline() called');
    const loadingState = document.getElementById('agent-loading');
    const tableBody = document.getElementById('agent-table-body');
    const cardsGrid = document.getElementById('agent-cards-grid');
    const emptyState = document.getElementById('agent-empty');
    
    try {
        console.log(' Setting loading state...');
        loadingState.style.display = 'flex';
        tableBody.innerHTML = '';
        cardsGrid.innerHTML = '';
        emptyState.style.display = 'none';
        
        console.log(' Fetching agents from API...');
        // Load agents status from the status API with filtering
        const searchParams = new URLSearchParams();
        const searchInput = document.querySelector('.search-input');
        const statusFilter = document.getElementById('status-filter');
        const modelFilter = document.getElementById('model-filter');
        const deploymentFilter = document.getElementById('deployment-filter');
        
        if (searchInput && searchInput.value.trim()) {
            searchParams.append('search', searchInput.value.trim());
        }
        if (statusFilter && statusFilter.value) {
            searchParams.append('status', statusFilter.value);
        }
        if (modelFilter && modelFilter.value) {
            searchParams.append('model', modelFilter.value);
        }
        if (deploymentFilter && deploymentFilter.value) {
            searchParams.append('deployment_type', deploymentFilter.value);
        }
        
        const response = await fetch(`/api/v1/agents/status-all?${searchParams.toString()}`, {
            headers: { 'X-API-Key': loggedInUserToken }
        });
        
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        agents = await response.json();
        console.log(' Loaded agents status:', agents);
        
        // Normalize fields for table/card rendering
        agents = agents.map(a => ({
            name: a.name,
            description: a.description || '',
            status: a.status || 'created',
            model: a.model_name || 'gpt-4',
            embedding: a.embedding_model || 'text-embedding-3-small',
            deployment: a.deployment_type || (a.status === 'deployed' ? 'deployed' : 'not deployed'),
            created_at: a.created_at,
            lastRun: a.last_run || null,
            costThisMonth: typeof a.total_cost === 'number' ? a.total_cost : 0,
            project_id: a.project_id,
            tags: a.tags || []
        }));
        
        console.log(' Finished preparing agents data, rendering agents...');
        // Reset pagination when loading new data
        currentPage = 1;
        
        if (agents.length === 0) {
            console.log(' No agents found, showing empty state');
            showEmptyState();
        } else {
            console.log(' Rendering', agents.length, 'agents');
            renderAgents();
        }
    } catch (error) {
        console.error(' Error loading agents:', error);
        showErrorState();
    } finally {
        console.log(' Hiding loading state');
        loadingState.style.display = 'none';
    }
}

// Render agents in current view
function renderAgents() {
    console.log(' renderAgents() called, currentAgentView:', currentAgentView);
    if (currentAgentView === 'table') {
        console.log(' Rendering table view');
        renderTableView();
    } else {
        console.log(' Rendering grid view');
        renderGridView();
    }
}

// Render table view
function renderTableView() {
    console.log(' renderTableView() called with', agents.length, 'agents');
    const tableBody = document.getElementById('agent-table-body');
    if (!tableBody) {
        console.error(' agent-table-body not found!');
        return;
    }
    
    // Calculate pagination
    totalPages = Math.ceil(agents.length / itemsPerPage);
    const startIndex = (currentPage - 1) * itemsPerPage;
    const endIndex = startIndex + itemsPerPage;
    const paginatedAgents = agents.slice(startIndex, endIndex);
    
    tableBody.innerHTML = '';
    
    paginatedAgents.forEach(agent => {
        console.log(' Creating table row for agent:', agent.name);
        const row = createAgentTableRow(agent);
        tableBody.appendChild(row);
        
        // Load actions asynchronously for table view
        loadTableAgentActions(agent.name);
    });
    
    // Update pagination controls
    updatePaginationControls();
    
    console.log(' Table view rendered');
}

// Render grid view
function renderGridView() {
    console.log(' renderGridView() called with', agents.length, 'agents');
    const cardsGrid = document.getElementById('agent-cards-grid');
    if (!cardsGrid) {
        console.error(' agent-cards-grid not found!');
        return;
    }
    cardsGrid.innerHTML = '';
    
    agents.forEach(agent => {
        console.log(' Creating card for agent:', agent.name);
        const card = createAgentCard(agent);
        cardsGrid.appendChild(card);
        
        // Load actions asynchronously
        loadAgentActions(agent.name);
    });
    console.log(' Grid view rendered');
}

// Create agent table row
function createAgentTableRow(agent) {
    const row = document.createElement('tr');
    const createdAt = agent.created_at ? new Date(agent.created_at).toLocaleString() : 'Unknown';
    const cost = typeof agent.costThisMonth === 'number' ? agent.costThisMonth : 0;
    
    row.innerHTML = `
        <td>
            <div class="agent-name" onclick="openAgentDetail('${agent.name}')">${agent.name}</div>
            <div class="agent-description">${agent.description || 'No description'}</div>
        </td>
        <td>
            <div class="status-pill ${agent.status}">
                <div class="status-dot"></div>
                ${agent.status}
            </div>
        </td>
        <td>
            <div class="model-info">
                <div class="model-name">${agent.model || 'gpt-4'}</div>
            </div>
        </td>
        <td>
            <div class="embedding-name">${agent.embedding || 'text-embedding-3-small'}</div>
        </td>
        <td>
            <div class="created-at">${createdAt}</div>
        </td>
        <td>
            <div class="cost-amount">$${cost.toFixed(2)}</div>
        </td>
        <td>
            <div class="agent-actions" id="table-actions-${agent.name}">Loading...</div>
        </td>
    `;
    return row;
}

// Get agent actions based on status
async function getAgentActions(agent) {
    // Get actual status from the new status API
    let status = agent.status || 'created';
    try {
        const response = await fetch(`/api/v1/agents/${agent.name}/status`, {
            headers: { 'X-API-Key': getApiKey() }
        });
        if (response.ok) {
            const statusData = await response.json();
            status = statusData.actual_status;
        }
    } catch (error) {
        console.error('Error getting actual status:', error);
    }
    
    const actions = [];
    
    switch (status) {
        case 'created':
            actions.push(`<button class="action-btn primary" onclick="deployAgentState('${agent.name}')" title="Deploy">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="5,3 19,12 5,21"></polygon>
                </svg>
            </button>`);
            actions.push(`<button class="action-btn" onclick="viewAgent('${agent.name}')" title="View">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                </svg>
            </button>`);
            actions.push(`<button class="action-btn" onclick="editAgent('${agent.name}')" title="Edit">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
            </button>`);
            break;
        case 'deploying':
            actions.push(`<button class="action-btn" onclick="stopAgentState('${agent.name}')" title="Stop">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="6" y="6" width="12" height="12"></rect>
                </svg>
            </button>`);
            actions.push(`<button class="action-btn" onclick="viewAgent('${agent.name}')" title="View">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                </svg>
            </button>`);
            break;
        case 'deployed':
            actions.push(`<button class="action-btn" onclick="stopAgentState('${agent.name}')" title="Shutdown">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="6" y="6" width="12" height="12"></rect>
                </svg>
            </button>`);
            actions.push(`<button class="action-btn" onclick="viewAgent('${agent.name}')" title="View">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                </svg>
            </button>`);
            actions.push(`<button class="action-btn" onclick="editAgent('${agent.name}')" title="Edit">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
            </button>`);
            actions.push(`<button class="action-btn" onclick="viewAgentLogs('${agent.name}')" title="View Logs">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14,2 14,8 20,8"></polyline>
                </svg>
            </button>`);
            break;
        case 'idle':
            actions.push(`<button class="action-btn primary" onclick="resumeAgentState('${agent.name}')" title="Resume">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="5,3 19,12 5,21"></polygon>
                </svg>
            </button>`);
            actions.push(`<button class="action-btn" onclick="stopAgentState('${agent.name}')" title="Shutdown">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="6" y="6" width="12" height="12"></rect>
                </svg>
            </button>`);
            actions.push(`<button class="action-btn" onclick="viewAgent('${agent.name}')" title="View">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                </svg>
            </button>`);
            actions.push(`<button class="action-btn" onclick="editAgent('${agent.name}')" title="Edit">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
            </button>`);
            actions.push(`<button class="action-btn" onclick="viewAgentLogs('${agent.name}')" title="View Logs">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14,2 14,8 20,8"></polyline>
                </svg>
            </button>`);
            break;
        case 'error':
            actions.push(`<button class="action-btn warning" onclick="retryAgentDeployment('${agent.name}')" title="Retry">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="23,4 23,10 17,10"></polyline>
                    <path d="M20.49,15a9,9 0 1,1-2.12-9.36L23,10"></path>
                </svg>
            </button>`);
            actions.push(`<button class="action-btn" onclick="stopAgentState('${agent.name}')" title="Stop">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="6" y="6" width="12" height="12"></rect>
                </svg>
            </button>`);
            actions.push(`<button class="action-btn" onclick="viewAgent('${agent.name}')" title="View">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                </svg>
            </button>`);
            actions.push(`<button class="action-btn" onclick="editAgent('${agent.name}')" title="Edit">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
            </button>`);
            actions.push(`<button class="action-btn" onclick="viewAgentLogs('${agent.name}')" title="View Logs">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14,2 14,8 20,8"></polyline>
                </svg>
            </button>`);
            break;
        case 'stopped':
            actions.push(`<button class="action-btn primary" onclick="deployAgentState('${agent.name}')" title="Deploy">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="5,3 19,12 5,21"></polygon>
                </svg>
            </button>`);
            actions.push(`<button class="action-btn" onclick="viewAgent('${agent.name}')" title="View">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                </svg>
            </button>`);
            actions.push(`<button class="action-btn" onclick="editAgent('${agent.name}')" title="Edit">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
            </button>`);
            actions.push(`<button class="action-btn danger" onclick="deleteAgent('${agent.name}')" title="Delete">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="3,6 5,6 21,6"></polyline>
                    <path d="M19,6v14a2,2 0 0,1 -2,2H7a2,2 0 0,1 -2,-2V6m3,0V4a2,2 0 0,1 2,-2h4a2,2 0 0,1 2,2v2"></path>
                </svg>
            </button>`);
            break;
    }
    
    return actions.join('');
}

// Agent state management functions
async function deployAgentState(agentName) {
    try {
        const response = await fetch(`/api/v1/agents/${agentName}/deploy-state`, {
            method: 'POST',
            headers: { 'X-API-Key': loggedInUserToken }
        });
        if (response.ok) {
            console.log(`Agent ${agentName} deployment started`);
            loadAgentsInline();
        } else {
            console.error(`Failed to deploy agent ${agentName}`);
        }
    } catch (error) {
        console.error(`Error deploying agent ${agentName}:`, error);
    }
}

async function stopAgentState(agentName) {
    try {
        const response = await fetch(`/api/v1/agents/${agentName}/stop-state`, {
            method: 'POST',
            headers: { 'X-API-Key': loggedInUserToken }
        });
        if (response.ok) {
            console.log(`Agent ${agentName} stopped`);
            loadAgentsInline();
        } else {
            console.error(`Failed to stop agent ${agentName}`);
        }
    } catch (error) {
        console.error(`Error stopping agent ${agentName}:`, error);
    }
}

async function resumeAgentState(agentName) {
    try {
        const response = await fetch(`/api/v1/agents/${agentName}/resume`, {
            method: 'POST',
            headers: { 'X-API-Key': loggedInUserToken }
        });
        if (response.ok) {
            console.log(`Agent ${agentName} resumed`);
            loadAgentsInline();
        } else {
            console.error(`Failed to resume agent ${agentName}`);
        }
    } catch (error) {
        console.error(`Error resuming agent ${agentName}:`, error);
    }
}

async function retryAgentDeployment(agentName) {
    try {
        const response = await fetch(`/api/v1/agents/${agentName}/retry`, {
            method: 'POST',
            headers: { 'X-API-Key': loggedInUserToken }
        });
        if (response.ok) {
            console.log(`Agent ${agentName} retry started`);
            loadAgentsInline();
        } else {
            console.error(`Failed to retry agent ${agentName}`);
        }
    } catch (error) {
        console.error(`Error retrying agent ${agentName}:`, error);
    }
}

async function viewAgentLogs(agentName) {
    console.log(`View logs for agent ${agentName} - feature not implemented yet`);
    // TODO: Implement log viewing
}


// Create agent card
function createAgentCard(agent) {
    const card = document.createElement('div');
    card.className = 'agent-card';
    card.innerHTML = `
        <div class="agent-card-header">
            <div>
                <h3 class="agent-card-title" onclick="openAgentDetail('${agent.id}')">${agent.name}</h3>
                <p class="agent-card-description">${agent.description || 'No description'}</p>
            </div>
            <div class="agent-card-status">
                <div class="status-pill ${agent.status}">
                    <div class="status-dot"></div>
                    ${agent.status}
                </div>
            </div>
        </div>
        
        <div class="agent-card-body">
            <div class="agent-card-info">
                <div class="info-item">
                    <div class="info-label">Model</div>
                    <div class="info-value">${agent.model}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Embedding</div>
                    <div class="info-value">${agent.embedding}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Deployment</div>
                    <div class="info-value">
                        <div class="deployment-badge ${agent.deployment}">${agent.deployment}</div>
                    </div>
                </div>
                <div class="info-item">
                    <div class="info-label">Last Run</div>
                    <div class="info-value">${formatLastRun(agent.lastRun)}</div>
                </div>
            </div>
        </div>
        
        <div class="agent-card-footer">
            <div class="agent-card-cost">$${(agent.costThisMonth || 0).toFixed(2)} this month</div>
            <div class="agent-card-actions" id="actions-${agent.name}">Loading...</div>
        </div>
    `;
    return card;
}

// Load agent actions asynchronously for grid view
async function loadAgentActions(agentName) {
    const actionsElement = document.getElementById(`actions-${agentName}`);
    if (!actionsElement) return;
    
    try {
        const response = await fetch(`/api/v1/agents/${agentName}/status`, {
            headers: { 'X-API-Key': getApiKey() }
        });
        
        if (response.ok) {
            const statusData = await response.json();
            const status = statusData.actual_status;
            const actions = getAgentActionsSync(status, agentName);
            actionsElement.innerHTML = actions;
            
            // Update the status in grid view as well
            updateAgentStatusInGrid(agentName, status);
        } else {
            actionsElement.innerHTML = '<span class="error">Error loading status</span>';
        }
    } catch (error) {
        console.error('Error loading agent actions:', error);
        actionsElement.innerHTML = '<span class="error">Error loading actions</span>';
    }
}

// Load agent actions asynchronously for table view
async function loadTableAgentActions(agentName) {
    const actionsElement = document.getElementById(`table-actions-${agentName}`);
    if (!actionsElement) return;
    
    try {
        const response = await fetch(`/api/v1/agents/${agentName}/status`, {
            headers: { 'X-API-Key': getApiKey() }
        });
        
        if (response.ok) {
            const statusData = await response.json();
            const status = statusData.actual_status;
            const actions = getAgentActionsSync(status, agentName);
            actionsElement.innerHTML = actions;
            
            // Update the status column to match the actual status
            updateAgentStatusInTable(agentName, status);
        } else {
            actionsElement.innerHTML = '<span class="error">Error loading status</span>';
        }
    } catch (error) {
        console.error('Error loading table agent actions:', error);
        actionsElement.innerHTML = '<span class="error">Error loading actions</span>';
    }
}

// Synchronous version of getAgentActions for use with actual status
function getAgentActionsSync(status, agentName) {
    const actions = [];
    
    switch (status) {
        case 'created':
            actions.push(`<button class="action-btn primary" onclick="deployAgentState('${agentName}')" title="Deploy">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="5,3 19,12 5,21"></polygon>
                </svg>
            </button>`);
            actions.push(`<button class="action-btn" onclick="viewAgent('${agentName}')" title="View">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                </svg>
            </button>`);
            actions.push(`<button class="action-btn" onclick="editAgent('${agentName}')" title="Edit">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
            </button>`);
            break;
        case 'deploying':
            actions.push(`<button class="action-btn" onclick="stopAgentState('${agentName}')" title="Stop">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="6" y="6" width="12" height="12"></rect>
                </svg>
            </button>`);
            actions.push(`<button class="action-btn" onclick="viewAgent('${agentName}')" title="View">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                </svg>
            </button>`);
            break;
        case 'deployed':
            actions.push(`<button class="action-btn" onclick="stopAgentState('${agentName}')" title="Shutdown">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="6" y="6" width="12" height="12"></rect>
                </svg>
            </button>`);
            actions.push(`<button class="action-btn" onclick="viewAgent('${agentName}')" title="View">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                </svg>
            </button>`);
            actions.push(`<button class="action-btn" onclick="editAgent('${agentName}')" title="Edit">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
            </button>`);
            break;
        case 'idle':
            actions.push(`<button class="action-btn primary" onclick="resumeAgentState('${agentName}')" title="Resume">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="5,3 19,12 5,21"></polygon>
                </svg>
            </button>`);
            actions.push(`<button class="action-btn" onclick="stopAgentState('${agentName}')" title="Shutdown">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="6" y="6" width="12" height="12"></rect>
                </svg>
            </button>`);
            actions.push(`<button class="action-btn" onclick="viewAgent('${agentName}')" title="View">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                </svg>
            </button>`);
            actions.push(`<button class="action-btn" onclick="editAgent('${agentName}')" title="Edit">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
            </button>`);
            actions.push(`<button class="action-btn" onclick="viewAgentLogs('${agentName}')" title="View Logs">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14,2 14,8 20,8"></polyline>
                </svg>
            </button>`);
            break;
        case 'error':
            actions.push(`<button class="action-btn primary" onclick="retryAgentDeployment('${agentName}')" title="Retry">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="23,4 23,10 17,10"></polyline>
                    <polyline points="1,20 1,14 7,14"></polyline>
                    <path d="M20.49,9A9,9,0,0,0,5.64,5.64L1,10m22,4L18.36,18.36A9,9,0,0,1,3.51,15"></path>
                </svg>
            </button>`);
            actions.push(`<button class="action-btn" onclick="viewAgent('${agentName}')" title="View">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                </svg>
            </button>`);
            actions.push(`<button class="action-btn" onclick="editAgent('${agentName}')" title="Edit">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
            </button>`);
            actions.push(`<button class="action-btn" onclick="viewAgentLogs('${agentName}')" title="View Logs">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14,2 14,8 20,8"></polyline>
                </svg>
            </button>`);
            break;
        case 'stopped':
            actions.push(`<button class="action-btn primary" onclick="deployAgentState('${agentName}')" title="Deploy">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="5,3 19,12 5,21"></polygon>
                </svg>
            </button>`);
            actions.push(`<button class="action-btn" onclick="viewAgent('${agentName}')" title="View">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                </svg>
            </button>`);
            actions.push(`<button class="action-btn" onclick="editAgent('${agentName}')" title="Edit">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
            </button>`);
            actions.push(`<button class="action-btn danger" onclick="deleteAgent('${agentName}')" title="Delete">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="3,6 5,6 21,6"></polyline>
                    <path d="M19,6v14a2,2 0 0,1 -2,2H7a2,2 0 0,1 -2,-2V6m3,0V4a2,2 0 0,1 2,-2h4a2,2 0 0,1 2,2v2"></path>
                </svg>
            </button>`);
            break;
    }
    
    return actions.join('');
}

// Update agent status in table to match actual status
function updateAgentStatusInTable(agentName, actualStatus) {
    // Find the agent row in the table
    const tableBody = document.getElementById('agent-table-body');
    if (!tableBody) return;
    
    const rows = tableBody.querySelectorAll('tr');
    for (const row of rows) {
        const agentNameElement = row.querySelector('.agent-name');
        if (agentNameElement && agentNameElement.textContent === agentName) {
            // Find the status pill in this row
            const statusPill = row.querySelector('.status-pill');
            if (statusPill) {
                // Update the status class and text
                statusPill.className = `status-pill ${actualStatus}`;
                statusPill.textContent = actualStatus;
            }
            break;
        }
    }
}

// Update agent status in grid to match actual status
function updateAgentStatusInGrid(agentName, actualStatus) {
    // Find the agent card in the grid
    const cardsGrid = document.getElementById('agent-cards-grid');
    if (!cardsGrid) return;
    
    const cards = cardsGrid.querySelectorAll('.agent-card');
    for (const card of cards) {
        const agentNameElement = card.querySelector('.agent-name');
        if (agentNameElement && agentNameElement.textContent === agentName) {
            // Find the status pill in this card
            const statusPill = card.querySelector('.status-pill');
            if (statusPill) {
                // Update the status class and text
                statusPill.className = `status-pill ${actualStatus}`;
                statusPill.textContent = actualStatus;
            }
            break;
        }
    }
}

// Toggle between table and grid view
function toggleAgentView(view) {
    currentAgentView = view;
    
    const tableView = document.getElementById('agent-table-view');
    const gridView = document.getElementById('agent-grid-view');
    const tableBtn = document.querySelector('[data-view="table"]');
    const gridBtn = document.querySelector('[data-view="grid"]');
    
    if (view === 'table') {
        tableView.style.display = 'block';
        gridView.style.display = 'none';
        tableBtn.classList.add('active');
        gridBtn.classList.remove('active');
    } else {
        tableView.style.display = 'none';
        gridView.style.display = 'block';
        tableBtn.classList.remove('active');
        gridBtn.classList.add('active');
    }
    
    renderAgents();
}

// Handle search
function handleSearch(event) {
    console.log('Search triggered, reloading agents...');
    loadAgentsInline();
}

// Handle filter changes
function handleFilterChange() {
    console.log('Filter changed, reloading agents...');
    currentPage = 1; // Reset to first page when filtering
    loadAgentsInline();
}

// Update pagination controls
function updatePaginationControls() {
    const paginationInfo = document.getElementById('agent-pagination-info');
    const prevBtn = document.getElementById('prev-page');
    const nextBtn = document.getElementById('next-page');
    const pagesContainer = document.getElementById('pagination-pages');
    
    if (!paginationInfo || !prevBtn || !nextBtn || !pagesContainer) return;
    
    const startIndex = (currentPage - 1) * itemsPerPage + 1;
    const endIndex = Math.min(currentPage * itemsPerPage, agents.length);
    
    // Update pagination info
    paginationInfo.textContent = `Showing ${startIndex}-${endIndex} of ${agents.length} agents`;
    
    // Update button states
    prevBtn.disabled = currentPage === 1;
    nextBtn.disabled = currentPage === totalPages;
    
    // Generate page numbers
    pagesContainer.innerHTML = '';
    const maxVisiblePages = 5;
    let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
    let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
    
    if (endPage - startPage + 1 < maxVisiblePages) {
        startPage = Math.max(1, endPage - maxVisiblePages + 1);
    }
    
    for (let i = startPage; i <= endPage; i++) {
        const pageBtn = document.createElement('button');
        pageBtn.className = `pagination-page ${i === currentPage ? 'active' : ''}`;
        pageBtn.textContent = i;
        pageBtn.onclick = () => goToPage(i);
        pagesContainer.appendChild(pageBtn);
    }
}

// Go to specific page
function goToPage(page) {
    if (page >= 1 && page <= totalPages && page !== currentPage) {
        currentPage = page;
        renderTableView();
    }
}

// Go to previous page
function goToPreviousPage() {
    if (currentPage > 1) {
        currentPage--;
        renderTableView();
    }
}

// Go to next page
function goToNextPage() {
    if (currentPage < totalPages) {
        currentPage++;
        renderTableView();
    }
}

// Handle filter changes
function handleFilter(event) {
    const filterType = event.target.id.replace('-filter', '');
    const filterValue = event.target.value;
    // Apply filters to agents array and re-render
    console.log('Filtering by', filterType, ':', filterValue);
}

// Handle sorting
function handleSort(column) {
    if (currentSort.column === column) {
        currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
    } else {
        currentSort.column = column;
        currentSort.direction = 'asc';
    }
    
    // Update sort indicators
    document.querySelectorAll('.sortable').forEach(header => {
        header.classList.remove('asc', 'desc');
        if (header.dataset.sort === column) {
            header.classList.add(currentSort.direction);
        }
    });
    
    // Sort agents array and re-render
    console.log('Sorting by', column, currentSort.direction);
}

// Show empty state
function showEmptyState() {
    document.getElementById('agent-empty').style.display = 'flex';
}

// Show error state
function showErrorState() {
    console.error(' Showing error state');
    const loadingState = document.getElementById('agent-loading');
    const emptyState = document.getElementById('agent-empty');
    if (loadingState) loadingState.style.display = 'none';
    if (emptyState) {
        emptyState.innerHTML = '<div class="empty-icon">!</div><p>Failed to load agents. Please try again.</p>';
        emptyState.style.display = 'flex';
    }
}

// Format last run timestamp
function formatLastRun(timestamp) {
    if (!timestamp) return 'Never';
    
    const date = new Date(timestamp);
    const now = new Date();
    const diffMs = now - date;
    const diffMins = Math.floor(diffMs / 60000);
    const diffHours = Math.floor(diffMs / 3600000);
    const diffDays = Math.floor(diffMs / 86400000);
    
    if (diffMins < 1) return 'Just now';
    if (diffMins < 60) return `${diffMins}m ago`;
    if (diffHours < 24) return `${diffHours}h ago`;
    if (diffDays < 7) return `${diffDays}d ago`;
    
    return date.toLocaleDateString();
}

// Agent actions
function openAgentDetail(agentId) {
    // Navigate to agent detail page
    console.log('Opening agent detail for:', agentId);
    // This would typically navigate to a detail view or open a modal
}

async function deployAgent(agentName) {
    console.log('Deploying agent:', agentName);
    try {
        const response = await fetch(`/api/v1/agents/${agentName}/deploy`, {
            method: 'POST',
            headers: { 'X-API-Key': loggedInUserToken }
        });
        
        if (response.ok) {
            const result = await response.json();
            console.log('Deploy result:', result);
            // Reload agents to update status
            loadAgentsInline();
        } else {
            const error = await response.json().catch(() => ({}));
            console.error('Deploy failed:', error);
            alert('Failed to deploy agent: ' + (error.detail || 'Unknown error'));
        }
    } catch (error) {
        console.error('Deploy error:', error);
        alert('Failed to deploy agent: ' + error.message);
    }
}

async function shutdownAgent(agentName) {
    console.log('Shutting down agent:', agentName);
    try {
        const response = await fetch(`/api/v1/agents/${agentName}/shutdown`, {
            method: 'POST',
            headers: { 'X-API-Key': loggedInUserToken }
        });
        
        if (response.ok) {
            const result = await response.json();
            console.log('Shutdown result:', result);
            // Reload agents to update status
            loadAgentsInline();
        } else {
            const error = await response.json().catch(() => ({}));
            console.error('Shutdown failed:', error);
            alert('Failed to shutdown agent: ' + (error.detail || 'Unknown error'));
        }
    } catch (error) {
        console.error('Shutdown error:', error);
        alert('Failed to shutdown agent: ' + error.message);
    }
}



// Utility function for debouncing
function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

// Initialize when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    console.log(' DOMContentLoaded event fired');
    console.log(' USE_INLINE_AGENT_RENDERER:', window.USE_INLINE_AGENT_RENDERER);
    // Only initialize if we're on the agents tab
    if (document.getElementById('agents-view')) {
        console.log(' Found agents-view, initializing agent tab');
        initializeAgentTab();
    } else {
        console.log(' agents-view not found, skipping agent tab initialization');
    }
});

    </script>
</head>
<body>
    <div id="toast-notification"></div>
    
    <!-- Navigation -->
    <nav class="navbar">
        <div class="navbar-content">
            <div class="nav-menu">
                <!-- Mobile menu toggle removed - no longer needed -->
            </div>
            <div class="nav-actions">
                <button class="btn-text" onclick="window.location.href='/'">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                    Chat
                </button>
                <button class="sidebar-logout-btn" onclick="logout()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 21H5a2 2 0 0 1 2-2h4"></path>
                        <polyline points="16,17 21,12 16,7"></polyline>
                        <line x1="21" y1="12" x2="9" y2="12"></line>
                    </svg>
                    Logout
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <button class="tab-nav-item active" data-view="home">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                    <polyline points="9,22 9,12 15,12 15,22"></polyline>
                </svg>
                Home
            </button>
            <button class="tab-nav-item" data-view="agents">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                    <circle cx="9" cy="7" r="4"></circle>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                </svg>
                Agents
            </button>
            <button class="tab-nav-item" data-view="training">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2L2 7L12 12L22 7L12 2Z"></path>
                    <path d="M2 17L12 22L22 17"></path>
                    <path d="M2 12L12 17L22 12"></path>
                </svg>
                Training
            </button>
            <button class="tab-nav-item" data-view="models">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2L2 7L12 12L22 7L12 2Z"></path>
                    <path d="M2 17L12 22L22 17"></path>
                    <path d="M2 12L12 17L22 12"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                </svg>
                Fine-tuned Models
            </button>
            <button class="tab-nav-item" data-view="analytics">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="20" x2="18" y2="10"></line>
                    <line x1="12" y1="20" x2="12" y2="4"></line>
                    <line x1="6" y1="20" x2="6" y2="14"></line>
                </svg>
                Analytics
            </button>
            <button class="tab-nav-item" data-view="evaluation">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 12l2 2 4-4"></path>
                    <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3"></path>
                    <path d="M3 12c1 0 3-1 3-3s-2-3-3-3-3 1-3 3 2 3 3 3"></path>
                    <path d="M12 3c0 1-1 3-3 3s-3-2-3-3 1-3 3-3 3 2 3 3"></path>
                    <path d="M12 21c0-1 1-3 3-3s3 2 3 3-1 3-3 3-3-2-3-3"></path>
                </svg>
                Evaluation
            </button>
            <button class="tab-nav-item" data-view="projects">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
                    <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
                </svg>
                Projects
            </button>
            <button class="tab-nav-item" data-view="gpu-control">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                    <line x1="8" y1="21" x2="16" y2="21"></line>
                    <line x1="12" y1="17" x2="12" y2="21"></line>
                </svg>
                GPU Control
            </button>
            <button class="tab-nav-item" data-view="deployments">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                    <polyline points="3.27,6.96 12,12.01 20.73,6.96"></polyline>
                    <line x1="12" y1="22.08" x2="12" y2="12"></line>
                </svg>
                Deployments
            </button>
            <button class="tab-nav-item" data-view="billing">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="1" x2="12" y2="23"></line>
                    <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                </svg>
                Billing
            </button>
        </div>

        <div class="content-container">
                                    <!-- Professional AWS-Style Home View -->
            <div class="view-content active" id="home-view">
            
            <!-- Search Bar -->
            <div class="home-search-section">
                <div class="search-container">
                    <div class="search-input-wrapper">
                        <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="M21 21l-4.35-4.35"></path>
                        </svg>
                        <input type="text" class="search-input" placeholder="Search agents, models, jobs, projects..." />
                    </div>
                </div>
            </div>

            <!-- Primary Actions Row -->
            <div class="home-section">
                <h2 class="section-header">Get Started</h2>
                <div class="primary-actions-grid">
                    <div class="primary-action-card" onclick="navigateToGPU()">
                        <div class="card-header">
                            <div class="card-icon gpu-icon">
                                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                                    <line x1="8" y1="21" x2="16" y2="21"></line>
                                    <line x1="12" y1="17" x2="12" y2="21"></line>
                                    <circle cx="12" cy="10" r="2"></circle>
                                </svg>
                            </div>
                            <div class="card-status">
                                <span class="status-dot available"></span>
                                <span class="status-text">Available</span>
                            </div>
                        </div>
                        <div class="card-content">
                            <h3 class="card-title">Provision GPU</h3>
                            <p class="card-description">Pick GPU type, provider, and start an instance</p>
                            <div class="card-secondary-info">
                                <span class="secondary-text">Last provisioned: 1h ago</span>
                            </div>
                        </div>
                        <div class="card-footer">
                            <button class="primary-cta-btn">Provision Now</button>
                        </div>
                    </div>

                    <div class="primary-action-card" onclick="navigateToTraining()">
                        <div class="card-header">
                            <div class="card-icon training-icon">
                                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 2L2 7L12 12L22 7L12 2Z"></path>
                                    <path d="M2 17L12 22L22 17"></path>
                                    <path d="M2 12L12 17L22 12"></path>
                                    <line x1="12" y1="2" x2="12" y2="22"></line>
                                </svg>
                            </div>
                            <div class="card-status">
                                <span class="status-dot ready"></span>
                                <span class="status-text">Ready</span>
                            </div>
                        </div>
                        <div class="card-content">
                            <h3 class="card-title">Train a Model</h3>
                            <p class="card-description">Upload data, select training mode (local vs GPU), track jobs</p>
                            <div class="card-secondary-info">
                                <span class="secondary-text">3 jobs running</span>
                            </div>
                        </div>
                        <div class="card-footer">
                            <button class="primary-cta-btn">Train Now</button>
                        </div>
                    </div>

                    <div class="primary-action-card" onclick="navigateToAgentBuilder()">
                        <div class="card-header">
                            <div class="card-icon agent-icon">
                                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="9" cy="7" r="4"></circle>
                                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                    <circle cx="18" cy="8" r="2"></circle>
                                </svg>
                            </div>
                            <div class="card-status">
                                <span class="status-dot available"></span>
                                <span class="status-text">Available</span>
                            </div>
                        </div>
                        <div class="card-content">
                            <h3 class="card-title">Build an Agent</h3>
                            <p class="card-description">Create orchestration via YAML or UI, attach tools/models</p>
                            <div class="card-secondary-info">
                                <span class="secondary-text">12 agents created</span>
                            </div>
                        </div>
                        <div class="card-footer">
                            <button class="primary-cta-btn">Build Now</button>
                        </div>
                    </div>

                    <div class="primary-action-card" onclick="navigateToDeployment()">
                        <div class="card-header">
                            <div class="card-icon deploy-icon">
                                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                                    <polyline points="3.27,6.96 12,12.01 20.73,6.96"></polyline>
                                    <line x1="12" y1="22.08" x2="12" y2="12"></line>
                                    <path d="M8 12l2 2 4-4"></path>
                                </svg>
                            </div>
                            <div class="card-status">
                                <span class="status-dot ready"></span>
                                <span class="status-text">Ready</span>
                            </div>
                        </div>
                        <div class="card-content">
                            <h3 class="card-title">Deploy an Agent</h3>
                            <p class="card-description">Choose deployment mode (Chat, API, Slack, etc.)</p>
                            <div class="card-secondary-info">
                                <span class="secondary-text">5 agents deployed</span>
                            </div>
                        </div>
                        <div class="card-footer">
                            <button class="primary-cta-btn">Deploy Now</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Links / Insights Row -->
            <div class="home-section">
                <h2 class="section-header">Quick Insights</h2>
                <div class="insights-grid">
                    <div class="insight-card credit-card">
                        <div class="insight-header">
                            <div class="insight-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <path d="M12 6v6l4 2"></path>
                                </svg>
                            </div>
                            <h3 class="insight-title">Credit Balance</h3>
                        </div>
                        <div class="insight-content">
                            <div class="insight-value">$247.50</div>
                            <div class="insight-subtitle">Available credits</div>
                        </div>
                        <div class="insight-footer">
                            <button class="secondary-cta-btn">Top Up</button>
                        </div>
                    </div>

                    <div class="insight-card jobs-card">
                        <div class="insight-header">
                            <div class="insight-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                                    <line x1="8" y1="21" x2="16" y2="21"></line>
                                    <line x1="12" y1="17" x2="12" y2="21"></line>
                                </svg>
                            </div>
                            <h3 class="insight-title">Active Jobs</h3>
                        </div>
                        <div class="insight-content">
                            <div class="insight-value">7</div>
                            <div class="insight-subtitle">Running trainings/agents</div>
                        </div>
                        <div class="insight-footer">
                            <button class="secondary-cta-btn">View All</button>
                        </div>
                    </div>

                    <div class="insight-card activity-card">
                        <div class="insight-header">
                            <div class="insight-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path>
                                    <path d="M3 3v5h5"></path>
                                </svg>
                            </div>
                            <h3 class="insight-title">Recent Activity</h3>
                        </div>
                        <div class="insight-content">
                            <div class="activity-list">
                                <div class="activity-item">
                                    <span class="activity-text">GPU provisioned</span>
                                    <span class="activity-time">2m ago</span>
                                </div>
                                <div class="activity-item">
                                    <span class="activity-text">Model trained</span>
                                    <span class="activity-time">15m ago</span>
                                </div>
                                <div class="activity-item">
                                    <span class="activity-text">Agent deployed</span>
                                    <span class="activity-time">1h ago</span>
                                </div>
                            </div>
                        </div>
                        <div class="insight-footer">
                            <button class="secondary-cta-btn">View All</button>
                        </div>
                    </div>

                    <div class="insight-card cost-card">
                        <div class="insight-header">
                            <div class="insight-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="12" y1="1" x2="12" y2="23"></line>
                                    <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                                </svg>
                            </div>
                            <h3 class="insight-title">Cost Snapshot</h3>
                        </div>
                        <div class="insight-content">
                            <div class="insight-value">$89.45</div>
                            <div class="insight-subtitle">Last 7 days</div>
                            <div class="cost-trend">
                                <span class="trend-indicator positive">↗</span>
                                <span class="trend-text">+12% vs last week</span>
                            </div>
                        </div>
                        <div class="insight-footer">
                            <button class="secondary-cta-btn">View Details</button>
                        </div>
                    </div>
                </div>
            </div>
            </div>
        <!-- Agents View -->
        <div class="view-content" id="agents-view">
            
            <!-- Agent Header -->
            <div class="agent-header">
                <div class="agent-header-left">
                    <h2 class="agent-title">Agents</h2>
                    <p class="agent-subtitle">Build, manage, and monitor your AI agents</p>
                </div>
                <div class="agent-header-right">
                    <button class="btn-primary new-agent-btn" onclick="showCreateAgentModal()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        + New Agent
                    </button>
                </div>
            </div>

            <!-- Search and Filters -->
            <div class="agent-controls">
                <div class="search-section">
                    <div class="search-input-wrapper">
                        <svg class="search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="M21 21l-4.35-4.35"></path>
                        </svg>
                        <input type="text" class="search-input" placeholder="Search agents by name, description, or tags..." />
                    </div>
                </div>
                
                <div class="filters-section">
        <select class="filter-select" id="status-filter">
            <option value="">All Status</option>
            <option value="created">Created</option>
            <option value="deploying">Deploying</option>
            <option value="deployed">Deployed</option>
            <option value="idle">Idle</option>
            <option value="error">Error</option>
            <option value="stopped">Stopped</option>
        </select>
                    
                    <select class="filter-select" id="model-filter">
                        <option value="">All Models</option>
                        <option value="gpt-4o">GPT-4o</option>
                        <option value="gpt-4">GPT-4</option>
                        <option value="claude-3">Claude-3</option>
                        <option value="llama-3-70b">Llama-3-70B</option>
                    </select>
                    
                    <select class="filter-select" id="deployment-filter">
                        <option value="">All Deployments</option>
                        <option value="not-deployed">Not Deployed</option>
                        <option value="chat">Chat</option>
                        <option value="api">API</option>
                        <option value="slack">Slack</option>
                        <option value="discord">Discord</option>
                    </select>
                </div>
                
                <div class="view-toggle">
                    <button class="view-toggle-btn active" data-view="table" onclick="toggleAgentView('table')">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 3h18v18H3zM9 9h6v6H9z"></path>
                        </svg>
                    </button>
                    <button class="view-toggle-btn" data-view="grid" onclick="toggleAgentView('grid')">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="7" height="7"></rect>
                            <rect x="14" y="3" width="7" height="7"></rect>
                            <rect x="14" y="14" width="7" height="7"></rect>
                            <rect x="3" y="14" width="7" height="7"></rect>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Agent List - Table View -->
            <div class="agent-table-view" id="agent-table-view">
                <div class="table-container">
                    <table class="agent-table">
                        <thead>
                            <tr>
                                <th class="sortable" data-sort="name">Agent</th>
                                <th class="sortable" data-sort="status">Status</th>
                                <th class="sortable" data-sort="model">Model</th>
                                <th class="sortable" data-sort="embedding">Embedding</th>
                                <th class="sortable" data-sort="created-at">Created At</th>
                                <th class="sortable" data-sort="cost">Cost</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="agent-table-body">
                            <!-- Agent rows will be populated here -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Pagination Controls -->
                <div class="pagination-container" id="agent-pagination">
                    <div class="pagination-info">
                        <span id="agent-pagination-info">Showing 0 of 0 agents</span>
                    </div>
                    <div class="pagination-controls">
                        <button class="pagination-btn" id="prev-page" disabled>
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="15,18 9,12 15,6"></polyline>
                            </svg>
                            Previous
                        </button>
                        <div class="pagination-pages" id="pagination-pages">
                            <!-- Page numbers will be generated here -->
                        </div>
                        <button class="pagination-btn" id="next-page" disabled>
                            Next
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="9,18 15,12 9,6"></polyline>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Agent List - Grid View -->
            <div class="agent-grid-view" id="agent-grid-view" style="display: none;">
                <div class="agent-cards-grid" id="agent-cards-grid">
                    <!-- Agent cards will be populated here -->
                </div>
            </div>

            <!-- Loading State -->
            <div class="loading-state" id="agent-loading">
                <div class="loading-spinner"></div>
                <p>Loading agents...</p>
            </div>

            <!-- Empty State -->
            <div class="empty-state" id="agent-empty" style="display: none;">
                <div class="empty-icon">
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                </div>
                <h3>No agents found</h3>
                <p>Create your first agent to get started with RAGnetic</p>
                <button class="btn-primary" onclick="showCreateAgentModal()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    Create Your First Agent
                </button>
            </div>
        </div>

        <!-- Agent Detail Page View -->
        <div class="view-content" id="agent-detail-view">
            <div class="agent-detail-page">
                <!-- Breadcrumb Navigation -->
                <div class="breadcrumb-nav">
                    <button class="breadcrumb-btn" onclick="switchView('agents')">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                            <polyline points="9,22 9,12 15,12 15,22"></polyline>
                        </svg>
                        Agents
                    </button>
                    <span class="breadcrumb-separator">/</span>
                    <span class="breadcrumb-current" id="agent-breadcrumb-name">Agent Details</span>
                </div>

                <!-- Agent Header -->
                <div class="agent-detail-header">
                    <div class="agent-header-info">
                        <div class="agent-title-section">
                            <h1 class="agent-title" id="agent-detail-title">Agent Name</h1>
                            <div class="agent-subtitle" id="agent-detail-subtitle">Professional AI Agent</div>
                        </div>
                        <div class="agent-status-section">
                            <div class="status-pill" id="agent-detail-status">
                                <div class="status-dot"></div>
                                <span id="agent-status-text">Active</span>
                            </div>
                            <div class="status-description" id="agent-status-description">Agent is running and ready to handle requests</div>
                        </div>
                    </div>
                    <div class="agent-header-actions">
                        <button class="btn-secondary" onclick="editAgentFromDetail()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                <path d="m18.5 2.5 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                            </svg>
                            Edit Agent
                        </button>
                        <button class="btn-primary" onclick="deployAgentFromDetail()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M8 2v4"></path>
                                <path d="M16 2v4"></path>
                                <rect width="18" height="18" x="3" y="4" rx="2"></rect>
                                <path d="M3 10h18"></path>
                            </svg>
                            Deploy
                        </button>
                    </div>
                </div>

                <!-- Agent Content Grid -->
                <div class="agent-detail-content">
                    <!-- Left Column -->
                    <div class="agent-detail-left">
                        <!-- Basic Information Card -->
                        <div class="detail-card">
                            <div class="card-header">
                                <h3>Basic Information</h3>
                                <div class="card-icon">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                        <circle cx="12" cy="7" r="4"></circle>
                                    </svg>
                                </div>
                            </div>
                            <div class="card-content">
                                <div class="info-grid">
                                    <div class="info-item">
                                        <label>Name</label>
                                        <span class="info-value" id="agent-name">N/A</span>
                                    </div>
                                    <div class="info-item">
                                        <label>Display Name</label>
                                        <span class="info-value" id="agent-display-name">N/A</span>
                                    </div>
                                    <div class="info-item full-width">
                                        <label>Description</label>
                                        <span class="info-value description-text" id="agent-description">No description provided</span>
                                    </div>
                                    <div class="info-item">
                                        <label>Created</label>
                                        <span class="info-value" id="agent-created">N/A</span>
                                    </div>
                                    <div class="info-item">
                                        <label>Last Updated</label>
                                        <span class="info-value" id="agent-updated">N/A</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- AI Configuration Card -->
                        <div class="detail-card">
                            <div class="card-header">
                                <h3>AI Configuration</h3>
                                <div class="card-icon">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M9 12l2 2 4-4"></path>
                                        <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3"></path>
                                        <path d="M3 12c1 0 3-1 3-3s-2-3-3-3-3 1-3 3 2 3 3 3"></path>
                                        <path d="M12 3c0 1-1 3-3 3s-3-2-3-3 1-3 3-3 3 2 3 3"></path>
                                        <path d="M12 21c0-1 1-3 3-3s3 2 3 3-1 3-3 3-3-2-3-3"></path>
                                    </svg>
                                </div>
                            </div>
                            <div class="card-content">
                                <div class="info-grid">
                                    <div class="info-item">
                                        <label>LLM Model</label>
                                        <span class="model-badge" id="agent-llm-model">N/A</span>
                                    </div>
                                    <div class="info-item">
                                        <label>Embedding Model</label>
                                        <span class="model-badge" id="agent-embedding-model">N/A</span>
                                    </div>
                                    <div class="info-item">
                                        <label>Vector Store</label>
                                        <span class="tech-badge" id="agent-vector-store">N/A</span>
                                    </div>
                                    <div class="info-item">
                                        <label>Temperature</label>
                                        <span class="info-value" id="agent-temperature">Default (0.7)</span>
                                    </div>
                                    <div class="info-item">
                                        <label>Max Tokens</label>
                                        <span class="info-value" id="agent-max-tokens">Default (2000)</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Data Sources & Tools Card -->
                        <div class="detail-card">
                            <div class="card-header">
                                <h3>Data Sources & Tools</h3>
                                <div class="card-icon">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                        <polyline points="14,2 14,8 20,8"></polyline>
                                        <line x1="16" y1="13" x2="8" y2="13"></line>
                                        <line x1="16" y1="17" x2="8" y2="17"></line>
                                        <polyline points="10,9 9,9 8,9"></polyline>
                                    </svg>
                                </div>
                            </div>
                            <div class="card-content">
                                <div class="info-grid">
                                    <div class="info-item">
                                        <label>Data Sources</label>
                                        <span class="info-value" id="agent-sources-count">0 configured</span>
                                    </div>
                                    <div class="info-item">
                                        <label>Tools</label>
                                        <span class="info-value" id="agent-tools">None</span>
                                    </div>
                                    <div class="info-item">
                                        <label>Chunk Size</label>
                                        <span class="info-value" id="agent-chunk-size">1000 tokens</span>
                                    </div>
                                    <div class="info-item">
                                        <label>Chunk Overlap</label>
                                        <span class="info-value" id="agent-chunk-overlap">100 tokens</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column -->
                    <div class="agent-detail-right">
                        <!-- Analytics Card -->
                        <div class="detail-card">
                            <div class="card-header">
                                <h3>Analytics & Performance</h3>
                                <div class="card-icon">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="18" y1="20" x2="18" y2="10"></line>
                                        <line x1="12" y1="20" x2="12" y2="4"></line>
                                        <line x1="6" y1="20" x2="6" y2="14"></line>
                                    </svg>
                                </div>
                            </div>
                            <div class="card-content">
                                <div class="metrics-grid">
                                    <div class="metric-item">
                                        <div class="metric-label">Total Queries</div>
                                        <div class="metric-value" id="agent-total-queries">0</div>
                                    </div>
                                    <div class="metric-item">
                                        <div class="metric-label">Success Rate</div>
                                        <div class="metric-value" id="agent-success-rate">N/A</div>
                                    </div>
                                    <div class="metric-item">
                                        <div class="metric-label">Avg Response Time</div>
                                        <div class="metric-value" id="agent-avg-response">N/A</div>
                                    </div>
                                    <div class="metric-item">
                                        <div class="metric-label">Last Activity</div>
                                        <div class="metric-value" id="agent-last-activity">Never</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Cost & Billing Card -->
                        <div class="detail-card">
                            <div class="card-header">
                                <h3>Cost & Billing</h3>
                                <div class="card-icon">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="12" y1="1" x2="12" y2="23"></line>
                                        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                                    </svg>
                                </div>
                            </div>
                            <div class="card-content">
                                <div class="metrics-grid">
                                    <div class="metric-item">
                                        <div class="metric-label">This Month</div>
                                        <div class="cost-value" id="agent-monthly-cost">$0.00</div>
                                    </div>
                                    <div class="metric-item">
                                        <div class="metric-label">Total Cost</div>
                                        <div class="cost-value" id="agent-total-cost">$0.00</div>
                                    </div>
                                    <div class="metric-item">
                                        <div class="metric-label">Token Usage</div>
                                        <div class="metric-value" id="agent-token-usage">0 tokens</div>
                                    </div>
                                    <div class="metric-item">
                                        <div class="metric-label">API Calls</div>
                                        <div class="metric-value" id="agent-api-calls">0 calls</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- System Status Card -->
                        <div class="detail-card">
                            <div class="card-header">
                                <h3>System Status</h3>
                                <div class="card-icon">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M22 12h-4l-3 9L9 3l-3 9H2"></path>
                                    </svg>
                                </div>
                            </div>
                            <div class="card-content">
                                <div class="status-grid">
                                    <div class="status-item">
                                        <label>Database Status</label>
                                        <span class="status-badge" id="agent-db-status">Unknown</span>
                                    </div>
                                    <div class="status-item">
                                        <label>Vector Store</label>
                                        <span class="status-badge" id="agent-vector-status">Unknown</span>
                                    </div>
                                    <div class="status-item">
                                        <label>Offline Mode</label>
                                        <span class="status-badge" id="agent-offline-status">Unknown</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Bottom Section - YAML & Logs -->
                <div class="agent-detail-bottom">
                    <!-- YAML Configuration Card -->
                    <div class="detail-card full-width">
                        <div class="card-header">
                            <h3>YAML Configuration</h3>
                            <div class="card-actions">
                                <button class="btn-text" onclick="copyYAML()">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                    </svg>
                                    Copy
                                </button>
                                <button class="btn-text" onclick="downloadYAML()">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                        <polyline points="7,10 12,15 17,10"></polyline>
                                        <line x1="12" y1="15" x2="12" y2="3"></line>
                                    </svg>
                                    Download
                                </button>
                            </div>
                        </div>
                        <div class="card-content">
                            <div class="yaml-container">
                                <pre class="yaml-code" id="agent-yaml-content"><code>Loading YAML configuration...</code></pre>
                            </div>
                        </div>
                    </div>

                    <!-- Logs Card -->
                    <div class="detail-card full-width">
                        <div class="card-header">
                            <h3>Agent Logs</h3>
                            <div class="card-actions">
                                <button class="btn-text" onclick="refreshLogs()">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="23,4 23,10 17,10"></polyline>
                                        <polyline points="1,20 1,14 7,14"></polyline>
                                        <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"></path>
                                    </svg>
                                    Refresh
                                </button>
                                <button class="btn-text" onclick="downloadLogs()">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                        <polyline points="7,10 12,15 17,10"></polyline>
                                        <line x1="12" y1="15" x2="12" y2="3"></line>
                                    </svg>
                                    Download
                                </button>
                            </div>
                        </div>
                        <div class="card-content">
                            <div class="logs-container">
                                <div class="logs-content" id="agent-logs-content">
                                    <div class="loading-state">
                                        <div class="loading-spinner"></div>
                                        <p>Loading logs...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

<div class="view-content" id="training-view">
            
            <div class="actions-bar">
                <button class="btn-primary" onclick="showCreateTrainingJobModal()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    New Training Job
                </button>
            </div>
            
            <div class="training-grid" id="training-grid">
                <div class="list-header">Training Jobs</div>
                <div class="loading-state">
                    <div class="loading-spinner"></div>
                    <p>Loading training jobs...</p>
                </div>
            </div>
        </div>

        <!-- Fine-tuned Models View -->
        <div class="view-content" id="models-view">
            <div class="models-grid" id="models-grid">
                <div class="list-header">Fine-tuned Models</div>
                <div class="loading-state">
                    <div class="loading-spinner"></div>
                    <p>Loading fine-tuned models...</p>
                </div>
            </div>
        </div>

        <!-- Analytics View -->
        <div class="view-content" id="analytics-view">

            <!-- Analytics Sub-Tabs Navigation -->
            <div class="analytics-subtabs">
                <div class="subtab-nav">
                    <button class="subtab-btn active" data-tab="overview">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="7" height="7"></rect>
                            <rect x="14" y="3" width="7" height="7"></rect>
                            <rect x="14" y="14" width="7" height="7"></rect>
                            <rect x="3" y="14" width="7" height="7"></rect>
                        </svg>
                        Overview
                    </button>
                    <button class="subtab-btn" data-tab="costs">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                        </svg>
                        Costs
                    </button>
                    <button class="subtab-btn" data-tab="llm">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 19c-5 0-7-2-7-5s2-5 7-5 7 2 7 5-2 5-7 5z"></path>
                            <path d="M23 19c-5 0-7-2-7-5s2-5 7-5 7 2 7 5-2 5-7 5z"></path>
                        </svg>
                        LLM Analytics
                    </button>
                    <button class="subtab-btn" data-tab="agents">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"></path>
                        </svg>
                        Agent Runs
                    </button>
                    <button class="subtab-btn" data-tab="training">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 12h-4l-3 9L9 3l-3 9H2"></path>
                        </svg>
                        Training
                    </button>
                    <button class="subtab-btn" data-tab="gpu">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                            <line x1="8" y1="21" x2="16" y2="21"></line>
                            <line x1="12" y1="17" x2="12" y2="21"></line>
                        </svg>
                        GPU Analytics
                    </button>
                    <button class="subtab-btn" data-tab="evaluation">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 11H5a2 2 0 0 0-2 2v3c0 1.1.9 2 2 2h4m0-7v7m0-7h10a2 2 0 0 1 2 2v3c0 1.1-.9 2-2 2h-4m-6 0h6"></path>
                        </svg>
                        Evaluation
                    </button>
                </div>
            </div>

            <!-- Loading State -->
            <div id="analytics-loading" class="analytics-loading" style="display: none;">
                <div class="loading-spinner"></div>
                <p>Loading analytics data...</p>
            </div>

            <!-- Error State -->
            <div id="analytics-error" class="analytics-error" style="display: none;">
                <p>Failed to load analytics data. Please try again.</p>
            </div>


            <!-- Analytics Sub-Tab Content -->
            <div class="analytics-content">
                
                <!-- Overview Tab -->
                <div class="subtab-content active" id="overview-tab">
                    <!-- AWS-Style Two Column Layout -->
                    <div class="aws-layout">
                        <!-- Left Side: Tables and Metrics -->
                        <div class="left-panel">
                            <!-- Key Metrics Cards -->
                            <div class="metrics-grid">
                                <div class="metric-card primary">
                                    <div class="metric-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                        </svg>
                    </div>
                                    <div class="metric-content">
                                        <h3>Total Spend</h3>
                                        <div class="metric-value" id="total-spend">$0.00</div>
                                        <div class="metric-description">All-time spending across services</div>
                                        <div class="metric-trend" id="spend-trend">
                                            <span class="trend-indicator positive">↗</span>
                                            <span class="trend-text">+12% vs last month</span>
                    </div>
                </div>
                                </div>
                            
                                <div class="metric-card">
                                    <div class="metric-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M9 19c-5 0-7-2-7-5s2-5 7-5 7 2 7 5-2 5-7 5z"></path>
                                            <path d="M23 19c-5 0-7-2-7-5s2-5 7-5 7 2 7 5-2 5-7 5z"></path>
                        </svg>
                    </div>
                                    <div class="metric-content">
                                        <h3>API Requests</h3>
                                        <div class="metric-value" id="total-requests">0</div>
                                        <div class="metric-description">Total API calls processed</div>
                                        <div class="metric-trend" id="requests-trend">
                                            <span class="trend-indicator positive">↗</span>
                                            <span class="trend-text">+8% vs last month</span>
                    </div>
                </div>
                                </div>
                            
                                <div class="metric-card">
                                    <div class="metric-icon">
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                                            <line x1="8" y1="21" x2="16" y2="21"></line>
                                            <line x1="12" y1="17" x2="12" y2="21"></line>
                                        </svg>
                                    </div>
                                    <div class="metric-content">
                                        <h3>GPU Compute</h3>
                                        <div class="metric-value" id="gpu-hours">0h</div>
                                        <div class="metric-description">Total GPU compute hours</div>
                                        <div class="metric-trend" id="gpu-trend">
                                            <span class="trend-indicator neutral">→</span>
                                            <span class="trend-text">Stable usage</span>
                                        </div>
                                    </div>
                                </div>
                            
                                <div class="metric-card">
                                    <div class="metric-icon">
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"></path>
                                        </svg>
                                    </div>
                                    <div class="metric-content">
                                        <h3>Active Agents</h3>
                                        <div class="metric-value" id="active-agents">0</div>
                                        <div class="metric-description">Agents currently running</div>
                                        <div class="metric-trend" id="agents-trend">
                                            <span class="trend-indicator positive">↗</span>
                                            <span class="trend-text">+3 new this week</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="metric-card">
                                    <div class="metric-icon">
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <circle cx="12" cy="12" r="10"></circle>
                                            <polyline points="12,6 12,12 16,14"></polyline>
                                        </svg>
                                    </div>
                                    <div class="metric-content">
                                        <h3>Avg Response Time</h3>
                                        <div class="metric-value" id="avg-response-time">0ms</div>
                                        <div class="metric-description">Average response time</div>
                                        <div class="metric-trend" id="response-trend">
                                            <span class="trend-indicator negative">↘</span>
                                            <span class="trend-text">-15% faster</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="metric-card">
                                    <div class="metric-icon">
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M22 12h-4l-3 9L9 3l-3 9H2"></path>
                                        </svg>
                                    </div>
                                    <div class="metric-content">
                                        <h3>Success Rate</h3>
                                        <div class="metric-value" id="success-rate">0%</div>
                                        <div class="metric-description">Request completion rate</div>
                                        <div class="metric-trend" id="success-trend">
                                            <span class="trend-indicator positive">↗</span>
                                            <span class="trend-text">+2% improvement</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
            </div>

                        <!-- Overview Tables -->
                        <div class="overview-tables">
                            <div class="table-section">
                                <h3>Recent Activity</h3>
                    <div class="table-wrapper">
                                    <table class="data-table">
                            <thead>
                                <tr>
                                                <th>Time</th>
                                                <th>Agent</th>
                                                <th>Action</th>
                                                <th>Status</th>
                                                <th>Cost</th>
                                </tr>
                            </thead>
                                        <tbody id="recent-activity-table">
                                            <tr>
                                                <td>2 min ago</td>
                                                <td>Customer Support Bot</td>
                                                <td>Query Processing</td>
                                                <td><span class="status-badge success">Success</span></td>
                                                <td>$0.02</td>
                                            </tr>
                                            <tr>
                                                <td>5 min ago</td>
                                                <td>Data Analyzer</td>
                                                <td>Report Generation</td>
                                                <td><span class="status-badge success">Success</span></td>
                                                <td>$0.15</td>
                                            </tr>
                                            <tr>
                                                <td>12 min ago</td>
                                                <td>Content Generator</td>
                                                <td>Article Creation</td>
                                                <td><span class="status-badge success">Success</span></td>
                                                <td>$0.08</td>
                                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                            <div class="table-section">
                                <h3>Top Performing Agents</h3>
                    <div class="table-wrapper">
                                    <table class="data-table">
                            <thead>
                                <tr>
                                                <th>Agent Name</th>
                                                <th>Runs</th>
                                                <th>Success Rate</th>
                                                <th>Avg Response Time</th>
                                                <th>Total Cost</th>
                                </tr>
                            </thead>
                                        <tbody id="top-agents-table">
                                            <tr>
                                                <td>Customer Support Bot</td>
                                                <td>1,247</td>
                                                <td>98.5%</td>
                                                <td>1.2s</td>
                                                <td>$45.20</td>
                                            </tr>
                                            <tr>
                                                <td>Data Analyzer</td>
                                                <td>892</td>
                                                <td>96.8%</td>
                                                <td>3.4s</td>
                                                <td>$67.80</td>
                                            </tr>
                                            <tr>
                                                <td>Content Generator</td>
                                                <td>654</td>
                                                <td>94.2%</td>
                                                <td>2.1s</td>
                                                <td>$32.15</td>
                                            </tr>
                            </tbody>
                        </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Costs Tab -->
                <div class="subtab-content" id="costs-tab">
                    
                    <div class="cost-sections">
                        <!-- Total Cost Overview -->
                        <div class="cost-section">
                            <h3>Total Cost Overview</h3>
                            <div class="cost-charts">
                                <div class="chart-container large">
                    <div class="chart-header">
                                        <h4>Spending Trends</h4>
                                        <p>Daily spending breakdown across all services</p>
                    </div>
                                    <div class="chart-wrapper large">
                                        <canvas id="total-cost-chart"></canvas>
                                    </div>
                                </div>
                                <div class="chart-container medium">
                                    <div class="chart-header">
                                        <h4>Cost Distribution</h4>
                                        <p>Breakdown by service category</p>
                                    </div>
                                    <div class="chart-wrapper medium">
                                        <canvas id="cost-distribution-chart"></canvas>
                                    </div>
                                </div>
                    </div>
                </div>

                        <!-- LLM Cost Breakdown -->
                        <div class="cost-section">
                            <h3>LLM API Costs</h3>
                            <div class="cost-charts">
                                <div class="chart-container large">
                    <div class="chart-header">
                                        <h4>LLM Spending by Provider</h4>
                                        <p>Costs by OpenAI, Anthropic, and other providers</p>
                    </div>
                                    <div class="chart-wrapper large">
                                        <canvas id="llm-cost-chart"></canvas>
                                    </div>
                                </div>
                                <div class="chart-container medium">
                                    <div class="chart-header">
                                        <h4>Model Usage Costs</h4>
                                        <p>Costs by specific model (GPT-4, Claude, etc.)</p>
                                    </div>
                                    <div class="chart-wrapper medium">
                                        <canvas id="model-cost-chart"></canvas>
                                    </div>
                                </div>
                    </div>
                </div>

                        <!-- GPU Cost Breakdown -->
                        <div class="cost-section">
                            <h3> GPU Compute Costs</h3>
                            <div class="cost-charts">
                                <div class="chart-container large">
                    <div class="chart-header">
                                        <h4>GPU Spending Trends</h4>
                                        <p>Daily GPU compute costs by provider</p>
                    </div>
                                    <div class="chart-wrapper large">
                                        <canvas id="gpu-cost-chart"></canvas>
                                    </div>
                                </div>
                                <div class="chart-container medium">
                                    <div class="chart-header">
                                        <h4>GPU Cost Efficiency</h4>
                                        <p>Cost per hour by GPU type</p>
                                    </div>
                                    <div class="chart-wrapper medium">
                                        <canvas id="gpu-efficiency-chart"></canvas>
                                    </div>
                    </div>
                </div>
            </div>

                        <!-- Training Cost Breakdown -->
                        <div class="cost-section">
                            <h3>Training Costs</h3>
                            <div class="cost-charts">
                                <div class="chart-container large">
                                    <div class="chart-header">
                                        <h4>Training Job Costs</h4>
                                        <p>Costs for fine-tuning and training jobs</p>
                    </div>
                                    <div class="chart-wrapper large">
                                        <canvas id="training-cost-chart"></canvas>
                                    </div>
                                </div>
                                <div class="chart-container medium">
                                    <div class="chart-header">
                                        <h4>Training Cost per Job</h4>
                                        <p>Average cost breakdown per training job</p>
                                    </div>
                                    <div class="chart-wrapper medium">
                                        <canvas id="training-per-job-chart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Cost Tables -->
                        <div class="cost-tables">
                            <div class="table-section">
                                <h3>Cost Breakdown by Service</h3>
                    <div class="table-wrapper">
                                    <table class="data-table">
                            <thead>
                                <tr>
                                                <th>Service</th>
                                                <th>This Month</th>
                                                <th>Last Month</th>
                                                <th>Change</th>
                                                <th>Percentage</th>
                                </tr>
                            </thead>
                                        <tbody id="cost-breakdown-table">
                                            <tr>
                                                <td>LLM APIs</td>
                                                <td>$45.20</td>
                                                <td>$38.50</td>
                                                <td>+$6.70</td>
                                                <td><span class="trend-indicator positive">+17.4%</span></td>
                                            </tr>
                                            <tr>
                                                <td>GPU Compute</td>
                                                <td>$23.80</td>
                                                <td>$25.20</td>
                                                <td>-$1.40</td>
                                                <td><span class="trend-indicator negative">-5.6%</span></td>
                                            </tr>
                                            <tr>
                                                <td>Training</td>
                                                <td>$12.50</td>
                                                <td>$8.90</td>
                                                <td>+$3.60</td>
                                                <td><span class="trend-indicator positive">+40.4%</span></td>
                                            </tr>
                                            <tr>
                                                <td>Storage</td>
                                                <td>$3.20</td>
                                                <td>$2.80</td>
                                                <td>+$0.40</td>
                                                <td><span class="trend-indicator positive">+14.3%</span></td>
                                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                            <div class="table-section">
                                <h3>Daily Cost Trends</h3>
                    <div class="table-wrapper">
                                    <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                                <th>LLM Cost</th>
                                                <th>GPU Cost</th>
                                                <th>Training Cost</th>
                                                <th>Total</th>
                                </tr>
                            </thead>
                                        <tbody id="daily-cost-table">
                                            <tr>
                                                <td>Today</td>
                                                <td>$2.10</td>
                                                <td>$1.20</td>
                                                <td>$0.50</td>
                                                <td>$3.80</td>
                                            </tr>
                                            <tr>
                                                <td>Yesterday</td>
                                                <td>$1.85</td>
                                                <td>$0.95</td>
                                                <td>$0.00</td>
                                                <td>$2.80</td>
                                            </tr>
                                            <tr>
                                                <td>2 days ago</td>
                                                <td>$2.30</td>
                                                <td>$1.45</td>
                                                <td>$0.75</td>
                                                <td>$4.50</td>
                                            </tr>
                            </tbody>
                        </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- LLM Analytics Tab -->
                <div class="subtab-content" id="llm-tab">
                    
                    <div class="llm-sections">
                        <!-- Token Usage -->
                        <div class="llm-section">
                            <h3>Token Usage Analytics</h3>
                            <div class="llm-charts">
                                <div class="chart-container large">
                                    <div class="chart-header">
                                        <h4>Token Consumption Trends</h4>
                                        <p>Daily token usage across all models</p>
                    </div>
                                    <div class="chart-wrapper large">
                                        <canvas id="token-usage-chart"></canvas>
                                    </div>
                                </div>
                                <div class="chart-container medium">
                                    <div class="chart-header">
                                        <h4>Token Distribution by Model</h4>
                                        <p>Token usage breakdown by model type</p>
                                    </div>
                                    <div class="chart-wrapper medium">
                                        <canvas id="token-distribution-chart"></canvas>
                                    </div>
                                </div>
                    </div>
                </div>

                        <!-- Model Performance -->
                        <div class="llm-section">
                            <h3>⚡ Model Performance</h3>
                            <div class="llm-charts">
                                <div class="chart-container large">
                                    <div class="chart-header">
                                        <h4>Response Time by Model</h4>
                                        <p>Average response times across different models</p>
                                    </div>
                                    <div class="chart-wrapper large">
                                        <canvas id="model-response-time-chart"></canvas>
                                    </div>
                                </div>
                                <div class="chart-container medium">
                                    <div class="chart-header">
                                        <h4>Model Usage Distribution</h4>
                                        <p>Request volume by model</p>
                                    </div>
                                    <div class="chart-wrapper medium">
                                        <canvas id="model-usage-chart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Cost Efficiency -->
                        <div class="llm-section">
                            <h3>Cost Efficiency</h3>
                            <div class="llm-charts">
                                <div class="chart-container large">
                                    <div class="chart-header">
                                        <h4>Cost per Token by Model</h4>
                                        <p>Efficiency comparison across models</p>
                                    </div>
                                    <div class="chart-wrapper large">
                                        <canvas id="cost-per-token-chart"></canvas>
                                    </div>
                                </div>
                                <div class="chart-container medium">
                                    <div class="chart-header">
                                        <h4>Model ROI Analysis</h4>
                                        <p>Return on investment by model</p>
                                    </div>
                                    <div class="chart-wrapper medium">
                                        <canvas id="model-roi-chart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Agent Runs Tab -->
                <div class="subtab-content" id="agents-tab">
                    
                    <div class="agent-sections">
                        <!-- Run Statistics -->
                        <div class="agent-section">
                            <h3>Run Statistics</h3>
                            <div class="agent-charts">
                                <div class="chart-container large">
                                    <div class="chart-header">
                                        <h4>Daily Agent Runs</h4>
                                        <p>Number of agent executions over time</p>
                                    </div>
                                    <div class="chart-wrapper large">
                                        <canvas id="agent-runs-chart"></canvas>
                                    </div>
                                </div>
                                <div class="chart-container medium">
                                    <div class="chart-header">
                                        <h4>Run Success Rate</h4>
                                        <p>Success rate by agent</p>
                                    </div>
                                    <div class="chart-wrapper medium">
                                        <canvas id="agent-success-rate-chart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Performance Metrics -->
                        <div class="agent-section">
                            <h3> Performance Metrics</h3>
                            <div class="agent-charts">
                                <div class="chart-container large">
                                    <div class="chart-header">
                                        <h4>Execution Time Trends</h4>
                                        <p>Average execution time by agent</p>
                                    </div>
                                    <div class="chart-wrapper large">
                                        <canvas id="execution-time-chart"></canvas>
                                    </div>
                                </div>
                                <div class="chart-container medium">
                                    <div class="chart-header">
                                        <h4>Agent Performance Score</h4>
                                        <p>Multi-dimensional performance analysis</p>
                                    </div>
                                    <div class="chart-wrapper medium">
                                        <canvas id="agent-performance-chart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Error Analysis -->
                        <div class="agent-section">
                            <h3>🚨 Error Analysis</h3>
                            <div class="agent-charts">
                                <div class="chart-container large">
                                    <div class="chart-header">
                                        <h4>Error Rate Trends</h4>
                                        <p>Error rates over time by agent</p>
                                    </div>
                                    <div class="chart-wrapper large">
                                        <canvas id="error-rate-chart"></canvas>
                                    </div>
                                </div>
                                <div class="chart-container medium">
                                    <div class="chart-header">
                                        <h4>Error Types Distribution</h4>
                                        <p>Breakdown of error types</p>
                                    </div>
                                    <div class="chart-wrapper medium">
                                        <canvas id="error-types-chart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Training Tab -->
                <div class="subtab-content" id="training-tab">
                    
                    <div class="training-sections">
                        <!-- Training Jobs -->
                        <div class="training-section">
                        <h3>Training Jobs</h3>
                            <div class="training-charts">
                                <div class="chart-container large">
                                    <div class="chart-header">
                                        <h4>Training Job Timeline</h4>
                                        <p>Training jobs over time with status</p>
                    </div>
                                    <div class="chart-wrapper large">
                                        <canvas id="training-timeline-chart"></canvas>
                                    </div>
                                </div>
                                <div class="chart-container medium">
                                    <div class="chart-header">
                                        <h4>Job Status Distribution</h4>
                                        <p>Breakdown of job statuses</p>
                                    </div>
                                    <div class="chart-wrapper medium">
                                        <canvas id="job-status-chart"></canvas>
                                    </div>
                                </div>
                    </div>
                </div>

                        <!-- Performance Metrics -->
                        <div class="training-section">
                            <h3>Training Performance</h3>
                            <div class="training-charts">
                                <div class="chart-container large">
                                    <div class="chart-header">
                                        <h4>Training Duration Trends</h4>
                                        <p>Average training time by model size</p>
                    </div>
                                    <div class="chart-wrapper large">
                                        <canvas id="training-duration-chart"></canvas>
                    </div>
                </div>
                                <div class="chart-container medium">
                                    <div class="chart-header">
                                        <h4>Model Accuracy Improvement</h4>
                                        <p>Accuracy gains over training iterations</p>
                                    </div>
                                    <div class="chart-wrapper medium">
                                        <canvas id="accuracy-improvement-chart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Cost Analysis -->
                        <div class="training-section">
                            <h3>Training Costs</h3>
                            <div class="training-charts">
                                <div class="chart-container large">
                                    <div class="chart-header">
                                        <h4>Training Cost Trends</h4>
                                        <p>Cost per training job over time</p>
                                    </div>
                                    <div class="chart-wrapper large">
                                        <canvas id="training-cost-trends-chart"></canvas>
                                    </div>
                                </div>
                                <div class="chart-container medium">
                                    <div class="chart-header">
                                        <h4>Cost per Model Size</h4>
                                        <p>Training costs by model parameters</p>
                                    </div>
                                    <div class="chart-wrapper medium">
                                        <canvas id="cost-per-model-chart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- GPU Analytics Tab -->
                <div class="subtab-content" id="gpu-tab">
                    
                    <div class="gpu-sections">
                        <!-- Usage Analytics -->
                        <div class="gpu-section">
                            <h3>Usage Analytics</h3>
                            <div class="gpu-charts">
                                <div class="chart-container large">
                                    <div class="chart-header">
                                        <h4>GPU Compute Hours</h4>
                                        <p>Usage patterns by GPU type and provider</p>
                                    </div>
                                    <div class="chart-wrapper large">
                                        <canvas id="gpu-usage-chart"></canvas>
                                    </div>
                                </div>
                                <div class="chart-container medium">
                                    <div class="chart-header">
                                        <h4>GPU Utilization Rate</h4>
                                        <p>Average utilization by GPU type</p>
                                    </div>
                                    <div class="chart-wrapper medium">
                                        <canvas id="gpu-utilization-chart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Performance Metrics -->
                        <div class="gpu-section">
                            <h3>⚡ Performance Metrics</h3>
                            <div class="gpu-charts">
                                <div class="chart-container large">
                                    <div class="chart-header">
                                        <h4>GPU Performance Comparison</h4>
                                        <p>Throughput and efficiency by GPU type</p>
                                    </div>
                                    <div class="chart-wrapper large">
                                        <canvas id="gpu-performance-chart"></canvas>
                                    </div>
                                </div>
                                <div class="chart-container medium">
                                    <div class="chart-header">
                                        <h4>Instance Lifecycle</h4>
                                        <p>Average instance duration and patterns</p>
                                    </div>
                                    <div class="chart-wrapper medium">
                                        <canvas id="instance-lifecycle-chart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Cost Analysis -->
                        <div class="gpu-section">
                            <h3>Cost Analysis</h3>
                            <div class="gpu-charts">
                                <div class="chart-container large">
                                    <div class="chart-header">
                                        <h4>GPU Cost Trends</h4>
                                        <p>Daily GPU spending by provider</p>
                                    </div>
                                    <div class="chart-wrapper large">
                                        <canvas id="gpu-cost-trends-chart"></canvas>
                                    </div>
                                </div>
                                <div class="chart-container medium">
                                    <div class="chart-header">
                                        <h4>Cost per Compute Hour</h4>
                                        <p>Efficiency comparison by GPU type</p>
                                    </div>
                                    <div class="chart-wrapper medium">
                                        <canvas id="cost-per-hour-chart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Evaluation Tab -->
                <div class="subtab-content" id="evaluation-tab">
                    
                    <div class="evaluation-sections">
                        <!-- Benchmark Results -->
                        <div class="evaluation-section">
                            <h3>Benchmark Results</h3>
                            <div class="evaluation-charts">
                                <div class="chart-container large">
                                    <div class="chart-header">
                                        <h4>Benchmark Performance Trends</h4>
                                        <p>Performance scores over time</p>
                                    </div>
                                    <div class="chart-wrapper large">
                                        <canvas id="benchmark-performance-chart"></canvas>
                                    </div>
                                </div>
                                <div class="chart-container medium">
                                    <div class="chart-header">
                                        <h4>Model Comparison</h4>
                                        <p>Benchmark scores by model</p>
                                    </div>
                                    <div class="chart-wrapper medium">
                                        <canvas id="model-comparison-chart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Evaluation Metrics -->
                        <div class="evaluation-section">
                            <h3>Evaluation Metrics</h3>
                            <div class="evaluation-charts">
                                <div class="chart-container large">
                                    <div class="chart-header">
                                        <h4>Accuracy Trends</h4>
                                        <p>Model accuracy over time</p>
                                    </div>
                                    <div class="chart-wrapper large">
                                        <canvas id="accuracy-trends-chart"></canvas>
                                    </div>
                                </div>
                                <div class="chart-container medium">
                                    <div class="chart-header">
                                        <h4>Evaluation Score Distribution</h4>
                                        <p>Distribution of evaluation scores</p>
                                    </div>
                                    <div class="chart-wrapper medium">
                                        <canvas id="score-distribution-chart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Test Set Analysis -->
                        <div class="evaluation-section">
                            <h3>🧪 Test Set Analysis</h3>
                            <div class="evaluation-charts">
                                <div class="chart-container large">
                                    <div class="chart-header">
                                        <h4>Test Set Performance</h4>
                                        <p>Performance across different test sets</p>
                                    </div>
                                    <div class="chart-wrapper large">
                                        <canvas id="test-set-performance-chart"></canvas>
                                    </div>
                                </div>
                                <div class="chart-container medium">
                                    <div class="chart-header">
                                        <h4>Error Analysis</h4>
                                        <p>Common failure patterns</p>
                                    </div>
                                    <div class="chart-wrapper medium">
                                        <canvas id="error-analysis-chart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <!-- Evaluation View -->
        <div class="view-content" id="evaluation-view">
            <div class="evaluation-grid">
                <div class="list-header">Evaluation & Benchmarking</div>
                
                <!-- Evaluation Sub-tabs -->
                <div class="evaluation-sub-tabs">
                    <button class="sub-tab-button active" data-sub-tab="testing">Testing</button>
                    <button class="sub-tab-button" data-sub-tab="benchmarking">Benchmarking</button>
                </div>

                <!-- Testing Sub-tab -->
                <div class="sub-tab-content active" id="testing-tab">
                    <div class="testing-section">
                        <div class="section-header">
                            <h3>Test Sets</h3>
                            <div class="section-actions">
                                <button class="btn-primary" onclick="showCreateTestSetModal()">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M12 5v14M5 12h14"></path>
                                    </svg>
                                    Create Test Set
                                </button>
                                <button class="btn-text" onclick="refreshTestSets()">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path>
                                        <path d="M21 3v5h-5"></path>
                                        <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path>
                                        <path d="M3 21v-5h5"></path>
                                    </svg>
                                    Refresh
                                </button>
                            </div>
                        </div>
                        <div class="test-sets-list" id="test-sets-list">
                            <div class="loading-state">
                                <div class="loading-spinner"></div>
                                <p>Loading test sets...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Benchmarking Sub-tab -->
                <div class="sub-tab-content" id="benchmarking-tab">
                    <div class="benchmarking-section">
                        <div class="section-header">
                            <h3>Benchmark Runs</h3>
                            <div class="section-actions">
                                <button class="btn-primary" onclick="showRunBenchmarkModal()">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M9 12l2 2 4-4"></path>
                                        <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3"></path>
                                        <path d="M3 12c1 0 3-1 3-3s-2-3-3-3-3 1-3 3 2 3 3 3"></path>
                                        <path d="M12 3c0 1-1 3-3 3s-3-2-3-3 1-3 3-3 3 2 3 3"></path>
                                        <path d="M12 21c0-1 1-3 3-3s3 2 3 3-1 3-3 3-3-2-3-3"></path>
                                    </svg>
                                    Run Benchmark
                                </button>
                                <button class="btn-text" onclick="refreshBenchmarks()">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path>
                                        <path d="M21 3v5h-5"></path>
                                        <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path>
                                        <path d="M3 21v-5h5"></path>
                                    </svg>
                                    Refresh
                                </button>
                            </div>
                        </div>
                        <div class="benchmarks-list" id="benchmarks-list">
                            <div class="loading-state">
                                <div class="loading-spinner"></div>
                                <p>Loading benchmark runs...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>

        <!-- Projects View -->
        <div class="view-content" id="projects-view">
            <div class="projects-grid">
                <div class="list-header">Project Management</div>
                <div class="projects-content">
                    <div class="loading-state">
                        <div class="loading-spinner"></div>
                        <p>Loading projects...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- GPU Control View -->
        <div class="view-content" id="gpu-control-view">
            <div class="gpu-control-grid">
                <div class="list-header">
                    GPU Infrastructure Control
                    <div class="gpu-service-status-header">
                        <span class="status-badge status-unknown" id="gpu-service-badge">Loading...</span>
                        <span class="status-message" id="gpu-service-message">Checking service status...</span>
                    </div>
                </div>
                <div class="gpu-control-content">
                    <div class="loading-state">
                        <div class="loading-spinner"></div>
                        <p>Loading GPU infrastructure...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Deployments View -->
        <div class="view-content" id="deployments-view">
            <div class="deployments-grid">
                <div class="list-header">API Deployments</div>
                <div class="deployments-content">
                    <div class="loading-state">
                        <div class="loading-spinner"></div>
                        <p>Loading deployments...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Billing View -->
        <div class="view-content" id="billing-view">
            <div class="billing-grid">
                <div class="list-header">Billing & Credits</div>
                <div class="billing-content">
                    <div class="loading-state">
                        <div class="loading-spinner"></div>
                        <p>Loading billing information...</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Create Training Job Modal -->
    <div class="modal" id="create-training-job-modal">
        <div class="modal-content large">
            <div class="modal-header">
                <div class="header-content">
                    <div class="header-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2L2 7L12 12L22 7L12 2Z"></path>
                            <path d="M2 17L12 22L22 17"></path>
                            <path d="M2 12L12 17L22 12"></path>
                        </svg>
                    </div>
                    <div class="header-text">
                        <h2>Create Training Job</h2>
                        <p class="modal-subtitle">Configure and start a new LoRA fine-tuning job</p>
                    </div>
                </div>
                <button class="modal-close" onclick="hideCreateTrainingJobModal()">&times;</button>
            </div>
            
            <div class="modal-body">
                <form id="create-training-job-form">
                    <!-- Basic Configuration -->
                    <div class="form-section">
                        <div class="section-header">
                            <h3>Basic Configuration</h3>
                            <p>Set up the fundamental parameters for your training job</p>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="job-name">Job Name</label>
                                <input type="text" id="job-name" name="job_name" required placeholder="my-llama2-finetune">
                                <small>Unique identifier for this training job</small>
                            </div>
                            <div class="form-group">
                                <label for="base-model">Base Model</label>
                                <select id="base-model" name="base_model_name" required>
                                    <option value="">Select a base model...</option>
                                    <optgroup label="Small Models">
                                        <option value="TinyLlama/TinyLlama-1.1B-Chat-v1.0">TinyLlama 1.1B Chat</option>
                                        <option value="microsoft/DialoGPT-small">DialoGPT Small</option>
                                    </optgroup>
                                    <optgroup label="Medium Models">
                                        <option value="microsoft/DialoGPT-medium">DialoGPT Medium</option>
                                        <option value="facebook/blenderbot-400M-distill">BlenderBot 400M</option>
                                    </optgroup>
                                    <optgroup label="Large Models">
                                        <option value="meta-llama/Llama-2-7b-chat-hf">Llama 2 7B Chat</option>
                                        <option value="meta-llama/Llama-2-13b-chat-hf">Llama 2 13B Chat</option>
                                    </optgroup>
                                </select>
                                <small>Choose the base model to fine-tune</small>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="dataset-upload">Training Dataset *</label>
                                <div class="file-upload-container">
                                    <input type="file" id="dataset-upload" name="dataset_file" accept=".jsonl,.json" style="display: none;">
                                    <div class="file-upload-area" onclick="document.getElementById('dataset-upload').click()">
                                        <div class="file-upload-content">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                                <polyline points="7,10 12,15 17,10"></polyline>
                                                <line x1="12" y1="15" x2="12" y2="3"></line>
                                            </svg>
                                            <span class="file-upload-text">Click to upload training dataset</span>
                                            <small>JSONL or JSON format</small>
                                        </div>
                                        <div class="file-upload-selected" style="display: none;">
                                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                                <polyline points="14,2 14,8 20,8"></polyline>
                                            </svg>
                                            <span class="file-name"></span>
                                            <button type="button" class="file-remove" onclick="event.stopPropagation(); removeUploadedFile('dataset')">×</button>
                                        </div>
                                    </div>
                                    <input type="hidden" id="dataset-path" name="dataset_path">
                                </div>
                                <small>Upload a JSONL or JSON training dataset file</small>
                            </div>
                            <div class="form-group">
                                <label for="eval-dataset-upload">Evaluation Dataset</label>
                                <div class="file-upload-container">
                                    <input type="file" id="eval-dataset-upload" name="eval_dataset_file" accept=".jsonl,.json" style="display: none;">
                                    <div class="file-upload-area" onclick="document.getElementById('eval-dataset-upload').click()">
                                        <div class="file-upload-content">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                                <polyline points="7,10 12,15 17,10"></polyline>
                                                <line x1="12" y1="15" x2="12" y2="3"></line>
                                            </svg>
                                            <span class="file-upload-text">Click to upload evaluation dataset</span>
                                            <small>Optional - JSONL or JSON format</small>
                                        </div>
                                        <div class="file-upload-selected" style="display: none;">
                                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                                <polyline points="14,2 14,8 20,8"></polyline>
                                            </svg>
                                            <span class="file-name"></span>
                                            <button type="button" class="file-remove" onclick="event.stopPropagation(); removeUploadedFile('eval-dataset')">×</button>
                                        </div>
                                    </div>
                                    <input type="hidden" id="eval-dataset-path" name="eval_dataset_path">
                                </div>
                                <small>Optional evaluation dataset for validation</small>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="output-dir">Output Directory</label>
                            <input type="text" id="output-dir" name="output_base_dir" required placeholder="models/fine_tuned">
                            <small>Directory where the fine-tuned model will be saved</small>
                        </div>
                    </div>
                    
                    <!-- LoRA Configuration -->
                    <div class="form-section">
                        <div class="section-header">
                            <h3>LoRA Configuration</h3>
                            <p>Configure LoRA (Low-Rank Adaptation) parameters</p>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="lora-rank">LoRA Rank</label>
                                <input type="range" id="lora-rank" name="lora_rank" min="1" max="64" value="8" 
                                       aria-label="LoRA Rank" aria-valuemin="1" aria-valuemax="64" aria-valuenow="8"
                                       oninput="updateRangeValue('lora-rank', this.value)">
                                <div class="range-value">
                                    <span id="lora-rank-value">8</span>
                                    <small>Higher rank = more parameters, better capacity but slower training</small>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="lora-alpha">LoRA Alpha</label>
                                <input type="range" id="lora-alpha" name="lora_alpha" min="1" max="128" value="16" 
                                       aria-label="LoRA Alpha" aria-valuemin="1" aria-valuemax="128" aria-valuenow="16"
                                       oninput="updateRangeValue('lora-alpha', this.value)">
                                <div class="range-value">
                                    <span id="lora-alpha-value">16</span>
                                    <small>Scaling factor for LoRA weights</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="lora-dropout">LoRA Dropout</label>
                                <input type="range" id="lora-dropout" name="lora_dropout" min="0" max="0.5" step="0.01" value="0.05" oninput="updateRangeValue('lora-dropout', this.value)">
                                <div class="range-value">
                                    <span id="lora-dropout-value">0.05</span>
                                    <small>Dropout rate to prevent overfitting</small>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="target-modules">Target Modules</label>
                                <input type="text" id="target-modules" name="target_modules" placeholder="q_proj,v_proj,k_proj,o_proj">
                                <small>Comma-separated list of modules to apply LoRA to (leave empty for auto)</small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Training Parameters -->
                    <div class="form-section">
                        <div class="section-header">
                            <h3>Training Parameters</h3>
                            <p>Configure training hyperparameters</p>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="learning-rate">Learning Rate</label>
                                <input type="range" id="learning-rate" name="learning_rate" min="0.0001" max="0.01" step="0.0001" value="0.0002" oninput="updateRangeValue('learning-rate', this.value)">
                                <div class="range-value">
                                    <span id="learning-rate-value">0.0002</span>
                                    <small>Learning rate for the optimizer</small>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="epochs">Epochs</label>
                                <input type="range" id="epochs" name="epochs" min="1" max="10" value="3" oninput="updateRangeValue('epochs', this.value)">
                                <div class="range-value">
                                    <span id="epochs-value">3</span>
                                    <small>Number of training epochs</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="batch-size">Batch Size</label>
                                <input type="range" id="batch-size" name="batch_size" min="1" max="16" value="4" oninput="updateRangeValue('batch-size', this.value)">
                                <div class="range-value">
                                    <span id="batch-size-value">4</span>
                                    <small>Training batch size per device</small>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="gradient-accumulation">Gradient Accumulation Steps</label>
                                <input type="range" id="gradient-accumulation" name="gradient_accumulation_steps" min="1" max="16" value="1" oninput="updateRangeValue('gradient-accumulation', this.value)">
                                <div class="range-value">
                                    <span id="gradient-accumulation-value">1</span>
                                    <small>Steps to accumulate gradients before updating</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Advanced Settings -->
                    <div class="form-section">
                        <div class="section-header">
                            <h3>Advanced Settings</h3>
                            <p>Optional advanced configuration options</p>
                            <button type="button" class="btn-text" onclick="toggleAdvancedSettings()">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="6,9 12,15 18,9"></polyline>
                                </svg>
                                Toggle Advanced
                            </button>
                        </div>
                        
                        <div class="advanced-settings hidden" id="advanced-settings">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="mixed-precision">Mixed Precision</label>
                                    <select id="mixed-precision" name="mixed_precision_dtype">
                                        <option value="no">No Mixed Precision</option>
                                        <option value="fp16">FP16 (NVIDIA GPUs)</option>
                                        <option value="bf16">BF16 (Newer GPUs/Apple Silicon)</option>
                                    </select>
                                    <small>Mixed precision training for faster training and lower memory usage</small>
                                </div>
                                <div class="form-group">
                                    <label for="logging-steps">Logging Steps</label>
                                    <input type="number" id="logging-steps" name="logging_steps" min="1" max="1000" value="10">
                                    <small>How often to log training metrics</small>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="save-steps">Save Steps</label>
                                    <input type="number" id="save-steps" name="save_steps" min="100" max="10000" value="500">
                                    <small>How often to save model checkpoints</small>
                                </div>
                                <div class="form-group">
                                    <label for="save-total-limit">Max Checkpoints</label>
                                    <input type="number" id="save-total-limit" name="save_total_limit" min="1" max="10" value="1">
                                    <small>Maximum number of checkpoints to keep</small>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="cost-per-gpu-hour">Cost per GPU Hour (USD)</label>
                                <input type="number" id="cost-per-gpu-hour" name="cost_per_gpu_hour" min="0" max="10" step="0.1" value="0.5">
                                <small>Estimated cost per GPU hour for cost tracking</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="device">Device</label>
                                <select id="device" name="device">
                                    <option value="auto">Auto-detect</option>
                                    <option value="cuda">CUDA (NVIDIA GPU)</option>
                                    <option value="mps">MPS (Apple Silicon)</option>
                                    <option value="cpu">CPU</option>
                                </select>
                                <small>Training device preference</small>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            
            <div class="form-actions">
                <button type="button" class="btn-secondary" onclick="hideCreateTrainingJobModal()">Cancel</button>
                <button type="button" class="btn-primary" onclick="submitTrainingJob()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2L2 7L12 12L22 7L12 2Z"></path>
                        <path d="M2 17L12 22L22 17"></path>
                        <path d="M2 12L12 17L22 12"></path>
                    </svg>
                    Start Training Job
                </button>
            </div>
        </div>
    </div>

    <!-- Training Job Details Modal -->
    <div class="modal" id="training-job-details-modal">
        <div class="modal-content large">
            <div class="modal-header">
                <div class="header-content">
                    <div class="header-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2L2 7L12 12L22 7L12 2Z"></path>
                            <path d="M2 17L12 22L22 17"></path>
                            <path d="M2 12L12 17L22 12"></path>
                        </svg>
                    </div>
                    <div class="header-text">
                        <h2 id="job-details-title">Training Job Details</h2>
                        <p class="modal-subtitle" id="job-details-subtitle">View training progress and metrics</p>
                    </div>
                </div>
                <button class="modal-close" onclick="hideTrainingJobDetailsModal()">&times;</button>
            </div>
            
            <div class="modal-body">
                <div id="job-details-content">
                    <!-- Content will be populated by JavaScript -->
                </div>
            </div>
            
            <div class="form-actions">
                <button type="button" class="btn-secondary" onclick="hideTrainingJobDetailsModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Create Agent Modal -->
    <div class="modal" id="create-agent-modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2>Create New Agent</h2>
                <button class="modal-close" onclick="hideCreateAgentModal()">×</button>
            </div>
            
            <form id="create-agent-form">
                <!-- Basic Configuration Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>Basic Configuration</h3>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="agent-name">Agent Name *</label>
                            <input type="text" id="agent-name" name="name" required placeholder="e.g., customer-support">
                            <small>Unique identifier for your agent (lowercase, no spaces)</small>
                        </div>
                        <div class="form-group">
                            <label for="agent-display-name">Display Name *</label>
                            <input type="text" id="agent-display-name" name="display_name" required placeholder="e.g., Customer Support Agent">
                            <small>Human-readable name for your agent</small>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="agent-description">Description</label>
                        <textarea id="agent-description" name="description" rows="3" placeholder="What does this agent do? What problems does it solve?"></textarea>
                        <small>Clear description of your agent's purpose and capabilities</small>
                    </div>
                </div>

                <!-- AI Models Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>AI Models</h3>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="agent-llm-model">Language Model *</label>
                            <select id="agent-llm-model" name="llm_model" required>
                                <optgroup label="OpenAI Models">
                                    <option value="gpt-4o-mini">GPT-4o Mini (Fast & Cost-effective)</option>
                                    <option value="gpt-4o">GPT-4o (Most Capable)</option>
                                    <option value="gpt-4-turbo">GPT-4 Turbo (Balanced)</option>
                                </optgroup>
                                <optgroup label="Anthropic Models">
                                    <option value="claude-3-5-sonnet-20241022">Claude 3.5 Sonnet (Intelligent)</option>
                                    <option value="claude-3-haiku-20240307">Claude 3 Haiku (Fast)</option>
                                </optgroup>
                                <optgroup label="Google Models">
                                    <option value="gemini-1.5-pro">Gemini 1.5 Pro (Advanced)</option>
                                    <option value="gemini-1.5-flash">Gemini 1.5 Flash (Fast)</option>
                                </optgroup>
                                <optgroup label="Local Models">
                                    <option value="ollama/llama2">Ollama Llama2 (Local)</option>
                                    <option value="ollama/mistral">Ollama Mistral (Local)</option>
                                    <option value="ollama/codellama">Ollama CodeLlama (Code-focused)</option>
                                </optgroup>
                            </select>
                            <small>Select the language model that best fits your use case</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="agent-embedding-model">Embedding Model *</label>
                            <select id="agent-embedding-model" name="embedding_model" required>
                                <optgroup label="OpenAI Embeddings">
                                    <option value="text-embedding-3-small">text-embedding-3-small (Fast & Cost-effective)</option>
                                    <option value="text-embedding-3-large">text-embedding-3-large (High Quality)</option>
                                </optgroup>
                                <optgroup label="Local Embeddings">
                                    <option value="ollama/nomic-embed-text">Ollama Nomic Embed (Local)</option>
                                    <option value="ollama/all-minilm">Ollama All-MiniLM (Local)</option>
                                </optgroup>
                            </select>
                            <small>Select the embedding model for document vectorization</small>
                        </div>
                    </div>
                </div>

                <!-- Personality & Behavior Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>Personality & Behavior</h3>
                    </div>
                    
                    <div class="form-group">
                        <label for="agent-persona">Persona Prompt *</label>
                        <textarea id="agent-persona" name="persona_prompt" rows="4" required placeholder="You are a helpful AI assistant specialized in [your domain]. You should [describe behavior, tone, expertise areas]..."></textarea>
                        <small>Define your agent's personality, expertise, and communication style</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="agent-execution-prompt">Custom Execution Prompt</label>
                        <textarea id="agent-execution-prompt" name="execution_prompt" rows="4" placeholder="Use {user_query} and {retrieved_context} as placeholders. Leave empty to use default."></textarea>
                        <small>Optional custom prompt template for advanced users</small>
                    </div>
                </div>

                <!-- Chunking Configuration Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>Chunking Configuration</h3>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="chunking-mode">Chunking Mode</label>
                            <select id="chunking-mode" name="chunking_mode">
                                <option value="default">Default</option>
                                <option value="semantic">Semantic</option>
                                <option value="fixed">Fixed Size</option>
                            </select>
                            <small>How documents should be split into chunks</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="chunk-size">Chunk Size</label>
                            <input type="number" id="chunk-size" name="chunk_size" min="100" max="4000" value="1000">
                            <small>Maximum number of characters per chunk</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="chunk-overlap">Chunk Overlap</label>
                            <input type="number" id="chunk-overlap" name="chunk_overlap" min="0" max="500" value="100">
                            <small>Number of characters to overlap between chunks</small>
                        </div>
                    </div>
                </div>

                <!-- Model Parameters Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>Model Parameters</h3>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="temperature">Temperature</label>
                            <input type="range" id="temperature" name="temperature" min="0" max="2" step="0.1" value="0.7" oninput="updateRangeValue('temperature', this.value)">
                            <div class="range-value">
                                <span id="temperature-value">0.7</span>
                                <small>Controls randomness in responses (0 = deterministic, 2 = very random)</small>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="max-tokens">Max Tokens</label>
                            <input type="number" id="max-tokens" name="max_tokens" min="100" max="8000" value="2000">
                            <small>Maximum number of tokens to generate in the response (100-8000)</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="top-p">Top P (Nucleus Sampling)</label>
                            <input type="range" id="top-p" name="top_p" min="0" max="1" step="0.01" value="1" oninput="updateRangeValue('top-p', this.value)">
                            <div class="range-value">
                                <span id="top-p-value">1.0</span>
                                <small>Controls diversity via nucleus sampling (0.1 = very focused, 1.0 = most diverse)</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="llm-timeout">LLM Timeout (seconds)</label>
                            <input type="number" id="llm-timeout" name="llm_timeout" min="10" max="300" value="60">
                            <small>Timeout in seconds for LLM calls (10-300 seconds, default: 60)</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="llm-retries">LLM Retries</label>
                            <input type="number" id="llm-retries" name="llm_retries" min="0" max="5" value="0">
                            <small>Number of retry attempts for failed LLM calls (0 = no retries)</small>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="evaluation-llm-model">Evaluation LLM Model (Optional)</label>
                            <select id="evaluation-llm-model" name="evaluation_llm_model">
                                <option value="">Use same as main LLM</option>
                                <optgroup label="OpenAI Models (Recommended for Evaluation)">
                                    <option value="gpt-4o">GPT-4o (Best for LLM-as-a-Judge)</option>
                                    <option value="gpt-4o-mini">GPT-4o Mini (Fast & Cost-effective)</option>
                                    <option value="gpt-4-turbo">GPT-4 Turbo (Balanced)</option>
                                </optgroup>
                                <optgroup label="Anthropic Models">
                                    <option value="claude-3-5-sonnet-20241022">Claude 3.5 Sonnet (Intelligent)</option>
                                    <option value="claude-3-haiku-20240307">Claude 3 Haiku (Fast)</option>
                                </optgroup>
                            </select>
                            <small>Separate LLM for benchmarking, test generation, and LLM-as-a-judge evaluation tasks</small>
                        </div>
                    </div>
                </div>

                <!-- Vector Store Configuration Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>Vector Store & Retrieval</h3>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="vector-store-type">Vector Store Type</label>
                            <select id="vector-store-type" name="vector_store_type">
                                <option value="faiss">FAISS (Local, Fast)</option>
                                <option value="chroma">Chroma (Local, Feature-rich)</option>
                                <option value="qdrant">Qdrant (Local/Remote, Scalable)</option>
                                <option value="pinecone">Pinecone (Cloud, Production-ready)</option>
                                <option value="mongodb_atlas">MongoDB Atlas (Cloud, Integrated)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="retrieval-strategy">Retrieval Strategy</label>
                            <select id="retrieval-strategy" name="retrieval_strategy">
                                <option value="hybrid">Hybrid (Fast, BM25 + Semantic)</option>
                                <option value="enhanced">Enhanced (Accurate, Cross-encoder Reranking)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="bm25-k">BM25 Results (k)</label>
                            <input type="number" id="bm25-k" name="bm25_k" min="1" max="50" value="5">
                            <small>Number of keyword-based results</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="semantic-k">Semantic Results (k)</label>
                            <input type="number" id="semantic-k" name="semantic_k" min="1" max="50" value="5">
                            <small>Number of semantic similarity results</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="rerank-top-n">Rerank Top N</label>
                            <input type="number" id="rerank-top-n" name="rerank_top_n" min="1" max="50" value="5">
                            <small>Documents to rerank for accuracy</small>
                        </div>
                    </div>
                    
                    <div class="form-section-sub">
                        <div class="form-row" id="qdrant-settings" style="display: none;">
                            <div class="form-group">
                                <label for="qdrant-host">Qdrant Host</label>
                                <input type="text" id="qdrant-host" name="qdrant_host" placeholder="localhost">
                                <small>Hostname for remote Qdrant server (leave empty for local)</small>
                            </div>
                            <div class="form-group">
                                <label for="qdrant-port">Qdrant Port</label>
                                <input type="number" id="qdrant-port" name="qdrant_port" min="1" max="65535" value="6333">
                                <small>Port for Qdrant server (default: 6333)</small>
                            </div>
                        </div>
                        
                        <div class="form-row" id="pinecone-settings" style="display: none;">
                            <div class="form-group">
                                <label for="pinecone-index-name">Pinecone Index Name</label>
                                <input type="text" id="pinecone-index-name" name="pinecone_index_name" placeholder="my-index">
                                <small>Name of your Pinecone index</small>
                            </div>
                        </div>
                        
                        <div class="form-row" id="mongodb-settings" style="display: none;">
                            <div class="form-group">
                                <label for="mongodb-db-name">MongoDB Database Name</label>
                                <input type="text" id="mongodb-db-name" name="mongodb_db_name" placeholder="my_database">
                                <small>Name of the MongoDB database</small>
                            </div>
                            <div class="form-group">
                                <label for="mongodb-collection-name">MongoDB Collection Name</label>
                                <input type="text" id="mongodb-collection-name" name="mongodb_collection_name" placeholder="my_collection">
                                <small>Name of the MongoDB collection</small>
                            </div>
                            <div class="form-group">
                                <label for="mongodb-index-name">MongoDB Index Name</label>
                                <input type="text" id="mongodb-index-name" name="mongodb_index_name" value="vector_search_index">
                                <small>Name of the Atlas Vector Search index</small>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- Tools Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>Tools & Capabilities</h3>
                    </div>
                    
                    <div class="tools-grid">
                        <label class="tool-checkbox">
                            <input type="checkbox" name="tools" value="retriever" checked>
                            <div class="tool-card">
                                <div class="tool-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                        <polyline points="14,2 14,8 20,8"></polyline>
                                        <line x1="16" y1="13" x2="8" y2="13"></line>
                                        <line x1="16" y1="17" x2="8" y2="17"></line>
                                        <polyline points="10,9 9,9 8,9"></polyline>
                                    </svg>
                                </div>
                                <div class="tool-info">
                                    <h4>Document Loader & Retriever</h4>
                                    <p>Load, process, and retrieve information from your data sources</p>
                                </div>
                            </div>
                        </label>
                        
                        <label class="tool-checkbox">
                            <input type="checkbox" name="tools" value="search_engine">
                            <div class="tool-card">
                                <div class="tool-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                    </svg>
                                </div>
                                <div class="tool-info">
                                    <h4>Web Search</h4>
                                    <p>Search the internet for real-time information</p>
                                </div>
                            </div>
                        </label>
                        
                        <label class="tool-checkbox">
                            <input type="checkbox" name="tools" value="api_toolkit">
                            <div class="tool-card">
                                <div class="tool-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path>
                                    </svg>
                                </div>
                                <div class="tool-info">
                                    <h4>API Toolkit</h4>
                                    <p>Make API calls to external services</p>
                                </div>
                            </div>
                        </label>
                        
                        <label class="tool-checkbox">
                            <input type="checkbox" name="tools" value="sql_toolkit">
                            <div class="tool-card">
                                <div class="tool-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                        <path d="M14 2v6h6"></path>
                                        <path d="M16 13H8"></path>
                                        <path d="M16 17H8"></path>
                                        <path d="M10 9H8"></path>
                                    </svg>
                                </div>
                                <div class="tool-info">
                                    <h4>SQL Database</h4>
                                    <p>Query and analyze database information</p>
                                </div>
                            </div>
                        </label>
                        
                        <label class="tool-checkbox">
                            <input type="checkbox" name="tools" value="arxiv">
                            <div class="tool-card">
                                <div class="tool-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                        <polyline points="14,2 14,8 20,8"></polyline>
                                        <line x1="16" y1="13" x2="8" y2="13"></line>
                                        <line x1="16" y1="17" x2="8" y2="17"></line>
                                        <polyline points="10,9 9,9 8,9"></polyline>
                                    </svg>
                                </div>
                                <div class="tool-info">
                                    <h4>ArXiv Search</h4>
                                    <p>Search academic papers and research on ArXiv</p>
                                </div>
                            </div>
                        </label>
                        
                        <label class="tool-checkbox">
                            <input type="checkbox" name="tools" value="lambda_tool">
                            <div class="tool-card">
                                <div class="tool-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="4,17 10,11 4,5"></polyline>
                                        <line x1="12" y1="19" x2="20" y2="19"></line>
                                    </svg>
                                </div>
                                <div class="tool-info">
                                    <h4>Lambda Tool</h4>
                                    <p>Execute custom code in a sandboxed environment</p>
                                </div>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- Data Sources Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>Data Sources</h3>
                        <button type="button" class="btn-secondary btn-sm" onclick="addDataSource()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            Add Data Source
                        </button>
                    </div>
                    
                    <div id="data-sources-container">
                        <!-- Data sources will be added here dynamically -->
                        <div class="empty-state">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14,2 14,8 20,8"></polyline>
                                <line x1="16" y1="13" x2="8" y2="13"></line>
                                <line x1="16" y1="17" x2="8" y2="17"></line>
                                <polyline points="10,9 9,9 8,9"></polyline>
                            </svg>
                            <p>No data sources configured</p>
                            <small>Your agent will start with general knowledge only</small>
                        </div>
                    </div>
                </div>

                <!-- Data Policies Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>Data Security & Privacy</h3>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="pii-redaction">PII Redaction</label>
                            <select id="pii-redaction" name="pii_redaction">
                                <option value="none">None</option>
                                <option value="basic">Basic (Email, Phone)</option>
                                <option value="comprehensive">Comprehensive (Email, Phone, SSN, Credit Card, Names)</option>
                            </select>
                            <small>Automatically redact personally identifiable information</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="keyword-filtering">Keyword Filtering</label>
                            <input type="text" id="keyword-filtering" name="keyword_filtering" placeholder="sensitive, confidential, private">
                            <small>Comma-separated keywords to filter or redact</small>
                        </div>
                    </div>
                </div>

                <!-- Scaling & Performance Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>Scaling & Performance</h3>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="parallel-ingestion">Parallel Ingestion</label>
                            <div class="toggle-switch">
                                <input type="checkbox" id="parallel-ingestion" name="parallel_ingestion">
                                <span class="slider"></span>
                            </div>
                            <small>Enable parallel processing for faster data ingestion</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="ingestion-workers">Ingestion Workers</label>
                            <input type="number" id="ingestion-workers" name="ingestion_workers" min="1" max="16" value="4">
                            <small>Number of parallel workers (defaults to CPU count)</small>
                        </div>
                    </div>
                </div>

                <!-- Advanced Configuration Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>Advanced Configuration</h3>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="max-context-docs">Max Context Documents</label>
                            <input type="number" id="max-context-docs" name="max_context_docs" min="1" max="100" value="20">
                            <small>Maximum number of retrieved documents to include in context (1-100)</small>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="reproducible-ids">Reproducible IDs</label>
                            <div class="toggle-switch">
                                <input type="checkbox" id="reproducible-ids" name="reproducible_ids" checked>
                                <span class="slider"></span>
                            </div>
                            <small>Generate IDs based on content hash for reproducibility (recommended for testing)</small>
                        </div>
                    </div>
                </div>

                <!-- Benchmark Configuration Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>Benchmark & Evaluation Settings</h3>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="context-window-tokens">Context Window Tokens</label>
                            <input type="number" id="context-window-tokens" name="context_window_tokens" min="1000" max="200000" value="8000">
                            <small>Total model context window used for budgeting (1000-200000 tokens, default: 8000)</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="context-budget-ratio">Context Budget Ratio</label>
                            <input type="range" id="context-budget-ratio" name="context_budget_ratio" min="0.1" max="0.95" step="0.05" value="0.70" oninput="updateRangeValue('context-budget-ratio', this.value)">
                            <div class="range-value">
                                <span id="context-budget-ratio-value">0.70</span>
                                <small>Fraction of window allocated to retrieved context (0.1-0.95, default: 0.70)</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="answer-reserve-tokens">Answer Reserve Tokens</label>
                            <input type="number" id="answer-reserve-tokens" name="answer_reserve_tokens" min="100" max="8000" value="1024">
                            <small>Tokens reserved for the model's answer during benchmarking (100-8000, default: 1024)</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="enable-doc-truncation">Enable Document Truncation</label>
                            <select id="enable-doc-truncation" name="enable_doc_truncation">
                                <option value="true">Yes (Recommended)</option>
                                <option value="false">No</option>
                            </select>
                            <small>Truncate retrieved docs to fit within the budget (recommended for large documents)</small>
                        </div>
                    </div>
                </div>

                <!-- GPU Configuration Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>GPU Configuration</h3>
                        <p>Configure GPU acceleration for your agent (optional)</p>
                    </div>
                    
                    <div id="gpu-config-container">
                        <!-- GPU configuration will be rendered here -->
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="hideCreateAgentModal()">Cancel</button>
                    <button type="submit" class="btn-primary">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 12l2 2 4-4"></path>
                            <path d="M21 12c-1 0-2-1-2-2s1-2 2-2 2 1 2 2-1 2-2 2z"></path>
                            <path d="M3 12c1 0 2-1 2-2s-1-2-2-2-2 1-2 2 1 2 2 2z"></path>
                            <path d="M12 3c0 1-1 2-2 2s-2 1-2 2 1 1 2 2 2 1 2 2 1-1 2-2 2-1 2-2-1-1-2-2-2-1-2-2z"></path>
                        </svg>
                        Create Agent
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Agent Modal -->
    <div class="modal" id="edit-agent-modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2>Edit Agent</h2>
                <button class="modal-close" onclick="hideEditAgentModal()">×</button>
            </div>
            
            <form id="edit-agent-form">
                <!-- Basic Configuration Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>Basic Configuration</h3>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-agent-name">Agent Name *</label>
                            <input type="text" id="edit-agent-name" name="name" required readonly>
                            <small>Agent name cannot be changed</small>
                        </div>
                        <div class="form-group">
                            <label for="edit-agent-display-name">Display Name *</label>
                            <input type="text" id="edit-agent-display-name" name="display_name" required>
                            <small>Human-readable name for your agent</small>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-agent-description">Description</label>
                        <textarea id="edit-agent-description" name="description" rows="3"></textarea>
                        <small>Clear description of your agent's purpose and capabilities</small>
                    </div>
                </div>

                <!-- AI Models Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>AI Models</h3>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-agent-llm-model">Language Model *</label>
                            <select id="edit-agent-llm-model" name="llm_model" required>
                                <optgroup label="OpenAI Models">
                                    <option value="gpt-4o-mini">GPT-4o Mini (Fast & Cost-effective)</option>
                                    <option value="gpt-4o">GPT-4o (Most Capable)</option>
                                    <option value="gpt-4-turbo">GPT-4 Turbo (Balanced)</option>
                                </optgroup>
                                <optgroup label="Anthropic Models">
                                    <option value="claude-3-5-sonnet-20241022">Claude 3.5 Sonnet (Intelligent)</option>
                                    <option value="claude-3-haiku-20240307">Claude 3 Haiku (Fast)</option>
                                </optgroup>
                                <optgroup label="Google Models">
                                    <option value="gemini-1.5-pro">Gemini 1.5 Pro (Advanced)</option>
                                    <option value="gemini-1.5-flash">Gemini 1.5 Flash (Fast)</option>
                                </optgroup>
                                <optgroup label="Local Models">
                                    <option value="ollama/llama2">Ollama Llama2 (Local)</option>
                                    <option value="ollama/mistral">Ollama Mistral (Local)</option>
                                    <option value="ollama/codellama">Ollama CodeLlama (Code-focused)</option>
                                </optgroup>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="edit-agent-embedding-model">Embedding Model *</label>
                            <select id="edit-agent-embedding-model" name="embedding_model" required>
                                <optgroup label="OpenAI Embeddings">
                                    <option value="text-embedding-3-small">text-embedding-3-small (Fast & Cost-effective)</option>
                                    <option value="text-embedding-3-large">text-embedding-3-large (High Quality)</option>
                                </optgroup>
                                <optgroup label="Local Embeddings">
                                    <option value="ollama/nomic-embed-text">Ollama Nomic Embed (Local)</option>
                                    <option value="ollama/all-minilm">Ollama All-MiniLM (Local)</option>
                                </optgroup>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Personality & Behavior Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>Personality & Behavior</h3>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-agent-persona">Persona Prompt *</label>
                        <textarea id="edit-agent-persona" name="persona_prompt" rows="4" required></textarea>
                        <small>Define your agent's personality, expertise, and communication style</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-agent-execution-prompt">Custom Execution Prompt</label>
                        <textarea id="edit-agent-execution-prompt" name="execution_prompt" rows="4"></textarea>
                        <small>Optional custom prompt template for advanced users</small>
                    </div>
                </div>

                <!-- Chunking Configuration Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>Chunking Configuration</h3>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-chunking-mode">Chunking Mode</label>
                            <select id="edit-chunking-mode" name="chunking_mode">
                                <option value="default">Default</option>
                                <option value="semantic">Semantic</option>
                                <option value="fixed">Fixed Size</option>
                            </select>
                            <small>How documents should be split into chunks</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="edit-chunk-size">Chunk Size</label>
                            <input type="number" id="edit-chunk-size" name="chunk_size" min="100" max="4000" value="1000">
                            <small>Maximum number of characters per chunk</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="edit-chunk-overlap">Chunk Overlap</label>
                            <input type="number" id="edit-chunk-overlap" name="chunk_overlap" min="0" max="500" value="100">
                            <small>Number of characters to overlap between chunks</small>
                        </div>
                    </div>
                </div>

                <!-- Vector Store Configuration Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>Vector Store & Retrieval</h3>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-vector-store-type">Vector Store Type</label>
                            <select id="edit-vector-store-type" name="vector_store_type">
                                <option value="faiss">FAISS (Local, Fast)</option>
                                <option value="chroma">Chroma (Local, Feature-rich)</option>
                                <option value="qdrant">Qdrant (Local/Remote, Scalable)</option>
                                <option value="pinecone">Pinecone (Cloud, Production-ready)</option>
                                <option value="mongodb_atlas">MongoDB Atlas (Cloud, Integrated)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="edit-retrieval-strategy">Retrieval Strategy</label>
                            <select id="edit-retrieval-strategy" name="retrieval_strategy">
                                <option value="hybrid">Hybrid (Fast, BM25 + Semantic)</option>
                                <option value="enhanced">Enhanced (Accurate, Cross-encoder Reranking)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-bm25-k">BM25 Results (k)</label>
                            <input type="number" id="edit-bm25-k" name="bm25_k" min="1" max="50" value="5">
                        </div>
                        
                        <div class="form-group">
                            <label for="edit-semantic-k">Semantic Results (k)</label>
                            <input type="number" id="edit-semantic-k" name="semantic_k" min="1" max="50" value="5">
                        </div>
                        
                        <div class="form-group">
                            <label for="edit-rerank-top-n">Rerank Top N</label>
                            <input type="number" id="edit-rerank-top-n" name="rerank_top_n" min="1" max="50" value="5">
                            <small>Documents to rerank for accuracy</small>
                        </div>
                    </div>
                    
                    <div class="form-section-sub">
                        <div class="form-row" id="edit-qdrant-settings" style="display: none;">
                            <div class="form-group">
                                <label for="edit-qdrant-host">Qdrant Host</label>
                                <input type="text" id="edit-qdrant-host" name="qdrant_host" placeholder="localhost">
                                <small>Hostname for remote Qdrant server (leave empty for local)</small>
                            </div>
                            <div class="form-group">
                                <label for="edit-qdrant-port">Qdrant Port</label>
                                <input type="number" id="edit-qdrant-port" name="qdrant_port" min="1" max="65535" value="6333">
                                <small>Port for Qdrant server (default: 6333)</small>
                            </div>
                        </div>
                        
                        <div class="form-row" id="edit-pinecone-settings" style="display: none;">
                            <div class="form-group">
                                <label for="edit-pinecone-index-name">Pinecone Index Name</label>
                                <input type="text" id="edit-pinecone-index-name" name="pinecone_index_name" placeholder="my-index">
                                <small>Name of your Pinecone index</small>
                            </div>
                        </div>
                        
                        <div class="form-row" id="edit-mongodb-settings" style="display: none;">
                            <div class="form-group">
                                <label for="edit-mongodb-db-name">MongoDB Database Name</label>
                                <input type="text" id="edit-mongodb-db-name" name="mongodb_db_name" placeholder="my_database">
                                <small>Name of the MongoDB database</small>
                            </div>
                            <div class="form-group">
                                <label for="edit-mongodb-collection-name">MongoDB Collection Name</label>
                                <input type="text" id="edit-mongodb-collection-name" name="mongodb_collection_name" placeholder="my_collection">
                                <small>Name of the MongoDB collection</small>
                            </div>
                            <div class="form-group">
                                <label for="edit-mongodb-index-name">MongoDB Index Name</label>
                                <input type="text" id="edit-mongodb-index-name" name="mongodb_index_name" value="vector_search_index">
                                <small>Name of the Atlas Vector Search index</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Model Parameters Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>Model Parameters</h3>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-temperature">Temperature</label>
                            <input type="range" id="edit-temperature" name="temperature" min="0" max="2" step="0.1" value="0.7" oninput="updateRangeValue('edit-temperature', this.value)">
                            <div class="range-value">
                                <span id="edit-temperature-value">0.7</span>
                                <small>Controls randomness in responses (0 = deterministic, 2 = very random)</small>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="edit-max-tokens">Max Tokens</label>
                            <input type="number" id="edit-max-tokens" name="max_tokens" min="100" max="8000" value="2000">
                            <small>Maximum number of tokens to generate in the response (100-8000)</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="edit-top-p">Top P (Nucleus Sampling)</label>
                            <input type="range" id="edit-top-p" name="top_p" min="0" max="1" step="0.01" value="1" oninput="updateRangeValue('edit-top-p', this.value)">
                            <div class="range-value">
                                <span id="edit-top-p-value">1.0</span>
                                <small>Controls diversity via nucleus sampling (0.1 = very focused, 1.0 = most diverse)</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-llm-timeout">LLM Timeout (seconds)</label>
                            <input type="number" id="edit-llm-timeout" name="llm_timeout" min="10" max="300" value="60">
                            <small>Timeout in seconds for LLM calls (10-300 seconds, default: 60)</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="edit-llm-retries">LLM Retries</label>
                            <input type="number" id="edit-llm-retries" name="llm_retries" min="0" max="5" value="0">
                            <small>Number of retry attempts for failed LLM calls (0 = no retries)</small>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-evaluation-llm-model">Evaluation LLM Model (Optional)</label>
                            <select id="edit-evaluation-llm-model" name="evaluation_llm_model">
                                <option value="">Use same as main LLM</option>
                                <optgroup label="OpenAI Models (Recommended for Evaluation)">
                                    <option value="gpt-4o">GPT-4o (Best for LLM-as-a-Judge)</option>
                                    <option value="gpt-4o-mini">GPT-4o Mini (Fast & Cost-effective)</option>
                                    <option value="gpt-4-turbo">GPT-4 Turbo (Balanced)</option>
                                </optgroup>
                                <optgroup label="Anthropic Models">
                                    <option value="claude-3-5-sonnet-20241022">Claude 3.5 Sonnet (Intelligent)</option>
                                    <option value="claude-3-haiku-20240307">Claude 3 Haiku (Fast)</option>
                                </optgroup>
                            </select>
                            <small>Separate LLM for benchmarking, test generation, and LLM-as-a-judge evaluation tasks</small>
                        </div>
                    </div>
                </div>

                <!-- Tools Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>Tools & Capabilities</h3>
                    </div>
                    
                    <div class="tools-grid">
                        <label class="tool-checkbox">
                            <input type="checkbox" name="edit-tools" value="retriever">
                            <div class="tool-card">
                                <div class="tool-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                        <polyline points="14,2 14,8 20,8"></polyline>
                                        <line x1="16" y1="13" x2="8" y2="13"></line>
                                        <line x1="16" y1="17" x2="8" y2="17"></line>
                                        <polyline points="10,9 9,9 8,9"></polyline>
                                    </svg>
                                </div>
                                <div class="tool-info">
                                    <h4>Document Loader & Retriever</h4>
                                    <p>Load, process, and retrieve information from your data sources</p>
                                </div>
                            </div>
                        </label>
                        
                        <label class="tool-checkbox">
                            <input type="checkbox" name="edit-tools" value="search_engine">
                            <div class="tool-card">
                                <div class="tool-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                    </svg>
                                </div>
                                <div class="tool-info">
                                    <h4>Web Search</h4>
                                    <p>Search the internet for real-time information</p>
                                </div>
                            </div>
                        </label>
                        
                        <label class="tool-checkbox">
                            <input type="checkbox" name="edit-tools" value="api_toolkit">
                            <div class="tool-card">
                                <div class="tool-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path>
                                    </svg>
                                </div>
                                <div class="tool-info">
                                    <h4>API Toolkit</h4>
                                    <p>Make API calls to external services</p>
                                </div>
                            </div>
                        </label>
                        
                        <label class="tool-checkbox">
                            <input type="checkbox" name="edit-tools" value="sql_toolkit">
                            <div class="tool-card">
                                <div class="tool-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                        <path d="M14 2v6h6"></path>
                                        <path d="M16 13H8"></path>
                                        <path d="M16 17H8"></path>
                                        <path d="M10 9H8"></path>
                                    </svg>
                                </div>
                                <div class="tool-info">
                                    <h4>SQL Database</h4>
                                    <p>Query and analyze database information</p>
                                </div>
                            </div>
                        </label>
                        
                        <label class="tool-checkbox">
                            <input type="checkbox" name="edit-tools" value="arxiv">
                            <div class="tool-card">
                                <div class="tool-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                        <polyline points="14,2 14,8 20,8"></polyline>
                                        <line x1="16" y1="13" x2="8" y2="13"></line>
                                        <line x1="16" y1="17" x2="8" y2="17"></line>
                                        <polyline points="10,9 9,9 8,9"></polyline>
                                    </svg>
                                </div>
                                <div class="tool-info">
                                    <h4>ArXiv Search</h4>
                                    <p>Search academic papers and research on ArXiv</p>
                                </div>
                            </div>
                        </label>
                        
                        <label class="tool-checkbox">
                            <input type="checkbox" name="edit-tools" value="lambda_tool">
                            <div class="tool-card">
                                <div class="tool-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="4,17 10,11 4,5"></polyline>
                                        <line x1="12" y1="19" x2="20" y2="19"></line>
                                    </svg>
                                </div>
                                <div class="tool-info">
                                    <h4>Lambda Tool</h4>
                                    <p>Execute custom code in a sandboxed environment</p>
                                </div>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- Data Sources Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>Data Sources</h3>
                        <button type="button" class="btn-secondary btn-sm" onclick="addEditDataSource()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            Add Data Source
                        </button>
                    </div>
                    
                    <div id="edit-data-sources-container">
                        <!-- Data sources will be added here dynamically -->
                        <div class="empty-state">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14,2 14,8 20,8"></polyline>
                                <line x1="16" y1="13" x2="8" y2="13"></line>
                                <line x1="16" y1="17" x2="8" y2="17"></line>
                                <polyline points="10,9 9,9 8,9"></polyline>
                            </svg>
                            <p>No data sources configured</p>
                            <small>Your agent will start with general knowledge only</small>
                        </div>
                    </div>
                </div>

                <!-- Data Policies Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>Data Security & Privacy</h3>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-pii-redaction">PII Redaction</label>
                            <select id="edit-pii-redaction" name="pii_redaction">
                                <option value="none">None</option>
                                <option value="basic">Basic (Email, Phone)</option>
                                <option value="comprehensive">Comprehensive (Email, Phone, SSN, Credit Card, Names)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="edit-keyword-filtering">Keyword Filtering</label>
                            <input type="text" id="edit-keyword-filtering" name="keyword_filtering" placeholder="sensitive, confidential, private">
                        </div>
                    </div>
                </div>

                <!-- Scaling & Performance Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>Scaling & Performance</h3>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-parallel-ingestion">Parallel Ingestion</label>
                            <div class="toggle-switch">
                                <input type="checkbox" id="edit-parallel-ingestion" name="parallel_ingestion">
                                <span class="slider"></span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="edit-ingestion-workers">Ingestion Workers</label>
                            <input type="number" id="edit-ingestion-workers" name="ingestion_workers" min="1" max="16" value="4">
                            <small>Number of parallel workers (defaults to CPU count)</small>
                        </div>
                    </div>
                </div>

                <!-- Advanced Configuration Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>Advanced Configuration</h3>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-max-context-docs">Max Context Documents</label>
                            <input type="number" id="edit-max-context-docs" name="max_context_docs" min="1" max="100" value="20">
                            <small>Maximum number of retrieved documents to include in context (1-100)</small>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-reproducible-ids">Reproducible IDs</label>
                            <div class="toggle-switch">
                                <input type="checkbox" id="edit-reproducible-ids" name="reproducible_ids" checked>
                                <span class="slider"></span>
                            </div>
                            <small>Generate IDs based on content hash for reproducibility (recommended for testing)</small>
                        </div>
                    </div>
                </div>

                <!-- Benchmark Configuration Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>Benchmark & Evaluation Settings</h3>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-context-window-tokens">Context Window Tokens</label>
                            <input type="number" id="edit-context-window-tokens" name="context_window_tokens" min="1000" max="200000" value="8000">
                            <small>Total model context window used for budgeting (1000-200000 tokens, default: 8000)</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="edit-context-budget-ratio">Context Budget Ratio</label>
                            <input type="range" id="edit-context-budget-ratio" name="context_budget_ratio" min="0.1" max="0.95" step="0.05" value="0.70" oninput="updateRangeValue('edit-context-budget-ratio', this.value)">
                            <div class="range-value">
                                <span id="edit-context-budget-ratio-value">0.70</span>
                                <small>Fraction of window allocated to retrieved context (0.1-0.95, default: 0.70)</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-answer-reserve-tokens">Answer Reserve Tokens</label>
                            <input type="number" id="edit-answer-reserve-tokens" name="answer_reserve_tokens" min="100" max="8000" value="1024">
                            <small>Tokens reserved for the model's answer during benchmarking (100-8000, default: 1024)</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="edit-enable-doc-truncation">Enable Document Truncation</label>
                            <select id="edit-enable-doc-truncation" name="enable_doc_truncation">
                                <option value="true">Yes (Recommended)</option>
                                <option value="false">No</option>
                            </select>
                            <small>Truncate retrieved docs to fit within the budget (recommended for large documents)</small>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="hideEditAgentModal()">Cancel</button>
                    <button type="submit" class="btn-primary">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 12l2 2 4-4"></path>
                            <path d="M21 12c-1 0-2-1-2-2s1-2 2-2 2 1 2 2-1 2-2 2z"></path>
                            <path d="M3 12c1 0 2-1 2-2s-1-2-2-2-2 1-2 2 1 2 2 2z"></path>
                            <path d="M12 3c0 1-1 2-2 2s-2 1-2 2 1 1 2 2 2 1 2 2 1-1 2-2 2-1 2-2-1-1-2-2-2-1-2-2z"></path>
                        </svg>
                        Update Agent
                    </button>
                </div>
            </form>
        </div>
    </div>


    <!-- Agent Details Modal -->
    <div class="modal" id="agent-details-modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2 id="agent-details-title">Agent Details</h2>
                <button class="modal-close" onclick="hideAgentDetailsModal()">×</button>
            </div>
            <div class="modal-body" id="agent-details-content">
                <div class="loading-state">
                    <div class="loading-spinner"></div>
                    <p>Loading agent details...</p>
                </div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>


    <!-- Delete Confirmation Modal -->
    <div class="modal" id="delete-confirmation-modal">
        <div class="modal-content delete-modal">
            <div class="modal-header">
                <div class="header-content">
                    <div class="header-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6M10 11v6M14 11v6"/>
                        </svg>
                    </div>
                    <div class="header-text">
                        <h2>Delete Agent</h2>
                        <p class="modal-subtitle">This action cannot be undone</p>
                    </div>
                </div>
                <button class="modal-close" onclick="hideDeleteConfirmationModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="confirmation-content">
                    <div class="confirmation-icon">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <circle cx="12" cy="12" r="10" fill="rgba(239, 68, 68, 0.1)" stroke="rgba(239, 68, 68, 0.3)"></circle>
                            <path d="M15 9l-6 6M9 9l6 6" stroke="var(--error-color)" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                    </div>
                    <div class="confirmation-text">
                        <h3>Are you sure you want to delete <span id="delete-agent-name" class="agent-name-highlight"></span>?</h3>
                        <p>This will permanently remove the agent configuration, vector store, and all associated data. This action cannot be undone.</p>
                        <div class="warning-details">
                            <div class="warning-item">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 9v4M12 17h.01"/>
                                </svg>
                                <span>Agent configuration will be deleted</span>
                            </div>
                            <div class="warning-item">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 9v4M12 17h.01"/>
                                </svg>
                                <span>Vector store and embeddings will be removed</span>
                            </div>
                            <div class="warning-item">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 9v4M12 17h.01"/>
                                </svg>
                                <span>Chat history and sessions will remain accessible</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" onclick="hideDeleteConfirmationModal()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                    Cancel
                </button>
                <button type="button" class="btn-danger-confirm" onclick="confirmDeleteAgent()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6M10 11v6M14 11v6"/>
                    </svg>
                    Delete Agent
                </button>
            </div>
        </div>
    </div>

    <!-- Model Details Modal -->
    <div class="modal" id="model-details-modal">
        <div class="modal-content large">
            <div class="modal-header">
                <div class="header-content">
                    <div class="header-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2L2 7L12 12L22 7L12 2Z"></path>
                            <path d="M2 17L12 22L22 17"></path>
                            <path d="M2 12L12 17L22 12"></path>
                            <circle cx="12" cy="12" r="3"></circle>
                        </svg>
                    </div>
                    <div class="header-text">
                        <h2 id="model-details-title">Model Details</h2>
                        <p id="model-details-subtitle">Loading...</p>
                    </div>
                </div>
                <button type="button" class="modal-close" onclick="hideModelDetailsModal()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div id="model-details-content">
                    <div class="loading-state">
                        <div class="loading-spinner"></div>
                        <p>Loading model details...</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>

    <!-- Run Details Modal -->
    <div class="modal" id="run-details-modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2 id="run-details-title">Run Details</h2>
                <button class="modal-close" onclick="hideRunDetailsModal()">×</button>
            </div>
            <div class="modal-body">
                <div id="run-details-content">
                    <div class="loading-state">
                        <div class="loading-spinner"></div>
                        <p>Loading run details...</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer"></div>
        </div>
    </div>

    <!-- Create Test Set Modal -->
    <div class="modal" id="create-test-set-modal">
        <div class="modal-content large">
            <div class="modal-header">
                <div class="header-content">
                    <div class="header-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 12l2 2 4-4"></path>
                            <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3"></path>
                            <path d="M3 12c1 0 3-1 3-3s-2-3-3-3-3 1-3 3 2 3 3 3"></path>
                            <path d="M12 3c0 1-1 3-3 3s-3-2-3-3 1-3 3-3 3 2 3 3"></path>
                            <path d="M12 21c0-1 1-3 3-3s3 2 3 3-1 3-3 3-3-2-3-3"></path>
                        </svg>
                    </div>
                    <div class="header-text">
                        <h2>Create Test Set</h2>
                        <p class="modal-subtitle">Generate a new evaluation test set for benchmarking</p>
                    </div>
                </div>
                <button class="modal-close" onclick="hideCreateTestSetModal()">&times;</button>
            </div>
            
            <div class="modal-body">
                <form id="create-test-set-form">
                    <div class="form-section">
                        <div class="section-header">
                            <h3>Test Set Configuration</h3>
                            <p>Configure the parameters for generating your test set</p>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="test-set-agent">Agent</label>
                                <select id="test-set-agent" name="agent_name" required>
                                    <option value="">Select an agent...</option>
                                </select>
                                <small>Choose the agent to generate test questions for</small>
                            </div>
                            <div class="form-group">
                                <label for="test-set-questions">Number of Questions</label>
                                <input type="number" id="test-set-questions" name="num_questions" min="1" max="500" value="50" required>
                                <small>Number of questions to generate (1-500)</small>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="test-set-output">Output File Name</label>
                                <input type="text" id="test-set-output" name="output_file" value="test_set.json" required>
                                <small>Name for the generated test set file</small>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn-secondary" onclick="hideCreateTestSetModal()">Cancel</button>
                <button type="button" class="btn-primary" onclick="createTestSet()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 12l2 2 4-4"></path>
                        <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3"></path>
                        <path d="M3 12c1 0 3-1 3-3s-2-3-3-3-3 1-3 3 2 3 3 3"></path>
                        <path d="M12 3c0 1-1 3-3 3s-3-2-3-3 1-3 3-3 3 2 3 3"></path>
                        <path d="M12 21c0-1 1-3 3-3s3 2 3 3-1 3-3 3-3-2-3-3"></path>
                    </svg>
                    Generate Test Set
                </button>
            </div>
        </div>
    </div>

    <!-- Run Benchmark Modal -->
    <div class="modal" id="run-benchmark-modal">
        <div class="modal-content large">
            <div class="modal-header">
                <div class="header-content">
                    <div class="header-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 12l2 2 4-4"></path>
                            <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3"></path>
                            <path d="M3 12c1 0 3-1 3-3s-2-3-3-3-3 1-3 3 2 3 3 3"></path>
                            <path d="M12 3c0 1-1 3-3 3s-3-2-3-3 1-3 3-3 3 2 3 3"></path>
                            <path d="M12 21c0-1 1-3 3-3s3 2 3 3-1 3-3 3-3-2-3-3"></path>
                        </svg>
                    </div>
                    <div class="header-text">
                        <h2>Run Benchmark</h2>
                        <p class="modal-subtitle">Execute a benchmark test on an agent using a test set</p>
                    </div>
                </div>
                <button class="modal-close" onclick="hideRunBenchmarkModal()">&times;</button>
            </div>
            
            <div class="modal-body">
                <form id="run-benchmark-form">
                    <div class="form-section">
                        <div class="section-header">
                            <h3>Benchmark Configuration</h3>
                            <p>Select the agent and test set for benchmarking</p>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="benchmark-agent">Agent</label>
                                <select id="benchmark-agent" name="agent_name" required>
                                    <option value="">Select an agent...</option>
                                </select>
                                <small>Choose the agent to benchmark</small>
                            </div>
                            <div class="form-group">
                                <label for="benchmark-test-set">Test Set</label>
                                <select id="benchmark-test-set" name="test_set_file" required>
                                    <option value="">Select a test set...</option>
                                </select>
                                <small>Choose the test set to use for benchmarking</small>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="benchmark-run-id">Run ID (Optional)</label>
                                <input type="text" id="benchmark-run-id" name="run_id" placeholder="Auto-generated if empty">
                                <small>Custom identifier for this benchmark run</small>
                            </div>
                            <div class="form-group">
                                <label for="benchmark-dataset-id">Dataset ID (Optional)</label>
                                <input type="text" id="benchmark-dataset-id" name="dataset_id" placeholder="e.g., dataset-v1.0">
                                <small>Dataset identifier for audit and provenance</small>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="benchmark-purpose">Purpose/Notes (Optional)</label>
                                <input type="text" id="benchmark-purpose" name="purpose" placeholder="e.g., Testing new model, Pre-release validation">
                                <small>Purpose or change notes for audit trail</small>
                            </div>
                            <div class="form-group">
                                <label for="benchmark-tags">Tags (Optional)</label>
                                <input type="text" id="benchmark-tags" name="tags" placeholder="e.g., test, enterprise, safety">
                                <small>Comma-separated tags for governance</small>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn-secondary" onclick="hideRunBenchmarkModal()">Cancel</button>
                <button type="button" class="btn-primary" onclick="runBenchmark()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 12l2 2 4-4"></path>
                        <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3"></path>
                        <path d="M3 12c1 0 3-1 3-3s-2-3-3-3-3 1-3 3 2 3 3 3"></path>
                        <path d="M12 3c0 1-1 3-3 3s-3-2-3-3 1-3 3-3 3 2 3 3"></path>
                        <path d="M12 21c0-1 1-3 3-3s3 2 3 3-1 3-3 3-3-2-3-3"></path>
                    </svg>
                    Start Benchmark
                </button>
            </div>
        </div>
    </div>

    <!-- Benchmark Results Modal -->
    <div class="modal" id="benchmark-results-modal">
        <div class="modal-content extra-large">
            <div class="modal-header">
                <div class="header-content">
                    <div class="header-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="20" x2="18" y2="10"></line>
                            <line x1="12" y1="20" x2="12" y2="4"></line>
                            <line x1="6" y1="20" x2="6" y2="14"></line>
                        </svg>
                    </div>
                    <div class="header-text">
                        <h2>Benchmark Results</h2>
                        <p class="modal-subtitle" id="benchmark-results-subtitle">Detailed results for benchmark run</p>
                    </div>
                </div>
                <button class="modal-close" onclick="hideBenchmarkResultsModal()">&times;</button>
            </div>
            
            <div class="modal-body">
                <div id="benchmark-results-content">
                    <div class="loading-state">
                        <div class="loading-spinner"></div>
                        <p>Loading benchmark results...</p>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn-secondary" onclick="hideBenchmarkResultsModal()">Close</button>
                <button type="button" class="btn-primary" onclick="downloadBenchmarkResults()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7,10 12,15 17,10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                    Download CSV
                </button>
            </div>
        </div>
    </div>

    <!-- Metric Details Modals -->
    <div class="metric-details-modal" id="metric-details-modal">
        <div class="metric-details-content">
            <div class="metric-details-header">
                <h2 class="metric-details-title" id="modal-title">Metric Details</h2>
                <button class="close-modal" onclick="closeMetricDetails()">&times;</button>
            </div>
            <div class="metric-details-body" id="modal-body">
                <!-- Dynamic content will be loaded here -->
            </div>
            <div class="metric-details-footer">
                <button class="export-btn" onclick="exportMetricData()">Export Data</button>
            </div>
        </div>
    </div>

</body>
</html>
