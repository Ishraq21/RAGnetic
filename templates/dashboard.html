<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>RAGnetic Overview</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.7/dist/purify.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="{{ url_for('static', path='css/dashboard.css') }}">
    <script>
        // Global variables
        const API_BASE_URL = window.location.origin + '/api/v1';
        let loggedInUserToken = localStorage.getItem('ragnetic_user_token');
        let loggedInDbUserId = localStorage.getItem('ragnetic_db_user_id');
        
        // Check authentication
        if (!loggedInUserToken) {
            window.location.href = '/login';
        }
    </script>
    <script src="{{ url_for('static', path='js/dashboard.js') }}?v=20241236" defer></script>
    <script src="{{ url_for('static', path='js/training.js') }}?v=20241228" defer></script>
    <script src="{{ url_for('static', path='js/evaluation.js') }}?v=20250113c" defer></script>
</head>
<body>
    <div id="toast-notification"></div>
    
    <!-- Navigation -->
    <nav class="navbar">
        <div class="navbar-content">
            <div class="nav-menu">
                <!-- Mobile menu toggle removed - no longer needed -->
            </div>
            <div class="nav-actions">
                <button class="btn-text" onclick="window.location.href='/'">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                    Chat
                </button>
                <button class="sidebar-logout-btn" onclick="logout()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 21H5a2 2 0 0 1 2-2h4"></path>
                        <polyline points="16,17 21,12 16,7"></polyline>
                        <line x1="21" y1="12" x2="9" y2="12"></line>
                    </svg>
                    Logout
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <button class="tab-nav-item active" data-view="overview">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="7" height="7"></rect>
                    <rect x="14" y="3" width="7" height="7"></rect>
                    <rect x="14" y="14" width="7" height="7"></rect>
                    <rect x="3" y="14" width="7" height="7"></rect>
                </svg>
                Overview
            </button>
            <button class="tab-nav-item" data-view="agents">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                    <circle cx="9" cy="7" r="4"></circle>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                </svg>
                Agents
            </button>
            <button class="tab-nav-item" data-view="training">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2L2 7L12 12L22 7L12 2Z"></path>
                    <path d="M2 17L12 22L22 17"></path>
                    <path d="M2 12L12 17L22 12"></path>
                </svg>
                Training
            </button>
            <button class="tab-nav-item" data-view="models">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2L2 7L12 12L22 7L12 2Z"></path>
                    <path d="M2 17L12 22L22 17"></path>
                    <path d="M2 12L12 17L22 12"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                </svg>
                Fine-tuned Models
            </button>
            <button class="tab-nav-item" data-view="analytics">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="20" x2="18" y2="10"></line>
                    <line x1="12" y1="20" x2="12" y2="4"></line>
                    <line x1="6" y1="20" x2="6" y2="14"></line>
                </svg>
                Analytics
            </button>
            <button class="tab-nav-item" data-view="evaluation">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 12l2 2 4-4"></path>
                    <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3"></path>
                    <path d="M3 12c1 0 3-1 3-3s-2-3-3-3-3 1-3 3 2 3 3 3"></path>
                    <path d="M12 3c0 1-1 3-3 3s-3-2-3-3 1-3 3-3 3 2 3 3"></path>
                    <path d="M12 21c0-1 1-3 3-3s3 2 3 3-1 3-3 3-3-2-3-3"></path>
                </svg>
                Evaluation
            </button>
        </div>

        <div class="content-container">
            <!-- Overview View -->
            <div class="view-content active" id="overview-view">
            
            <div class="stats-grid">
                <div class="list-header">System Overview</div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                            <circle cx="9" cy="7" r="4"></circle>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                        </svg>
                    </div>
                    <div class="stat-content">
                        <h3 id="total-agents">0</h3>
                        <p>Active Agents</p>
                    </div>
                </div>
                
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="20" x2="18" y2="10"></line>
                            <line x1="12" y1="20" x2="12" y2="4"></line>
                            <line x1="6" y1="20" x2="6" y2="14"></line>
                        </svg>
                    </div>
                    <div class="stat-content">
                        <h3 id="total-runs">0</h3>
                        <p>Total Runs</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2L2 7L12 12L22 7L12 2Z"></path>
                            <path d="M2 17L12 22L22 17"></path>
                            <path d="M2 12L12 17L22 12"></path>
                        </svg>
                    </div>
                    <div class="stat-content">
                        <h3 id="total-training-jobs">0</h3>
                        <p>Training Jobs</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12,6 12,12 16,14"></polyline>
                        </svg>
                    </div>
                    <div class="stat-content">
                        <h3 id="success-rate">0%</h3>
                        <p>Success Rate</p>
                    </div>
                </div>
            </div>
            
            <div class="overview-sections">
                <div class="section-card">
                    <div class="section-header">
                        <h3>Recent Agent Activity</h3>
                        <button class="btn-text" onclick="switchView('agents')">View All</button>
                    </div>
                    <div class="activity-list" id="recent-agent-activity">
                        <div class="loading-state">
                            <div class="loading-spinner"></div>
                            <p>Loading recent activity...</p>
                        </div>
                    </div>
                </div>
                
            </div>
        </div>

        <!-- Agents View -->
        <div class="view-content" id="agents-view">
            
            <div class="actions-bar">
                <button class="btn-primary" onclick="showCreateAgentModal()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    New Agent
                </button>
            </div>
            
            <div class="agents-grid" id="agents-grid">
                <div class="list-header">Agents</div>
                <div class="loading-state">
                    <div class="loading-spinner"></div>
                    <p>Loading agents...</p>
                </div>
            </div>
        </div>


        <!-- Training View -->
        <div class="view-content" id="training-view">
            
            <div class="actions-bar">
                <button class="btn-primary" onclick="showCreateTrainingJobModal()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    New Training Job
                </button>
            </div>
            
            <div class="training-grid" id="training-grid">
                <div class="list-header">Training Jobs</div>
                <div class="loading-state">
                    <div class="loading-spinner"></div>
                    <p>Loading training jobs...</p>
                </div>
            </div>
        </div>

        <!-- Fine-tuned Models View -->
        <div class="view-content" id="models-view">
            <div class="models-grid" id="models-grid">
                <div class="list-header">Fine-tuned Models</div>
                <div class="loading-state">
                    <div class="loading-spinner"></div>
                    <p>Loading fine-tuned models...</p>
                </div>
            </div>
        </div>

        <!-- Analytics View -->
        <div class="view-content" id="analytics-view">
            
            <div class="analytics-grid">
                <div class="list-header">Analytics</div>
                <div class="chart-placeholder">
                    <h3>Agent Performance</h3>
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="20" x2="18" y2="10"></line>
                        <line x1="12" y1="20" x2="12" y2="4"></line>
                        <line x1="6" y1="20" x2="6" y2="14"></line>
                    </svg>
                    <p>Chart coming soon</p>
                </div>
                
            </div>
        </div>

        <!-- Evaluation View -->
        <div class="view-content" id="evaluation-view">
            <div class="evaluation-grid">
                <div class="list-header">Evaluation & Benchmarking</div>
                
                <!-- Evaluation Sub-tabs -->
                <div class="evaluation-sub-tabs">
                    <button class="sub-tab-button active" data-sub-tab="testing">Testing</button>
                    <button class="sub-tab-button" data-sub-tab="benchmarking">Benchmarking</button>
                </div>

                <!-- Testing Sub-tab -->
                <div class="sub-tab-content active" id="testing-tab">
                    <div class="testing-section">
                        <div class="section-header">
                            <h3>Test Sets</h3>
                            <div class="section-actions">
                                <button class="btn-primary" onclick="showCreateTestSetModal()">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M12 5v14M5 12h14"></path>
                                    </svg>
                                    Create Test Set
                                </button>
                                <button class="btn-text" onclick="refreshTestSets()">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path>
                                        <path d="M21 3v5h-5"></path>
                                        <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path>
                                        <path d="M3 21v-5h5"></path>
                                    </svg>
                                    Refresh
                                </button>
                            </div>
                        </div>
                        <div class="test-sets-list" id="test-sets-list">
                            <div class="loading-state">
                                <div class="loading-spinner"></div>
                                <p>Loading test sets...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Benchmarking Sub-tab -->
                <div class="sub-tab-content" id="benchmarking-tab">
                    <div class="benchmarking-section">
                        <div class="section-header">
                            <h3>Benchmark Runs</h3>
                            <div class="section-actions">
                                <button class="btn-primary" onclick="showRunBenchmarkModal()">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M9 12l2 2 4-4"></path>
                                        <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3"></path>
                                        <path d="M3 12c1 0 3-1 3-3s-2-3-3-3-3 1-3 3 2 3 3 3"></path>
                                        <path d="M12 3c0 1-1 3-3 3s-3-2-3-3 1-3 3-3 3 2 3 3"></path>
                                        <path d="M12 21c0-1 1-3 3-3s3 2 3 3-1 3-3 3-3-2-3-3"></path>
                                    </svg>
                                    Run Benchmark
                                </button>
                                <button class="btn-text" onclick="refreshBenchmarks()">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path>
                                        <path d="M21 3v5h-5"></path>
                                        <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path>
                                        <path d="M3 21v-5h5"></path>
                                    </svg>
                                    Refresh
                                </button>
                            </div>
                        </div>
                        <div class="benchmarks-list" id="benchmarks-list">
                            <div class="loading-state">
                                <div class="loading-spinner"></div>
                                <p>Loading benchmark runs...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>
    </main>

    <!-- Create Training Job Modal -->
    <div class="modal" id="create-training-job-modal">
        <div class="modal-content large">
            <div class="modal-header">
                <div class="header-content">
                    <div class="header-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2L2 7L12 12L22 7L12 2Z"></path>
                            <path d="M2 17L12 22L22 17"></path>
                            <path d="M2 12L12 17L22 12"></path>
                        </svg>
                    </div>
                    <div class="header-text">
                        <h2>Create Training Job</h2>
                        <p class="modal-subtitle">Configure and start a new LoRA fine-tuning job</p>
                    </div>
                </div>
                <button class="modal-close" onclick="hideCreateTrainingJobModal()">&times;</button>
            </div>
            
            <div class="modal-body">
                <form id="create-training-job-form">
                    <!-- Basic Configuration -->
                    <div class="form-section">
                        <div class="section-header">
                            <h3>Basic Configuration</h3>
                            <p>Set up the fundamental parameters for your training job</p>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="job-name">Job Name</label>
                                <input type="text" id="job-name" name="job_name" required placeholder="my-llama2-finetune">
                                <small>Unique identifier for this training job</small>
                            </div>
                            <div class="form-group">
                                <label for="base-model">Base Model</label>
                                <select id="base-model" name="base_model_name" required>
                                    <option value="">Select a base model...</option>
                                    <optgroup label="Small Models">
                                        <option value="TinyLlama/TinyLlama-1.1B-Chat-v1.0">TinyLlama 1.1B Chat</option>
                                        <option value="microsoft/DialoGPT-small">DialoGPT Small</option>
                                    </optgroup>
                                    <optgroup label="Medium Models">
                                        <option value="microsoft/DialoGPT-medium">DialoGPT Medium</option>
                                        <option value="facebook/blenderbot-400M-distill">BlenderBot 400M</option>
                                    </optgroup>
                                    <optgroup label="Large Models">
                                        <option value="meta-llama/Llama-2-7b-chat-hf">Llama 2 7B Chat</option>
                                        <option value="meta-llama/Llama-2-13b-chat-hf">Llama 2 13B Chat</option>
                                    </optgroup>
                                </select>
                                <small>Choose the base model to fine-tune</small>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="dataset-upload">Training Dataset *</label>
                                <div class="file-upload-container">
                                    <input type="file" id="dataset-upload" name="dataset_file" accept=".jsonl,.json" style="display: none;">
                                    <div class="file-upload-area" onclick="document.getElementById('dataset-upload').click()">
                                        <div class="file-upload-content">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                                <polyline points="7,10 12,15 17,10"></polyline>
                                                <line x1="12" y1="15" x2="12" y2="3"></line>
                                            </svg>
                                            <span class="file-upload-text">Click to upload training dataset</span>
                                            <small>JSONL or JSON format</small>
                                        </div>
                                        <div class="file-upload-selected" style="display: none;">
                                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                                <polyline points="14,2 14,8 20,8"></polyline>
                                            </svg>
                                            <span class="file-name"></span>
                                            <button type="button" class="file-remove" onclick="event.stopPropagation(); removeUploadedFile('dataset')">×</button>
                                        </div>
                                    </div>
                                    <input type="hidden" id="dataset-path" name="dataset_path">
                                </div>
                                <small>Upload a JSONL or JSON training dataset file</small>
                            </div>
                            <div class="form-group">
                                <label for="eval-dataset-upload">Evaluation Dataset</label>
                                <div class="file-upload-container">
                                    <input type="file" id="eval-dataset-upload" name="eval_dataset_file" accept=".jsonl,.json" style="display: none;">
                                    <div class="file-upload-area" onclick="document.getElementById('eval-dataset-upload').click()">
                                        <div class="file-upload-content">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                                <polyline points="7,10 12,15 17,10"></polyline>
                                                <line x1="12" y1="15" x2="12" y2="3"></line>
                                            </svg>
                                            <span class="file-upload-text">Click to upload evaluation dataset</span>
                                            <small>Optional - JSONL or JSON format</small>
                                        </div>
                                        <div class="file-upload-selected" style="display: none;">
                                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                                <polyline points="14,2 14,8 20,8"></polyline>
                                            </svg>
                                            <span class="file-name"></span>
                                            <button type="button" class="file-remove" onclick="event.stopPropagation(); removeUploadedFile('eval-dataset')">×</button>
                                        </div>
                                    </div>
                                    <input type="hidden" id="eval-dataset-path" name="eval_dataset_path">
                                </div>
                                <small>Optional evaluation dataset for validation</small>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="output-dir">Output Directory</label>
                            <input type="text" id="output-dir" name="output_base_dir" required placeholder="models/fine_tuned">
                            <small>Directory where the fine-tuned model will be saved</small>
                        </div>
                    </div>
                    
                    <!-- LoRA Configuration -->
                    <div class="form-section">
                        <div class="section-header">
                            <h3>LoRA Configuration</h3>
                            <p>Configure LoRA (Low-Rank Adaptation) parameters</p>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="lora-rank">LoRA Rank</label>
                                <input type="range" id="lora-rank" name="lora_rank" min="1" max="64" value="8" 
                                       aria-label="LoRA Rank" aria-valuemin="1" aria-valuemax="64" aria-valuenow="8"
                                       oninput="updateRangeValue('lora-rank', this.value)">
                                <div class="range-value">
                                    <span id="lora-rank-value">8</span>
                                    <small>Higher rank = more parameters, better capacity but slower training</small>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="lora-alpha">LoRA Alpha</label>
                                <input type="range" id="lora-alpha" name="lora_alpha" min="1" max="128" value="16" 
                                       aria-label="LoRA Alpha" aria-valuemin="1" aria-valuemax="128" aria-valuenow="16"
                                       oninput="updateRangeValue('lora-alpha', this.value)">
                                <div class="range-value">
                                    <span id="lora-alpha-value">16</span>
                                    <small>Scaling factor for LoRA weights</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="lora-dropout">LoRA Dropout</label>
                                <input type="range" id="lora-dropout" name="lora_dropout" min="0" max="0.5" step="0.01" value="0.05" oninput="updateRangeValue('lora-dropout', this.value)">
                                <div class="range-value">
                                    <span id="lora-dropout-value">0.05</span>
                                    <small>Dropout rate to prevent overfitting</small>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="target-modules">Target Modules</label>
                                <input type="text" id="target-modules" name="target_modules" placeholder="q_proj,v_proj,k_proj,o_proj">
                                <small>Comma-separated list of modules to apply LoRA to (leave empty for auto)</small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Training Parameters -->
                    <div class="form-section">
                        <div class="section-header">
                            <h3>Training Parameters</h3>
                            <p>Configure training hyperparameters</p>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="learning-rate">Learning Rate</label>
                                <input type="range" id="learning-rate" name="learning_rate" min="0.0001" max="0.01" step="0.0001" value="0.0002" oninput="updateRangeValue('learning-rate', this.value)">
                                <div class="range-value">
                                    <span id="learning-rate-value">0.0002</span>
                                    <small>Learning rate for the optimizer</small>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="epochs">Epochs</label>
                                <input type="range" id="epochs" name="epochs" min="1" max="10" value="3" oninput="updateRangeValue('epochs', this.value)">
                                <div class="range-value">
                                    <span id="epochs-value">3</span>
                                    <small>Number of training epochs</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="batch-size">Batch Size</label>
                                <input type="range" id="batch-size" name="batch_size" min="1" max="16" value="4" oninput="updateRangeValue('batch-size', this.value)">
                                <div class="range-value">
                                    <span id="batch-size-value">4</span>
                                    <small>Training batch size per device</small>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="gradient-accumulation">Gradient Accumulation Steps</label>
                                <input type="range" id="gradient-accumulation" name="gradient_accumulation_steps" min="1" max="16" value="1" oninput="updateRangeValue('gradient-accumulation', this.value)">
                                <div class="range-value">
                                    <span id="gradient-accumulation-value">1</span>
                                    <small>Steps to accumulate gradients before updating</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Advanced Settings -->
                    <div class="form-section">
                        <div class="section-header">
                            <h3>Advanced Settings</h3>
                            <p>Optional advanced configuration options</p>
                            <button type="button" class="btn-text" onclick="toggleAdvancedSettings()">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="6,9 12,15 18,9"></polyline>
                                </svg>
                                Toggle Advanced
                            </button>
                        </div>
                        
                        <div class="advanced-settings hidden" id="advanced-settings">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="mixed-precision">Mixed Precision</label>
                                    <select id="mixed-precision" name="mixed_precision_dtype">
                                        <option value="no">No Mixed Precision</option>
                                        <option value="fp16">FP16 (NVIDIA GPUs)</option>
                                        <option value="bf16">BF16 (Newer GPUs/Apple Silicon)</option>
                                    </select>
                                    <small>Mixed precision training for faster training and lower memory usage</small>
                                </div>
                                <div class="form-group">
                                    <label for="logging-steps">Logging Steps</label>
                                    <input type="number" id="logging-steps" name="logging_steps" min="1" max="1000" value="10">
                                    <small>How often to log training metrics</small>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="save-steps">Save Steps</label>
                                    <input type="number" id="save-steps" name="save_steps" min="100" max="10000" value="500">
                                    <small>How often to save model checkpoints</small>
                                </div>
                                <div class="form-group">
                                    <label for="save-total-limit">Max Checkpoints</label>
                                    <input type="number" id="save-total-limit" name="save_total_limit" min="1" max="10" value="1">
                                    <small>Maximum number of checkpoints to keep</small>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="cost-per-gpu-hour">Cost per GPU Hour (USD)</label>
                                <input type="number" id="cost-per-gpu-hour" name="cost_per_gpu_hour" min="0" max="10" step="0.1" value="0.5">
                                <small>Estimated cost per GPU hour for cost tracking</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="device">Device</label>
                                <select id="device" name="device">
                                    <option value="auto">Auto-detect</option>
                                    <option value="cuda">CUDA (NVIDIA GPU)</option>
                                    <option value="mps">MPS (Apple Silicon)</option>
                                    <option value="cpu">CPU</option>
                                </select>
                                <small>Training device preference</small>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            
            <div class="form-actions">
                <button type="button" class="btn-secondary" onclick="hideCreateTrainingJobModal()">Cancel</button>
                <button type="button" class="btn-primary" onclick="submitTrainingJob()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2L2 7L12 12L22 7L12 2Z"></path>
                        <path d="M2 17L12 22L22 17"></path>
                        <path d="M2 12L12 17L22 12"></path>
                    </svg>
                    Start Training Job
                </button>
            </div>
        </div>
    </div>

    <!-- Training Job Details Modal -->
    <div class="modal" id="training-job-details-modal">
        <div class="modal-content large">
            <div class="modal-header">
                <div class="header-content">
                    <div class="header-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2L2 7L12 12L22 7L12 2Z"></path>
                            <path d="M2 17L12 22L22 17"></path>
                            <path d="M2 12L12 17L22 12"></path>
                        </svg>
                    </div>
                    <div class="header-text">
                        <h2 id="job-details-title">Training Job Details</h2>
                        <p class="modal-subtitle" id="job-details-subtitle">View training progress and metrics</p>
                    </div>
                </div>
                <button class="modal-close" onclick="hideTrainingJobDetailsModal()">&times;</button>
            </div>
            
            <div class="modal-body">
                <div id="job-details-content">
                    <!-- Content will be populated by JavaScript -->
                </div>
            </div>
            
            <div class="form-actions">
                <button type="button" class="btn-secondary" onclick="hideTrainingJobDetailsModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Create Agent Modal -->
    <div class="modal" id="create-agent-modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2>Create New Agent</h2>
                <button class="modal-close" onclick="hideCreateAgentModal()">×</button>
            </div>
            
            <form id="create-agent-form">
                <!-- Basic Configuration Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>Basic Configuration</h3>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="agent-name">Agent Name *</label>
                            <input type="text" id="agent-name" name="name" required placeholder="e.g., customer-support">
                            <small>Unique identifier for your agent (lowercase, no spaces)</small>
                        </div>
                        <div class="form-group">
                            <label for="agent-display-name">Display Name *</label>
                            <input type="text" id="agent-display-name" name="display_name" required placeholder="e.g., Customer Support Agent">
                            <small>Human-readable name for your agent</small>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="agent-description">Description</label>
                        <textarea id="agent-description" name="description" rows="3" placeholder="What does this agent do? What problems does it solve?"></textarea>
                        <small>Clear description of your agent's purpose and capabilities</small>
                    </div>
                </div>

                <!-- AI Models Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>AI Models</h3>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="agent-llm-model">Language Model *</label>
                            <select id="agent-llm-model" name="llm_model" required>
                                <optgroup label="OpenAI Models">
                                    <option value="gpt-4o-mini">GPT-4o Mini (Fast & Cost-effective)</option>
                                    <option value="gpt-4o">GPT-4o (Most Capable)</option>
                                    <option value="gpt-4-turbo">GPT-4 Turbo (Balanced)</option>
                                </optgroup>
                                <optgroup label="Anthropic Models">
                                    <option value="claude-3-5-sonnet-20241022">Claude 3.5 Sonnet (Intelligent)</option>
                                    <option value="claude-3-haiku-20240307">Claude 3 Haiku (Fast)</option>
                                </optgroup>
                                <optgroup label="Google Models">
                                    <option value="gemini-1.5-pro">Gemini 1.5 Pro (Advanced)</option>
                                    <option value="gemini-1.5-flash">Gemini 1.5 Flash (Fast)</option>
                                </optgroup>
                                <optgroup label="Local Models">
                                    <option value="ollama/llama2">Ollama Llama2 (Local)</option>
                                    <option value="ollama/mistral">Ollama Mistral (Local)</option>
                                    <option value="ollama/codellama">Ollama CodeLlama (Code-focused)</option>
                                </optgroup>
                            </select>
                            <small>Select the language model that best fits your use case</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="agent-embedding-model">Embedding Model *</label>
                            <select id="agent-embedding-model" name="embedding_model" required>
                                <optgroup label="OpenAI Embeddings">
                                    <option value="text-embedding-3-small">text-embedding-3-small (Fast & Cost-effective)</option>
                                    <option value="text-embedding-3-large">text-embedding-3-large (High Quality)</option>
                                </optgroup>
                                <optgroup label="Local Embeddings">
                                    <option value="ollama/nomic-embed-text">Ollama Nomic Embed (Local)</option>
                                    <option value="ollama/all-minilm">Ollama All-MiniLM (Local)</option>
                                </optgroup>
                            </select>
                            <small>Select the embedding model for document vectorization</small>
                        </div>
                    </div>
                </div>

                <!-- Personality & Behavior Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>Personality & Behavior</h3>
                    </div>
                    
                    <div class="form-group">
                        <label for="agent-persona">Persona Prompt *</label>
                        <textarea id="agent-persona" name="persona_prompt" rows="4" required placeholder="You are a helpful AI assistant specialized in [your domain]. You should [describe behavior, tone, expertise areas]..."></textarea>
                        <small>Define your agent's personality, expertise, and communication style</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="agent-execution-prompt">Custom Execution Prompt</label>
                        <textarea id="agent-execution-prompt" name="execution_prompt" rows="4" placeholder="Use {user_query} and {retrieved_context} as placeholders. Leave empty to use default."></textarea>
                        <small>Optional custom prompt template for advanced users</small>
                    </div>
                </div>

                <!-- Chunking Configuration Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>Chunking Configuration</h3>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="chunking-mode">Chunking Mode</label>
                            <select id="chunking-mode" name="chunking_mode">
                                <option value="default">Default</option>
                                <option value="semantic">Semantic</option>
                                <option value="fixed">Fixed Size</option>
                            </select>
                            <small>How documents should be split into chunks</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="chunk-size">Chunk Size</label>
                            <input type="number" id="chunk-size" name="chunk_size" min="100" max="4000" value="1000">
                            <small>Maximum number of characters per chunk</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="chunk-overlap">Chunk Overlap</label>
                            <input type="number" id="chunk-overlap" name="chunk_overlap" min="0" max="500" value="100">
                            <small>Number of characters to overlap between chunks</small>
                        </div>
                    </div>
                </div>

                <!-- Model Parameters Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>Model Parameters</h3>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="temperature">Temperature</label>
                            <input type="range" id="temperature" name="temperature" min="0" max="2" step="0.1" value="0.7" oninput="updateRangeValue('temperature', this.value)">
                            <div class="range-value">
                                <span id="temperature-value">0.7</span>
                                <small>Controls randomness in responses (0 = deterministic, 2 = very random)</small>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="max-tokens">Max Tokens</label>
                            <input type="number" id="max-tokens" name="max_tokens" min="100" max="8000" value="2000">
                            <small>Maximum number of tokens to generate in the response (100-8000)</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="top-p">Top P (Nucleus Sampling)</label>
                            <input type="range" id="top-p" name="top_p" min="0" max="1" step="0.01" value="1" oninput="updateRangeValue('top-p', this.value)">
                            <div class="range-value">
                                <span id="top-p-value">1.0</span>
                                <small>Controls diversity via nucleus sampling (0.1 = very focused, 1.0 = most diverse)</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="llm-timeout">LLM Timeout (seconds)</label>
                            <input type="number" id="llm-timeout" name="llm_timeout" min="10" max="300" value="60">
                            <small>Timeout in seconds for LLM calls (10-300 seconds, default: 60)</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="llm-retries">LLM Retries</label>
                            <input type="number" id="llm-retries" name="llm_retries" min="0" max="5" value="0">
                            <small>Number of retry attempts for failed LLM calls (0 = no retries)</small>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="evaluation-llm-model">Evaluation LLM Model (Optional)</label>
                            <select id="evaluation-llm-model" name="evaluation_llm_model">
                                <option value="">Use same as main LLM</option>
                                <optgroup label="OpenAI Models (Recommended for Evaluation)">
                                    <option value="gpt-4o">GPT-4o (Best for LLM-as-a-Judge)</option>
                                    <option value="gpt-4o-mini">GPT-4o Mini (Fast & Cost-effective)</option>
                                    <option value="gpt-4-turbo">GPT-4 Turbo (Balanced)</option>
                                </optgroup>
                                <optgroup label="Anthropic Models">
                                    <option value="claude-3-5-sonnet-20241022">Claude 3.5 Sonnet (Intelligent)</option>
                                    <option value="claude-3-haiku-20240307">Claude 3 Haiku (Fast)</option>
                                </optgroup>
                            </select>
                            <small>Separate LLM for benchmarking, test generation, and LLM-as-a-judge evaluation tasks</small>
                        </div>
                    </div>
                </div>

                <!-- Vector Store Configuration Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>Vector Store & Retrieval</h3>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="vector-store-type">Vector Store Type</label>
                            <select id="vector-store-type" name="vector_store_type">
                                <option value="faiss">FAISS (Local, Fast)</option>
                                <option value="chroma">Chroma (Local, Feature-rich)</option>
                                <option value="qdrant">Qdrant (Local/Remote, Scalable)</option>
                                <option value="pinecone">Pinecone (Cloud, Production-ready)</option>
                                <option value="mongodb_atlas">MongoDB Atlas (Cloud, Integrated)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="retrieval-strategy">Retrieval Strategy</label>
                            <select id="retrieval-strategy" name="retrieval_strategy">
                                <option value="hybrid">Hybrid (Fast, BM25 + Semantic)</option>
                                <option value="enhanced">Enhanced (Accurate, Cross-encoder Reranking)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="bm25-k">BM25 Results (k)</label>
                            <input type="number" id="bm25-k" name="bm25_k" min="1" max="50" value="5">
                            <small>Number of keyword-based results</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="semantic-k">Semantic Results (k)</label>
                            <input type="number" id="semantic-k" name="semantic_k" min="1" max="50" value="5">
                            <small>Number of semantic similarity results</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="rerank-top-n">Rerank Top N</label>
                            <input type="number" id="rerank-top-n" name="rerank_top_n" min="1" max="50" value="5">
                            <small>Documents to rerank for accuracy</small>
                        </div>
                    </div>
                    
                    <div class="form-section-sub">
                        <div class="form-row" id="qdrant-settings" style="display: none;">
                            <div class="form-group">
                                <label for="qdrant-host">Qdrant Host</label>
                                <input type="text" id="qdrant-host" name="qdrant_host" placeholder="localhost">
                                <small>Hostname for remote Qdrant server (leave empty for local)</small>
                            </div>
                            <div class="form-group">
                                <label for="qdrant-port">Qdrant Port</label>
                                <input type="number" id="qdrant-port" name="qdrant_port" min="1" max="65535" value="6333">
                                <small>Port for Qdrant server (default: 6333)</small>
                            </div>
                        </div>
                        
                        <div class="form-row" id="pinecone-settings" style="display: none;">
                            <div class="form-group">
                                <label for="pinecone-index-name">Pinecone Index Name</label>
                                <input type="text" id="pinecone-index-name" name="pinecone_index_name" placeholder="my-index">
                                <small>Name of your Pinecone index</small>
                            </div>
                        </div>
                        
                        <div class="form-row" id="mongodb-settings" style="display: none;">
                            <div class="form-group">
                                <label for="mongodb-db-name">MongoDB Database Name</label>
                                <input type="text" id="mongodb-db-name" name="mongodb_db_name" placeholder="my_database">
                                <small>Name of the MongoDB database</small>
                            </div>
                            <div class="form-group">
                                <label for="mongodb-collection-name">MongoDB Collection Name</label>
                                <input type="text" id="mongodb-collection-name" name="mongodb_collection_name" placeholder="my_collection">
                                <small>Name of the MongoDB collection</small>
                            </div>
                            <div class="form-group">
                                <label for="mongodb-index-name">MongoDB Index Name</label>
                                <input type="text" id="mongodb-index-name" name="mongodb_index_name" value="vector_search_index">
                                <small>Name of the Atlas Vector Search index</small>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- Tools Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>Tools & Capabilities</h3>
                    </div>
                    
                    <div class="tools-grid">
                        <label class="tool-checkbox">
                            <input type="checkbox" name="tools" value="retriever" checked>
                            <div class="tool-card">
                                <div class="tool-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                        <polyline points="14,2 14,8 20,8"></polyline>
                                        <line x1="16" y1="13" x2="8" y2="13"></line>
                                        <line x1="16" y1="17" x2="8" y2="17"></line>
                                        <polyline points="10,9 9,9 8,9"></polyline>
                                    </svg>
                                </div>
                                <div class="tool-info">
                                    <h4>Document Loader & Retriever</h4>
                                    <p>Load, process, and retrieve information from your data sources</p>
                                </div>
                            </div>
                        </label>
                        
                        <label class="tool-checkbox">
                            <input type="checkbox" name="tools" value="search_engine">
                            <div class="tool-card">
                                <div class="tool-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                    </svg>
                                </div>
                                <div class="tool-info">
                                    <h4>Web Search</h4>
                                    <p>Search the internet for real-time information</p>
                                </div>
                            </div>
                        </label>
                        
                        <label class="tool-checkbox">
                            <input type="checkbox" name="tools" value="api_toolkit">
                            <div class="tool-card">
                                <div class="tool-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path>
                                    </svg>
                                </div>
                                <div class="tool-info">
                                    <h4>API Toolkit</h4>
                                    <p>Make API calls to external services</p>
                                </div>
                            </div>
                        </label>
                        
                        <label class="tool-checkbox">
                            <input type="checkbox" name="tools" value="sql_toolkit">
                            <div class="tool-card">
                                <div class="tool-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                        <path d="M14 2v6h6"></path>
                                        <path d="M16 13H8"></path>
                                        <path d="M16 17H8"></path>
                                        <path d="M10 9H8"></path>
                                    </svg>
                                </div>
                                <div class="tool-info">
                                    <h4>SQL Database</h4>
                                    <p>Query and analyze database information</p>
                                </div>
                            </div>
                        </label>
                        
                        <label class="tool-checkbox">
                            <input type="checkbox" name="tools" value="arxiv">
                            <div class="tool-card">
                                <div class="tool-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                        <polyline points="14,2 14,8 20,8"></polyline>
                                        <line x1="16" y1="13" x2="8" y2="13"></line>
                                        <line x1="16" y1="17" x2="8" y2="17"></line>
                                        <polyline points="10,9 9,9 8,9"></polyline>
                                    </svg>
                                </div>
                                <div class="tool-info">
                                    <h4>ArXiv Search</h4>
                                    <p>Search academic papers and research on ArXiv</p>
                                </div>
                            </div>
                        </label>
                        
                        <label class="tool-checkbox">
                            <input type="checkbox" name="tools" value="lambda_tool">
                            <div class="tool-card">
                                <div class="tool-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="4,17 10,11 4,5"></polyline>
                                        <line x1="12" y1="19" x2="20" y2="19"></line>
                                    </svg>
                                </div>
                                <div class="tool-info">
                                    <h4>Lambda Tool</h4>
                                    <p>Execute custom code in a sandboxed environment</p>
                                </div>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- Data Sources Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>Data Sources</h3>
                        <button type="button" class="btn-secondary btn-sm" onclick="addDataSource()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            Add Data Source
                        </button>
                    </div>
                    
                    <div id="data-sources-container">
                        <!-- Data sources will be added here dynamically -->
                        <div class="empty-state">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14,2 14,8 20,8"></polyline>
                                <line x1="16" y1="13" x2="8" y2="13"></line>
                                <line x1="16" y1="17" x2="8" y2="17"></line>
                                <polyline points="10,9 9,9 8,9"></polyline>
                            </svg>
                            <p>No data sources configured</p>
                            <small>Your agent will start with general knowledge only</small>
                        </div>
                    </div>
                </div>

                <!-- Data Policies Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>Data Security & Privacy</h3>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="pii-redaction">PII Redaction</label>
                            <select id="pii-redaction" name="pii_redaction">
                                <option value="none">None</option>
                                <option value="basic">Basic (Email, Phone)</option>
                                <option value="comprehensive">Comprehensive (Email, Phone, SSN, Credit Card, Names)</option>
                            </select>
                            <small>Automatically redact personally identifiable information</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="keyword-filtering">Keyword Filtering</label>
                            <input type="text" id="keyword-filtering" name="keyword_filtering" placeholder="sensitive, confidential, private">
                            <small>Comma-separated keywords to filter or redact</small>
                        </div>
                    </div>
                </div>

                <!-- Scaling & Performance Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>Scaling & Performance</h3>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="parallel-ingestion">Parallel Ingestion</label>
                            <div class="toggle-switch">
                                <input type="checkbox" id="parallel-ingestion" name="parallel_ingestion">
                                <span class="slider"></span>
                            </div>
                            <small>Enable parallel processing for faster data ingestion</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="ingestion-workers">Ingestion Workers</label>
                            <input type="number" id="ingestion-workers" name="ingestion_workers" min="1" max="16" value="4">
                            <small>Number of parallel workers (defaults to CPU count)</small>
                        </div>
                    </div>
                </div>

                <!-- Advanced Configuration Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>Advanced Configuration</h3>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="max-context-docs">Max Context Documents</label>
                            <input type="number" id="max-context-docs" name="max_context_docs" min="1" max="100" value="20">
                            <small>Maximum number of retrieved documents to include in context (1-100)</small>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="reproducible-ids">Reproducible IDs</label>
                            <div class="toggle-switch">
                                <input type="checkbox" id="reproducible-ids" name="reproducible_ids" checked>
                                <span class="slider"></span>
                            </div>
                            <small>Generate IDs based on content hash for reproducibility (recommended for testing)</small>
                        </div>
                    </div>
                </div>

                <!-- Benchmark Configuration Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>Benchmark & Evaluation Settings</h3>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="context-window-tokens">Context Window Tokens</label>
                            <input type="number" id="context-window-tokens" name="context_window_tokens" min="1000" max="200000" value="8000">
                            <small>Total model context window used for budgeting (1000-200000 tokens, default: 8000)</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="context-budget-ratio">Context Budget Ratio</label>
                            <input type="range" id="context-budget-ratio" name="context_budget_ratio" min="0.1" max="0.95" step="0.05" value="0.70" oninput="updateRangeValue('context-budget-ratio', this.value)">
                            <div class="range-value">
                                <span id="context-budget-ratio-value">0.70</span>
                                <small>Fraction of window allocated to retrieved context (0.1-0.95, default: 0.70)</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="answer-reserve-tokens">Answer Reserve Tokens</label>
                            <input type="number" id="answer-reserve-tokens" name="answer_reserve_tokens" min="100" max="8000" value="1024">
                            <small>Tokens reserved for the model's answer during benchmarking (100-8000, default: 1024)</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="enable-doc-truncation">Enable Document Truncation</label>
                            <select id="enable-doc-truncation" name="enable_doc_truncation">
                                <option value="true">Yes (Recommended)</option>
                                <option value="false">No</option>
                            </select>
                            <small>Truncate retrieved docs to fit within the budget (recommended for large documents)</small>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="hideCreateAgentModal()">Cancel</button>
                    <button type="submit" class="btn-primary">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 12l2 2 4-4"></path>
                            <path d="M21 12c-1 0-2-1-2-2s1-2 2-2 2 1 2 2-1 2-2 2z"></path>
                            <path d="M3 12c1 0 2-1 2-2s-1-2-2-2-2 1-2 2 1 2 2 2z"></path>
                            <path d="M12 3c0 1-1 2-2 2s-2 1-2 2 1 1 2 2 2 1 2 2 1-1 2-2 2-1 2-2-1-1-2-2-2-1-2-2z"></path>
                        </svg>
                        Create Agent
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Agent Modal -->
    <div class="modal" id="edit-agent-modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2>Edit Agent</h2>
                <button class="modal-close" onclick="hideEditAgentModal()">×</button>
            </div>
            
            <form id="edit-agent-form">
                <!-- Basic Configuration Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>Basic Configuration</h3>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-agent-name">Agent Name *</label>
                            <input type="text" id="edit-agent-name" name="name" required readonly>
                            <small>Agent name cannot be changed</small>
                        </div>
                        <div class="form-group">
                            <label for="edit-agent-display-name">Display Name *</label>
                            <input type="text" id="edit-agent-display-name" name="display_name" required>
                            <small>Human-readable name for your agent</small>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-agent-description">Description</label>
                        <textarea id="edit-agent-description" name="description" rows="3"></textarea>
                        <small>Clear description of your agent's purpose and capabilities</small>
                    </div>
                </div>

                <!-- AI Models Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>AI Models</h3>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-agent-llm-model">Language Model *</label>
                            <select id="edit-agent-llm-model" name="llm_model" required>
                                <optgroup label="OpenAI Models">
                                    <option value="gpt-4o-mini">GPT-4o Mini (Fast & Cost-effective)</option>
                                    <option value="gpt-4o">GPT-4o (Most Capable)</option>
                                    <option value="gpt-4-turbo">GPT-4 Turbo (Balanced)</option>
                                </optgroup>
                                <optgroup label="Anthropic Models">
                                    <option value="claude-3-5-sonnet-20241022">Claude 3.5 Sonnet (Intelligent)</option>
                                    <option value="claude-3-haiku-20240307">Claude 3 Haiku (Fast)</option>
                                </optgroup>
                                <optgroup label="Google Models">
                                    <option value="gemini-1.5-pro">Gemini 1.5 Pro (Advanced)</option>
                                    <option value="gemini-1.5-flash">Gemini 1.5 Flash (Fast)</option>
                                </optgroup>
                                <optgroup label="Local Models">
                                    <option value="ollama/llama2">Ollama Llama2 (Local)</option>
                                    <option value="ollama/mistral">Ollama Mistral (Local)</option>
                                    <option value="ollama/codellama">Ollama CodeLlama (Code-focused)</option>
                                </optgroup>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="edit-agent-embedding-model">Embedding Model *</label>
                            <select id="edit-agent-embedding-model" name="embedding_model" required>
                                <optgroup label="OpenAI Embeddings">
                                    <option value="text-embedding-3-small">text-embedding-3-small (Fast & Cost-effective)</option>
                                    <option value="text-embedding-3-large">text-embedding-3-large (High Quality)</option>
                                </optgroup>
                                <optgroup label="Local Embeddings">
                                    <option value="ollama/nomic-embed-text">Ollama Nomic Embed (Local)</option>
                                    <option value="ollama/all-minilm">Ollama All-MiniLM (Local)</option>
                                </optgroup>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Personality & Behavior Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>Personality & Behavior</h3>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-agent-persona">Persona Prompt *</label>
                        <textarea id="edit-agent-persona" name="persona_prompt" rows="4" required></textarea>
                        <small>Define your agent's personality, expertise, and communication style</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-agent-execution-prompt">Custom Execution Prompt</label>
                        <textarea id="edit-agent-execution-prompt" name="execution_prompt" rows="4"></textarea>
                        <small>Optional custom prompt template for advanced users</small>
                    </div>
                </div>

                <!-- Chunking Configuration Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>Chunking Configuration</h3>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-chunking-mode">Chunking Mode</label>
                            <select id="edit-chunking-mode" name="chunking_mode">
                                <option value="default">Default</option>
                                <option value="semantic">Semantic</option>
                                <option value="fixed">Fixed Size</option>
                            </select>
                            <small>How documents should be split into chunks</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="edit-chunk-size">Chunk Size</label>
                            <input type="number" id="edit-chunk-size" name="chunk_size" min="100" max="4000" value="1000">
                            <small>Maximum number of characters per chunk</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="edit-chunk-overlap">Chunk Overlap</label>
                            <input type="number" id="edit-chunk-overlap" name="chunk_overlap" min="0" max="500" value="100">
                            <small>Number of characters to overlap between chunks</small>
                        </div>
                    </div>
                </div>

                <!-- Vector Store Configuration Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>Vector Store & Retrieval</h3>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-vector-store-type">Vector Store Type</label>
                            <select id="edit-vector-store-type" name="vector_store_type">
                                <option value="faiss">FAISS (Local, Fast)</option>
                                <option value="chroma">Chroma (Local, Feature-rich)</option>
                                <option value="qdrant">Qdrant (Local/Remote, Scalable)</option>
                                <option value="pinecone">Pinecone (Cloud, Production-ready)</option>
                                <option value="mongodb_atlas">MongoDB Atlas (Cloud, Integrated)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="edit-retrieval-strategy">Retrieval Strategy</label>
                            <select id="edit-retrieval-strategy" name="retrieval_strategy">
                                <option value="hybrid">Hybrid (Fast, BM25 + Semantic)</option>
                                <option value="enhanced">Enhanced (Accurate, Cross-encoder Reranking)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-bm25-k">BM25 Results (k)</label>
                            <input type="number" id="edit-bm25-k" name="bm25_k" min="1" max="50" value="5">
                        </div>
                        
                        <div class="form-group">
                            <label for="edit-semantic-k">Semantic Results (k)</label>
                            <input type="number" id="edit-semantic-k" name="semantic_k" min="1" max="50" value="5">
                        </div>
                        
                        <div class="form-group">
                            <label for="edit-rerank-top-n">Rerank Top N</label>
                            <input type="number" id="edit-rerank-top-n" name="rerank_top_n" min="1" max="50" value="5">
                            <small>Documents to rerank for accuracy</small>
                        </div>
                    </div>
                    
                    <div class="form-section-sub">
                        <div class="form-row" id="edit-qdrant-settings" style="display: none;">
                            <div class="form-group">
                                <label for="edit-qdrant-host">Qdrant Host</label>
                                <input type="text" id="edit-qdrant-host" name="qdrant_host" placeholder="localhost">
                                <small>Hostname for remote Qdrant server (leave empty for local)</small>
                            </div>
                            <div class="form-group">
                                <label for="edit-qdrant-port">Qdrant Port</label>
                                <input type="number" id="edit-qdrant-port" name="qdrant_port" min="1" max="65535" value="6333">
                                <small>Port for Qdrant server (default: 6333)</small>
                            </div>
                        </div>
                        
                        <div class="form-row" id="edit-pinecone-settings" style="display: none;">
                            <div class="form-group">
                                <label for="edit-pinecone-index-name">Pinecone Index Name</label>
                                <input type="text" id="edit-pinecone-index-name" name="pinecone_index_name" placeholder="my-index">
                                <small>Name of your Pinecone index</small>
                            </div>
                        </div>
                        
                        <div class="form-row" id="edit-mongodb-settings" style="display: none;">
                            <div class="form-group">
                                <label for="edit-mongodb-db-name">MongoDB Database Name</label>
                                <input type="text" id="edit-mongodb-db-name" name="mongodb_db_name" placeholder="my_database">
                                <small>Name of the MongoDB database</small>
                            </div>
                            <div class="form-group">
                                <label for="edit-mongodb-collection-name">MongoDB Collection Name</label>
                                <input type="text" id="edit-mongodb-collection-name" name="mongodb_collection_name" placeholder="my_collection">
                                <small>Name of the MongoDB collection</small>
                            </div>
                            <div class="form-group">
                                <label for="edit-mongodb-index-name">MongoDB Index Name</label>
                                <input type="text" id="edit-mongodb-index-name" name="mongodb_index_name" value="vector_search_index">
                                <small>Name of the Atlas Vector Search index</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Model Parameters Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>Model Parameters</h3>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-temperature">Temperature</label>
                            <input type="range" id="edit-temperature" name="temperature" min="0" max="2" step="0.1" value="0.7" oninput="updateRangeValue('edit-temperature', this.value)">
                            <div class="range-value">
                                <span id="edit-temperature-value">0.7</span>
                                <small>Controls randomness in responses (0 = deterministic, 2 = very random)</small>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="edit-max-tokens">Max Tokens</label>
                            <input type="number" id="edit-max-tokens" name="max_tokens" min="100" max="8000" value="2000">
                            <small>Maximum number of tokens to generate in the response (100-8000)</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="edit-top-p">Top P (Nucleus Sampling)</label>
                            <input type="range" id="edit-top-p" name="top_p" min="0" max="1" step="0.01" value="1" oninput="updateRangeValue('edit-top-p', this.value)">
                            <div class="range-value">
                                <span id="edit-top-p-value">1.0</span>
                                <small>Controls diversity via nucleus sampling (0.1 = very focused, 1.0 = most diverse)</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-llm-timeout">LLM Timeout (seconds)</label>
                            <input type="number" id="edit-llm-timeout" name="llm_timeout" min="10" max="300" value="60">
                            <small>Timeout in seconds for LLM calls (10-300 seconds, default: 60)</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="edit-llm-retries">LLM Retries</label>
                            <input type="number" id="edit-llm-retries" name="llm_retries" min="0" max="5" value="0">
                            <small>Number of retry attempts for failed LLM calls (0 = no retries)</small>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-evaluation-llm-model">Evaluation LLM Model (Optional)</label>
                            <select id="edit-evaluation-llm-model" name="evaluation_llm_model">
                                <option value="">Use same as main LLM</option>
                                <optgroup label="OpenAI Models (Recommended for Evaluation)">
                                    <option value="gpt-4o">GPT-4o (Best for LLM-as-a-Judge)</option>
                                    <option value="gpt-4o-mini">GPT-4o Mini (Fast & Cost-effective)</option>
                                    <option value="gpt-4-turbo">GPT-4 Turbo (Balanced)</option>
                                </optgroup>
                                <optgroup label="Anthropic Models">
                                    <option value="claude-3-5-sonnet-20241022">Claude 3.5 Sonnet (Intelligent)</option>
                                    <option value="claude-3-haiku-20240307">Claude 3 Haiku (Fast)</option>
                                </optgroup>
                            </select>
                            <small>Separate LLM for benchmarking, test generation, and LLM-as-a-judge evaluation tasks</small>
                        </div>
                    </div>
                </div>

                <!-- Tools Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>Tools & Capabilities</h3>
                    </div>
                    
                    <div class="tools-grid">
                        <label class="tool-checkbox">
                            <input type="checkbox" name="edit-tools" value="retriever">
                            <div class="tool-card">
                                <div class="tool-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                        <polyline points="14,2 14,8 20,8"></polyline>
                                        <line x1="16" y1="13" x2="8" y2="13"></line>
                                        <line x1="16" y1="17" x2="8" y2="17"></line>
                                        <polyline points="10,9 9,9 8,9"></polyline>
                                    </svg>
                                </div>
                                <div class="tool-info">
                                    <h4>Document Loader & Retriever</h4>
                                    <p>Load, process, and retrieve information from your data sources</p>
                                </div>
                            </div>
                        </label>
                        
                        <label class="tool-checkbox">
                            <input type="checkbox" name="edit-tools" value="search_engine">
                            <div class="tool-card">
                                <div class="tool-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                    </svg>
                                </div>
                                <div class="tool-info">
                                    <h4>Web Search</h4>
                                    <p>Search the internet for real-time information</p>
                                </div>
                            </div>
                        </label>
                        
                        <label class="tool-checkbox">
                            <input type="checkbox" name="edit-tools" value="api_toolkit">
                            <div class="tool-card">
                                <div class="tool-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path>
                                    </svg>
                                </div>
                                <div class="tool-info">
                                    <h4>API Toolkit</h4>
                                    <p>Make API calls to external services</p>
                                </div>
                            </div>
                        </label>
                        
                        <label class="tool-checkbox">
                            <input type="checkbox" name="edit-tools" value="sql_toolkit">
                            <div class="tool-card">
                                <div class="tool-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                        <path d="M14 2v6h6"></path>
                                        <path d="M16 13H8"></path>
                                        <path d="M16 17H8"></path>
                                        <path d="M10 9H8"></path>
                                    </svg>
                                </div>
                                <div class="tool-info">
                                    <h4>SQL Database</h4>
                                    <p>Query and analyze database information</p>
                                </div>
                            </div>
                        </label>
                        
                        <label class="tool-checkbox">
                            <input type="checkbox" name="edit-tools" value="arxiv">
                            <div class="tool-card">
                                <div class="tool-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                        <polyline points="14,2 14,8 20,8"></polyline>
                                        <line x1="16" y1="13" x2="8" y2="13"></line>
                                        <line x1="16" y1="17" x2="8" y2="17"></line>
                                        <polyline points="10,9 9,9 8,9"></polyline>
                                    </svg>
                                </div>
                                <div class="tool-info">
                                    <h4>ArXiv Search</h4>
                                    <p>Search academic papers and research on ArXiv</p>
                                </div>
                            </div>
                        </label>
                        
                        <label class="tool-checkbox">
                            <input type="checkbox" name="edit-tools" value="lambda_tool">
                            <div class="tool-card">
                                <div class="tool-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="4,17 10,11 4,5"></polyline>
                                        <line x1="12" y1="19" x2="20" y2="19"></line>
                                    </svg>
                                </div>
                                <div class="tool-info">
                                    <h4>Lambda Tool</h4>
                                    <p>Execute custom code in a sandboxed environment</p>
                                </div>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- Data Sources Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>Data Sources</h3>
                        <button type="button" class="btn-secondary btn-sm" onclick="addEditDataSource()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            Add Data Source
                        </button>
                    </div>
                    
                    <div id="edit-data-sources-container">
                        <!-- Data sources will be added here dynamically -->
                        <div class="empty-state">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14,2 14,8 20,8"></polyline>
                                <line x1="16" y1="13" x2="8" y2="13"></line>
                                <line x1="16" y1="17" x2="8" y2="17"></line>
                                <polyline points="10,9 9,9 8,9"></polyline>
                            </svg>
                            <p>No data sources configured</p>
                            <small>Your agent will start with general knowledge only</small>
                        </div>
                    </div>
                </div>

                <!-- Data Policies Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>Data Security & Privacy</h3>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-pii-redaction">PII Redaction</label>
                            <select id="edit-pii-redaction" name="pii_redaction">
                                <option value="none">None</option>
                                <option value="basic">Basic (Email, Phone)</option>
                                <option value="comprehensive">Comprehensive (Email, Phone, SSN, Credit Card, Names)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="edit-keyword-filtering">Keyword Filtering</label>
                            <input type="text" id="edit-keyword-filtering" name="keyword_filtering" placeholder="sensitive, confidential, private">
                        </div>
                    </div>
                </div>

                <!-- Scaling & Performance Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>Scaling & Performance</h3>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-parallel-ingestion">Parallel Ingestion</label>
                            <div class="toggle-switch">
                                <input type="checkbox" id="edit-parallel-ingestion" name="parallel_ingestion">
                                <span class="slider"></span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="edit-ingestion-workers">Ingestion Workers</label>
                            <input type="number" id="edit-ingestion-workers" name="ingestion_workers" min="1" max="16" value="4">
                            <small>Number of parallel workers (defaults to CPU count)</small>
                        </div>
                    </div>
                </div>

                <!-- Advanced Configuration Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>Advanced Configuration</h3>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-max-context-docs">Max Context Documents</label>
                            <input type="number" id="edit-max-context-docs" name="max_context_docs" min="1" max="100" value="20">
                            <small>Maximum number of retrieved documents to include in context (1-100)</small>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-reproducible-ids">Reproducible IDs</label>
                            <div class="toggle-switch">
                                <input type="checkbox" id="edit-reproducible-ids" name="reproducible_ids" checked>
                                <span class="slider"></span>
                            </div>
                            <small>Generate IDs based on content hash for reproducibility (recommended for testing)</small>
                        </div>
                    </div>
                </div>

                <!-- Benchmark Configuration Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>Benchmark & Evaluation Settings</h3>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-context-window-tokens">Context Window Tokens</label>
                            <input type="number" id="edit-context-window-tokens" name="context_window_tokens" min="1000" max="200000" value="8000">
                            <small>Total model context window used for budgeting (1000-200000 tokens, default: 8000)</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="edit-context-budget-ratio">Context Budget Ratio</label>
                            <input type="range" id="edit-context-budget-ratio" name="context_budget_ratio" min="0.1" max="0.95" step="0.05" value="0.70" oninput="updateRangeValue('edit-context-budget-ratio', this.value)">
                            <div class="range-value">
                                <span id="edit-context-budget-ratio-value">0.70</span>
                                <small>Fraction of window allocated to retrieved context (0.1-0.95, default: 0.70)</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-answer-reserve-tokens">Answer Reserve Tokens</label>
                            <input type="number" id="edit-answer-reserve-tokens" name="answer_reserve_tokens" min="100" max="8000" value="1024">
                            <small>Tokens reserved for the model's answer during benchmarking (100-8000, default: 1024)</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="edit-enable-doc-truncation">Enable Document Truncation</label>
                            <select id="edit-enable-doc-truncation" name="enable_doc_truncation">
                                <option value="true">Yes (Recommended)</option>
                                <option value="false">No</option>
                            </select>
                            <small>Truncate retrieved docs to fit within the budget (recommended for large documents)</small>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="hideEditAgentModal()">Cancel</button>
                    <button type="submit" class="btn-primary">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 12l2 2 4-4"></path>
                            <path d="M21 12c-1 0-2-1-2-2s1-2 2-2 2 1 2 2-1 2-2 2z"></path>
                            <path d="M3 12c1 0 2-1 2-2s-1-2-2-2-2 1-2 2 1 2 2 2z"></path>
                            <path d="M12 3c0 1-1 2-2 2s-2 1-2 2 1 1 2 2 2 1 2 2 1-1 2-2 2-1 2-2-1-1-2-2-2-1-2-2z"></path>
                        </svg>
                        Update Agent
                    </button>
                </div>
            </form>
        </div>
    </div>


    <!-- Agent Details Modal -->
    <div class="modal" id="agent-details-modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2 id="agent-details-title">Agent Details</h2>
                <button class="modal-close" onclick="hideAgentDetailsModal()">×</button>
            </div>
            <div class="modal-body" id="agent-details-content">
                <div class="loading-state">
                    <div class="loading-spinner"></div>
                    <p>Loading agent details...</p>
                </div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>


    <!-- Delete Confirmation Modal -->
    <div class="modal" id="delete-confirmation-modal">
        <div class="modal-content delete-modal">
            <div class="modal-header">
                <div class="header-content">
                    <div class="header-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6M10 11v6M14 11v6"/>
                        </svg>
                    </div>
                    <div class="header-text">
                        <h2>Delete Agent</h2>
                        <p class="modal-subtitle">This action cannot be undone</p>
                    </div>
                </div>
                <button class="modal-close" onclick="hideDeleteConfirmationModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="confirmation-content">
                    <div class="confirmation-icon">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <circle cx="12" cy="12" r="10" fill="rgba(239, 68, 68, 0.1)" stroke="rgba(239, 68, 68, 0.3)"></circle>
                            <path d="M15 9l-6 6M9 9l6 6" stroke="var(--error-color)" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                    </div>
                    <div class="confirmation-text">
                        <h3>Are you sure you want to delete <span id="delete-agent-name" class="agent-name-highlight"></span>?</h3>
                        <p>This will permanently remove the agent configuration, vector store, and all associated data. This action cannot be undone.</p>
                        <div class="warning-details">
                            <div class="warning-item">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 9v4M12 17h.01"/>
                                </svg>
                                <span>Agent configuration will be deleted</span>
                            </div>
                            <div class="warning-item">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 9v4M12 17h.01"/>
                                </svg>
                                <span>Vector store and embeddings will be removed</span>
                            </div>
                            <div class="warning-item">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 9v4M12 17h.01"/>
                                </svg>
                                <span>Chat history and sessions will remain accessible</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" onclick="hideDeleteConfirmationModal()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                    Cancel
                </button>
                <button type="button" class="btn-danger-confirm" onclick="confirmDeleteAgent()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6M10 11v6M14 11v6"/>
                    </svg>
                    Delete Agent
                </button>
            </div>
        </div>
    </div>

    <!-- Model Details Modal -->
    <div class="modal" id="model-details-modal">
        <div class="modal-content large">
            <div class="modal-header">
                <div class="header-content">
                    <div class="header-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2L2 7L12 12L22 7L12 2Z"></path>
                            <path d="M2 17L12 22L22 17"></path>
                            <path d="M2 12L12 17L22 12"></path>
                            <circle cx="12" cy="12" r="3"></circle>
                        </svg>
                    </div>
                    <div class="header-text">
                        <h2 id="model-details-title">Model Details</h2>
                        <p id="model-details-subtitle">Loading...</p>
                    </div>
                </div>
                <button type="button" class="modal-close" onclick="hideModelDetailsModal()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div id="model-details-content">
                    <div class="loading-state">
                        <div class="loading-spinner"></div>
                        <p>Loading model details...</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>

    <!-- Create Test Set Modal -->
    <div class="modal" id="create-test-set-modal">
        <div class="modal-content large">
            <div class="modal-header">
                <div class="header-content">
                    <div class="header-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 12l2 2 4-4"></path>
                            <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3"></path>
                            <path d="M3 12c1 0 3-1 3-3s-2-3-3-3-3 1-3 3 2 3 3 3"></path>
                            <path d="M12 3c0 1-1 3-3 3s-3-2-3-3 1-3 3-3 3 2 3 3"></path>
                            <path d="M12 21c0-1 1-3 3-3s3 2 3 3-1 3-3 3-3-2-3-3"></path>
                        </svg>
                    </div>
                    <div class="header-text">
                        <h2>Create Test Set</h2>
                        <p class="modal-subtitle">Generate a new evaluation test set for benchmarking</p>
                    </div>
                </div>
                <button class="modal-close" onclick="hideCreateTestSetModal()">&times;</button>
            </div>
            
            <div class="modal-body">
                <form id="create-test-set-form">
                    <div class="form-section">
                        <div class="section-header">
                            <h3>Test Set Configuration</h3>
                            <p>Configure the parameters for generating your test set</p>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="test-set-agent">Agent</label>
                                <select id="test-set-agent" name="agent_name" required>
                                    <option value="">Select an agent...</option>
                                </select>
                                <small>Choose the agent to generate test questions for</small>
                            </div>
                            <div class="form-group">
                                <label for="test-set-questions">Number of Questions</label>
                                <input type="number" id="test-set-questions" name="num_questions" min="1" max="500" value="50" required>
                                <small>Number of questions to generate (1-500)</small>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="test-set-output">Output File Name</label>
                                <input type="text" id="test-set-output" name="output_file" value="test_set.json" required>
                                <small>Name for the generated test set file</small>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn-secondary" onclick="hideCreateTestSetModal()">Cancel</button>
                <button type="button" class="btn-primary" onclick="createTestSet()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 12l2 2 4-4"></path>
                        <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3"></path>
                        <path d="M3 12c1 0 3-1 3-3s-2-3-3-3-3 1-3 3 2 3 3 3"></path>
                        <path d="M12 3c0 1-1 3-3 3s-3-2-3-3 1-3 3-3 3 2 3 3"></path>
                        <path d="M12 21c0-1 1-3 3-3s3 2 3 3-1 3-3 3-3-2-3-3"></path>
                    </svg>
                    Generate Test Set
                </button>
            </div>
        </div>
    </div>

    <!-- Run Benchmark Modal -->
    <div class="modal" id="run-benchmark-modal">
        <div class="modal-content large">
            <div class="modal-header">
                <div class="header-content">
                    <div class="header-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 12l2 2 4-4"></path>
                            <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3"></path>
                            <path d="M3 12c1 0 3-1 3-3s-2-3-3-3-3 1-3 3 2 3 3 3"></path>
                            <path d="M12 3c0 1-1 3-3 3s-3-2-3-3 1-3 3-3 3 2 3 3"></path>
                            <path d="M12 21c0-1 1-3 3-3s3 2 3 3-1 3-3 3-3-2-3-3"></path>
                        </svg>
                    </div>
                    <div class="header-text">
                        <h2>Run Benchmark</h2>
                        <p class="modal-subtitle">Execute a benchmark test on an agent using a test set</p>
                    </div>
                </div>
                <button class="modal-close" onclick="hideRunBenchmarkModal()">&times;</button>
            </div>
            
            <div class="modal-body">
                <form id="run-benchmark-form">
                    <div class="form-section">
                        <div class="section-header">
                            <h3>Benchmark Configuration</h3>
                            <p>Select the agent and test set for benchmarking</p>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="benchmark-agent">Agent</label>
                                <select id="benchmark-agent" name="agent_name" required>
                                    <option value="">Select an agent...</option>
                                </select>
                                <small>Choose the agent to benchmark</small>
                            </div>
                            <div class="form-group">
                                <label for="benchmark-test-set">Test Set</label>
                                <select id="benchmark-test-set" name="test_set_file" required>
                                    <option value="">Select a test set...</option>
                                </select>
                                <small>Choose the test set to use for benchmarking</small>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="benchmark-run-id">Run ID (Optional)</label>
                                <input type="text" id="benchmark-run-id" name="run_id" placeholder="Auto-generated if empty">
                                <small>Custom identifier for this benchmark run</small>
                            </div>
                            <div class="form-group">
                                <label for="benchmark-export-csv">Export CSV (Optional)</label>
                                <input type="text" id="benchmark-export-csv" name="export_csv" placeholder="Auto-generated if empty">
                                <small>Custom CSV export path</small>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn-secondary" onclick="hideRunBenchmarkModal()">Cancel</button>
                <button type="button" class="btn-primary" onclick="runBenchmark()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 12l2 2 4-4"></path>
                        <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3"></path>
                        <path d="M3 12c1 0 3-1 3-3s-2-3-3-3-3 1-3 3 2 3 3 3"></path>
                        <path d="M12 3c0 1-1 3-3 3s-3-2-3-3 1-3 3-3 3 2 3 3"></path>
                        <path d="M12 21c0-1 1-3 3-3s3 2 3 3-1 3-3 3-3-2-3-3"></path>
                    </svg>
                    Start Benchmark
                </button>
            </div>
        </div>
    </div>

    <!-- Benchmark Results Modal -->
    <div class="modal" id="benchmark-results-modal">
        <div class="modal-content extra-large">
            <div class="modal-header">
                <div class="header-content">
                    <div class="header-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="20" x2="18" y2="10"></line>
                            <line x1="12" y1="20" x2="12" y2="4"></line>
                            <line x1="6" y1="20" x2="6" y2="14"></line>
                        </svg>
                    </div>
                    <div class="header-text">
                        <h2>Benchmark Results</h2>
                        <p class="modal-subtitle" id="benchmark-results-subtitle">Detailed results for benchmark run</p>
                    </div>
                </div>
                <button class="modal-close" onclick="hideBenchmarkResultsModal()">&times;</button>
            </div>
            
            <div class="modal-body">
                <div id="benchmark-results-content">
                    <div class="loading-state">
                        <div class="loading-spinner"></div>
                        <p>Loading benchmark results...</p>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn-secondary" onclick="hideBenchmarkResultsModal()">Close</button>
                <button type="button" class="btn-primary" onclick="downloadBenchmarkResults()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7,10 12,15 17,10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                    Download CSV
                </button>
            </div>
        </div>
    </div>

</body>
</html>
